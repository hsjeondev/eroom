<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{/include/layout}">
<head>
<meta charset="UTF-8">
<title>ì°¨ëŸ‰ ëª©ë¡</title>
<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=1f65e375f9cf9d0f6897e2c7a4c57332&libraries=services"></script>
<script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

</head>


<body>
	<main class="main" id="top" layout:fragment="content">

		<div class="row">
			<!-- ì™¼ìª½: ì°¨ëŸ‰ ì˜ˆì•½ ëª©ë¡ + ì˜¤ëŠ˜ ì˜ˆì•½ í˜„í™© -->
			<div class="col-md-6 d-flex flex-column gap-4">

				<!-- ğŸš— ì°¨ëŸ‰ ì˜ˆì•½ ëª©ë¡ -->
				<div>
					<h5 class="fw-bold">ì°¨ëŸ‰ ì˜ˆì•½ ëª©ë¡</h5>
					<div id="vehicleTable"
						data-list='{"valueNames":["no","vehicle","passengers","date"], "page": 5, "pagination": true}'>
						<div class="table-responsive">
							<table class="table table-striped table-sm fs-9 mb-0 text-center">
								<thead class="text-center align-middle">
									<tr>
										<th class="sort" data-sort="no" style="width: 5%;">ë²ˆí˜¸</th>
										<th class="sort" data-sort="vehicle" style="width: 25%;">ì°¨ëŸ‰</th>
										<th class="sort" data-sort="passengers" style="width: 20%;">íƒ‘ìŠ¹
											ê°€ëŠ¥ ì¸ì›</th>
										<th class="sort" data-sort="date" style="width: 20%;">ë“±ë¡ì¼</th>
										<th style="width: 10%;"></th>
									</tr>
								</thead>
								<tbody class="list align-middle">
									<tr th:if="${#lists.isEmpty(list)}">
										<td colspan="5">ë“±ë¡ëœ ì°¨ëŸ‰ì´ ì—†ìŠµë‹ˆë‹¤ ğŸ˜“</td>
									</tr>
									<tr class="align-middle vehicle-row"
										th:if="${!#lists.isEmpty(list)}"
										th:each="result, resultstatus : ${list}">
										<td class="no" th:text="${resultstatus.count}"></td>
										<td class="vehicle" th:text="${result.facilityName}"></td>
										<td class="passengers" th:text="${result.facilityCapacity}"></td>
										<td class="date"
											th:text="${#temporals.format(result.facilityRegDate, 'yy-MM-dd')}"></td>
										<td class="text-end pe-0">
											<button class="btn btn-sm btn-outline-primary"
												data-bs-toggle="modal" data-bs-target="#addEventModal"
												th:attr="data-facility-no=${result.facilityNo}, data-facility-name=${result.facilityName}">
												ì˜ˆì•½í•˜ê¸°</button>
										</td>
									</tr>
								</tbody>
							</table>
						</div>

						<!-- âœ… í˜ì´ì§• ì˜ì—­ -->
						<div class="d-flex justify-content-center mt-3">
							<div class="d-flex">
								<button class="page-link disabled" data-list-pagination="prev"
									disabled>
									<i class="fas fa-chevron-left"></i>
								</button>
								<ul class="mb-0 pagination">
									<li class="active">
										<button class="page" type="button" data-i="1" data-page="5">1</button>
									</li>
								</ul>
								<button class="page-link pe-0" data-list-pagination="next"
									disabled>
									<i class="fas fa-chevron-right"></i>
								</button>
							</div>
						</div>
					</div>
				</div>

				
				<!-- ğŸ“… ì˜¤ëŠ˜ ì˜ˆì•½ í˜„í™© -->
				<div>
					<h5 class="fw-bold">ì˜¤ëŠ˜ ì˜ˆì•½ í˜„í™©</h5>
					<div class="table-responsive">
						<table class="table table-striped table-sm fs-9 mb-0 text-center">
							<thead class="text-center align-middle">
								<tr>
									<th style="width: 5%;">ë²ˆí˜¸</th>
									<th style="width: 20%;">ì°¨ëŸ‰</th>
									<th style="width: 20%;">ì˜ˆì•½ì</th>
									<th style="width: 20%;">ì˜ˆì•½ ë‚ ì§œ</th>
									<!-- âœ… ì¶”ê°€ -->
									<th style="width: 25%;">ì˜ˆì•½ ì‹œê°„</th>
								</tr>
							</thead>
							<tbody class="align-middle">
								<tr th:if="${#lists.isEmpty(todayReservations)}">
									<td colspan="5">ì˜¤ëŠ˜ ì˜ˆì•½ëœ ì°¨ëŸ‰ì´ ì—†ìŠµë‹ˆë‹¤ ğŸ˜Š</td>
								</tr>
								<tr th:each="res, stat : ${todayReservations}">
									<td th:text="${stat.count}"></td>
									<td th:text="${res.vehicleName}"></td>
									<td th:text="${res.reserverName}"></td>
									<td
										th:text="${#temporals.format(res.reservation_start, 'yyyy-MM-dd')}"></td>
									
									<td><span
										th:text="${#temporals.format(res.reservation_start, 'HH:mm')}"></span>
										~ <span
										th:text="${#temporals.format(res.reservation_end, 'HH:mm')}"></span>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>

			</div>



			<div class="modal fade" id="addEventModal" tabindex="-1">
				<div class="modal-dialog modal-dialog-centered">
					<div class="modal-content border border-translucent">
						<form id="addEventForm" autocomplete="off" name="addEventForm">
							<div class="modal-header px-card border-0">
								<h5 class="mb-0 text-body-highlight">ì°¨ëŸ‰ ì˜ˆì•½</h5>
								<button
									class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 mt-2 me-2 px-2 py-1"
									style="font-size: 0.9rem;" type="button"
									data-bs-dismiss="modal" aria-label="Close">Ã—</button>
							</div>
							
					


							<!-- ëª¨ë‹¬ì°½ ì•ˆì— facilityNoê°’ì„ ë„£ì–´ì£¼ëŠ” script -->
							<script>
							document.addEventListener("DOMContentLoaded", function () {
								  const modal = document.getElementById("addEventModal");
								  const facilityInput = document.getElementById("modalFacilityNo");

								  modal.addEventListener("show.bs.modal", function (event) {
								    // ì°¨ëŸ‰ ì •ë³´ í‘œì‹œ
								    const button = event.relatedTarget;
								    const facilityNo = button?.getAttribute("data-facility-no") || "";
								    const facilityName = button?.getAttribute("data-facility-name") || "ì°¨ëŸ‰ëª…ì´ ì—†ìŠµë‹ˆë‹¤";

								    facilityInput.value = facilityNo;
								    document.getElementById("selectedFacilityName").textContent = facilityName;

								    // ì´ˆê¸°í™” ì½”ë“œ
								    const form = document.forms["addEventForm"];
								    if (form) form.reset();

								    document.getElementById("calendarLocation").value = "";
								    document.getElementById("calendarStartTime").value = "";
								    document.getElementById("calendarEndTime").value = "";

								    const distanceBox = document.getElementById("distanceInfoBox");
								    if (distanceBox) {
								      distanceBox.style.display = "none";
								      document.getElementById("distanceText").textContent = "";
								      document.getElementById("durationText").textContent = "";
								    }

								    const startDate = document.getElementById("startDate");
								    const endDate = document.getElementById("endDate");
								    if (startDate) startDate.value = "";
								    if (endDate) endDate.value = "";

								    const startTime = document.getElementById("startTime");
								    const endTime = document.getElementById("endTime");
								    if (startTime) startTime.selectedIndex = 0;
								    if (endTime) endTime.selectedIndex = 0;
								  });
								});
										</script>


							<!-- ë“±ë¡ ëª¨ë‹¬ì°½ -->
							<div class="modal-body p-4">
								<!-- ìˆ¨ê²¨ì§„ ê°’ë“¤ -->
								<input type="hidden" name="employee_no"
									th:value="${#authentication.principal.employee.employeeNo}" />
								<input type="hidden" name="facility_no" id="modalFacilityNo"
									value="" /> <input type="hidden" name="separator_code"
									value="F002" id="separator"> <input type="hidden"
									name="reservation_creator"
									th:value="${#authentication.principal.employee.employeeId}" />
								<div class="mb-3 text-center">
									<label class="form-label text-primary fw-semibold mb-1"
										for="selectedFacilityName" style="font-size: 1rem;">
										ì„ íƒí•œ ì°¨ëŸ‰ </label>
									<div class="form-control text-center fw-bold fs-5"
										id="selectedFacilityName"
										style="border: none; background-color: #f8f9fa;">ì°¨ëŸ‰ì´
										ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</div>
								</div>
								<!-- ì¥ì†Œ -->
								<div class="mb-3">
									<label for="calendarLocation" class="form-label">ëª©ì ì§€</label>
									<div class="input-group">
										<input type="text" class="form-control form-control-sm"
											id="calendarLocation" name="reservation_location"
											placeholder="ì£¼ì†Œë¥¼ ê²€ìƒ‰í•˜ë ¤ë©´ ì˜¤ë¥¸ìª½ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”" readonly />
										<button type="button" class="btn btn-outline-secondary btn-sm"
											onclick="openPostcode()">ì£¼ì†Œ ê²€ìƒ‰</button>
									</div>
								</div>

								<div id="distanceInfoBox" class="mt-2" style="display: none;">
									<div class="text-center px-2 py-1 rounded"
										style="background-color: #f2f6fa; font-size: 0.85rem; color: #333;">
										<strong id="distanceText"
											style="display: block; font-weight: 500;"></strong> <small
											id="durationText" style="font-size: 0.75rem;"></small>
									</div>
								</div>

								<!-- ì‹œê°„ -->
								<div class="row g-2 mb-3">
									<!-- ë‚ ì§œ ì„ íƒ -->
									<div class="row g-2">
										<div class="col">
											<label class="form-label">ì‹œì‘ ë‚ ì§œ</label> <input type="date"
												id="startDate" class="form-control"
												name="reservation_start_date">
										</div>
										<div class="col">
											<label class="form-label">ì¢…ë£Œ ë‚ ì§œ</label> <input type="date"
												id="endDate" class="form-control"
												name="reservation_end_date">
										</div>
									</div>

									<!-- ì‹œê°„ ì„ íƒ -->
									<div class="row g-2 mt-2">
										<div class="col">
											<label class="form-label">ì‹œì‘ ì‹œê°„</label> <select
												id="startTime" class="form-select">
												<option value="09:00">09:00</option>
												<option value="10:00">10:00</option>
												<option value="11:00">11:00</option>
												<option value="12:00">12:00</option>
												<option value="13:00">13:00</option>
												<option value="14:00">14:00</option>
												<option value="15:00">15:00</option>
												<option value="16:00">16:00</option>
												<option value="17:00">17:00</option>
											</select>
										</div>
										<div class="col">
											<label class="form-label">ì¢…ë£Œ ì‹œê°„</label> <select id="endTime"
												class="form-select">
												<option value="10:00">10:00</option>
												<option value="11:00">11:00</option>
												<option value="12:00">12:00</option>
												<option value="13:00">13:00</option>
												<option value="14:00">14:00</option>
												<option value="15:00">15:00</option>
												<option value="16:00">16:00</option>
												<option value="17:00">17:00</option>
												<option value="18:00">18:00</option>
												<option value="19:00">19:00</option>
												<option value="20:00">20:00</option>
												<option value="21:00">21:00</option>
												<option value="22:00">22:00</option>
												<option value="23:00">23:00</option>
											</select>
										</div>
									</div>

									<!-- ìˆ¨ê²¨ì„œ ì„œë²„ë¡œ ë³´ë‚¼ datetime-local ê°’ -->
									<input type="hidden" name="reservation_start"
										id="calendarStartTime"> <input type="hidden"
										name="reservation_end" id="calendarEndTime">
								</div>
							</div>
							<div class="modal-body p-4">
								<!-- ì•ˆë‚´ ë¬¸êµ¬ ì¶”ê°€ -->
								<div class="alert text-center mb-3" role="alert"
									style="font-size: 0.9rem; background-color: #E3F2FD; border: 1px solid #BBDEFB; color: #0D47A1;">
									â„¹ï¸ <strong>ì˜ˆì•½ í™•ì • í›„ì—ëŠ” ì‹œê°„ ìˆ˜ì •ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.</strong><br> ë³€ê²½ì´ í•„ìš”í• 
									ê²½ìš° <strong>ê¸°ì¡´ ì˜ˆì•½ì„ ì·¨ì†Œ</strong>í•œ ë’¤ ë‹¤ì‹œ ì˜ˆì•½í•´ì£¼ì„¸ìš”.<br> <br>
									ğŸš— <strong>í•´ë‹¹ ì°¨ëŸ‰ì€ ë‹¤ìŒ ì˜ˆì•½ì´ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ</strong><br> <strong>ìµœì†Œ
										10ë¶„ ì „ê¹Œì§€ëŠ” ë°˜ë‚©</strong>í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.<br> <br> ì‹ ì¤‘í•œ ì˜ˆì•½ê³¼ ì •ì‹œ ë°˜ë‚©ì„
									ë¶€íƒë“œë¦½ë‹ˆë‹¤ ğŸ˜Š
								</div>
							</div>
							<div class="modal-footer border-0 px-4 pb-3">
								<button class="btn btn-primary w-100" type="submit">
									ì˜ˆì•½í•˜ê¸°</button>
							</div>
						</form>
					</div>
				</div>
			</div>
			
			

		
		
			  

			<!-- ì°¨ëŸ‰ ì˜ˆì•½ ìƒì„¸ì¡°íšŒ ëª¨ë‹¬ -->
			<div class="modal fade" id="vehicleDetailModal" tabindex="-1"
				aria-labelledby="vehicleDetailModalLabel" aria-hidden="true">
				<div class="modal-dialog modal-dialog-centered">
					<div class="modal-content border border-translucent">
						<div class="modal-header px-card border-0 position-relative">
							<h5 class="mb-0 lh-sm text-body-highlight"
								id="vehicleDetailModalLabel">ì°¨ëŸ‰ ì˜ˆì•½ ìƒì„¸ì¡°íšŒ</h5>
							<button class="btn-close position-absolute top-0 end-0 mt-2 me-2"
								type="button" data-bs-dismiss="modal" aria-label="Close"></button>
						</div>

						<div class="modal-body p-4">
							<input type="hidden" id="detailReservationNo"> <input
								type="hidden" name="reservation_creator" id="loginEmployeeId"
								th:value="${#authentication.principal.employee.employeeId}" />
							<div class="mb-3">
								<strong>ì°¨ëŸ‰ëª…:</strong> <span id="detailVehicleName"></span>
							</div>
							<div class="mb-3">
								<strong>ì˜ˆì•½ì:</strong> <span id="detailReserverName"></span>
							</div>
							<div class="mb-3">
								<strong>ëª©ì ì§€:</strong> <span id="detailLocation"></span>
							</div>
							<div class="mb-3">
								<strong>ì‹œì‘ ì‹œê°„:</strong> <span id="detailStartTime"></span>
							</div>
							<div class="mb-3">
								<strong>ì¢…ë£Œ ì‹œê°„:</strong> <span id="detailEndTime"></span>
							</div>
						</div>

						<div
							class="modal-footer d-flex justify-content-between align-items-center border-0">
							<div class="d-flex">
								<!-- <button class="btn btn-subtle-secondary me-1 mb-1"
												type="button" id="editVehicleBtn">ìˆ˜ì •</button> -->
								<button class="btn btn-outline-info me-1 mb-1" type="button"
									id="deleteVehicleBtn">ì‚­ì œ</button>
							</div>
							<div>
								<button class="btn btn-primary px-4" type="button"
									data-bs-dismiss="modal">í™•ì¸</button>
							</div>
						</div>
					</div>
				</div>
			</div>


			<!-- ë“±ë¡ì„ ìœ„í•œ fetch -->
			<script>
				
						document.addEventListener("DOMContentLoaded", function () {
							  const form = document.addEventForm;
							  const modal = document.getElementById("addEventModal");
							  const facilityInput = document.getElementById("modalFacilityNo");
							  const today = new Date().toISOString().split("T")[0];
							  form.reservation_start_date.min = today;
							  form.reservation_end_date.min = today;


							  // ì˜ˆì•½ ë“±ë¡ submit
							  form.addEventListener("submit", function (e) {
							    e.preventDefault();

							    const startDate = form.reservation_start_date.value;
							    const endDate = form.reservation_end_date.value;
							    const startTime = form.startTime.value;
							    const endTime = form.endTime.value;

							    if (!form.reservation_location.value) {
							      alert("ëª©ì ì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
							      return;
							    }

							    if (!startDate || !endDate || !startTime || !endTime) {
							      alert("ë‚ ì§œì™€ ì‹œê°„ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”!");
							      return;
							    }

							    const fullStart = `${startDate}T${startTime}`;
							    const fullEnd = `${endDate}T${endTime}`;

							    if (fullStart >= fullEnd) {
							      alert("ì¢…ë£Œì¼ì‹œëŠ” ì‹œì‘ì¼ì‹œë³´ë‹¤ ëŠ¦ì–´ì•¼ í•©ë‹ˆë‹¤!");
							      return;
							    }

							    // ì¤‘ë³µ ì‹œê°„ ê²€ì‚¬
							    const startHour = parseInt(startTime.split(":")[0]);
							    const endHour = parseInt(endTime.split(":")[0]);

							    const bookedHours = [...form.startTime.options]
							      .filter(opt => opt.disabled)
							      .map(opt => parseInt(opt.value.split(":")[0]));

							    for (let hour = startHour; hour < endHour; hour++) {
							      if (bookedHours.includes(hour)) {
							        alert("ì„ íƒí•œ ì‹œê°„ ë²”ìœ„ì— ì´ë¯¸ ì˜ˆì•½ëœ ì‹œê°„ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤!");
							        return;
							      }
							    }

							    form.calendarStartTime.value = fullStart;
							    form.calendarEndTime.value = fullEnd;

							    // FormData êµ¬ì„±
							    const payload = new FormData(form);

							    fetch('/resvehicle/reservation', {
							      method: 'POST',
							      headers: {
							        'header': document.querySelector('meta[name="_csrf_header"]').content,
							        'X-CSRF-Token': document.querySelector('meta[name="_csrf"]').content
							      },
							      body: payload
							    })
							      .then(response => response.json())
							      .then(data => {
							        alert(data.res_msg);
							        if (data.res_code == 200) {
							          location.reload();
							        }
							      });
							  });
							});

							</script>




			<!-- í˜ì´ì§• -->
			<!-- 			<div class="d-flex justify-content-center mt-3">
							<div class="d-flex">
								<button class="page-link disabled" data-list-pagination="prev"
									disabled>
									<i class="fas fa-chevron-left"></i>
								</button>
								<ul class="mb-0 pagination">
									<li class="active">
										<button class="page" type="button" data-i="1" data-page="5">1</button>
									</li>
								</ul>
								<button class="page-link pe-0" data-list-pagination="next"
									disabled>
									<i class="fas fa-chevron-right"></i>
								</button>
							</div>
						</div>
					</div>
				</div>
			</div> -->


			<!-- ì°¨ëŸ‰ ì˜ˆì•½ ìˆ˜ì • ëª¨ë‹¬ -->
			<!-- 		<div class="modal fade" id="editVehicleModal" tabindex="-1">
				<div class="modal-dialog modal-dialog-centered">
					<div class="modal-content border border-translucent">
						<form id="editVehicleForm" autocomplete="off"
							name="editVehicleForm">
							<div class="modal-header px-card border-0">
								<h5 class="mb-0 text-body-highlight">ì°¨ëŸ‰ ì˜ˆì•½ ìˆ˜ì •</h5>
								<button
									class="btn-close position-absolute top-0 end-0 mt-2 me-2"
									type="button" data-bs-dismiss="modal" aria-label="Close"></button>
							</div>

							<div class="modal-body p-4"> -->
			<!-- ìˆ¨ê²¨ì§„ ê°’ë“¤ -->
			<!-- 		<input type="hidden" name="reservation_no" id="editReservationNo" />
							    <input type="hidden"name="employee_no" th:value="${#authentication.principal.employee.employeeNo}" />
								<input type="hidden" name="facility_no" id="editFacilityNo" />
								<input type="hidden" name="separator_code" value="F002" id="editSeparator"> 
								<input type="hidden" name="reservation_creator" th:value="${#authentication.principal.employee.employeeId}" />
								<input type="hidden" name="reservation_editor" th:value="${#authentication.principal.employee.employeeId}" /> -->

			<!-- ì¥ì†Œ -->
			<!-- 		<div class="mb-3">
									<label for="editLocation" class="form-label">ëª©ì ì§€</label> <input
										type="text" class="form-control form-control-sm"
										id="editLocation" name="reservation_location"
										placeholder="ëª©ì ì§€ë¥¼ ì ì–´ì£¼ì„¸ìš”" />
								</div> -->

			<!-- ë‚ ì§œ ì„ íƒ -->
			<!-- 			<div class="row g-2 mb-3">
									<div class="col">
										<label class="form-label">ì‹œì‘ ë‚ ì§œ</label> <input type="date"
											id="editStartDate" class="form-control"
											name="reservation_start_date" />
									</div>
									<div class="col">
										<label class="form-label">ì¢…ë£Œ ë‚ ì§œ</label> <input type="date"
											id="editEndDate" class="form-control"
											name="reservation_end_date" />
									</div>
								</div> -->

			<!-- ì‹œê°„ ì„ íƒ -->
			<!-- 				<div class="row g-2 mt-2">
									<div class="col">
										<label class="form-label">ì‹œì‘ ì‹œê°„</label> <select
											id="editStartTime" class="form-select">
											<option value="09:00">09:00</option>
											<option value="10:00">10:00</option>
											<option value="11:00">11:00</option>
											<option value="12:00">12:00</option>
											<option value="13:00">13:00</option>
											<option value="14:00">14:00</option>
											<option value="15:00">15:00</option>
											<option value="16:00">16:00</option>
											<option value="17:00">17:00</option>
										</select>
									</div>
									<div class="col">
										<label class="form-label">ì¢…ë£Œ ì‹œê°„</label> <select
											id="editEndTime" class="form-select">
											<option value="10:00">10:00</option>
											<option value="11:00">11:00</option>
											<option value="12:00">12:00</option>
											<option value="13:00">13:00</option>
											<option value="14:00">14:00</option>
											<option value="15:00">15:00</option>
											<option value="16:00">16:00</option>
											<option value="17:00">17:00</option>
											<option value="18:00">18:00</option>
											<option value="19:00">19:00</option>
											<option value="20:00">20:00</option>
											<option value="21:00">21:00</option>
											<option value="22:00">22:00</option>
											<option value="23:00">23:00</option>
										</select>
									</div>
								</div>

								ìˆ¨ê²¨ì„œ ì„œë²„ë¡œ ë³´ë‚¼ datetime-local ê°’
								<input type="hidden" name="reservation_start"
									id="editCalendarStartTime" /> <input type="hidden"
									name="reservation_end" id="editCalendarEndTime" />
							</div>

							<div class="modal-footer border-0 px-4 pb-3">
								<button class="btn btn-primary w-100" type="submit">ìˆ˜ì •
									ì™„ë£Œ</button>
							</div>
						</form>
					</div>
				</div>
			</div> -->




			<!-- ìº˜ë¦°ë” (ì˜¤ë¥¸ìª½) -->
			<div class="col-md-6">
				<div class="calendar-outline" id="appCalendar"
					style="height: 400px;"></div>
			</div>
		</div>
		<!-- ìº˜ë¦°ë” script -->
		<script>
		document.addEventListener('DOMContentLoaded', function () {
			  const calendarEl = document.getElementById('appCalendar');
			  const separator = document.getElementById('separator').value;
			  const loginEmployeeId = document.getElementById("loginEmployeeId").value;
			  //console.log(separator+"!!!!!!!!!!!!!!!");
			  const calendar = new FullCalendar.Calendar(calendarEl, {
			      initialView: 'dayGridMonth',
			      locale: 'ko',		      
			      headerToolbar: {
			        left: 'prev,next today',
			        center: 'title',
			        right: ''
			      },
			      buttonText: {
			    	    today: 'ì˜¤ëŠ˜' 
			    	  },
			      dayMaxEventRows: true,
			      views: {
			        dayGridMonth: {
			          dayMaxEventRows: 3,
			          moreLinkText: "ë”ë³´ê¸°"		       
			          }
			      },
			      eventSources: [ //êµ¬ê¸€ ìº˜ë¦°ë”ë¡œ ê³µíœ´ì¼ ë¶ˆëŸ¬ì˜¤ê¸°, ì˜ˆì•½ í˜„í™© ë¶ˆëŸ¬ì˜¤ê¸°
			    	    {
			    	      events: function (fetchInfo, successCallback, failureCallback) {
			    	        fetch('/resvehicle/list/' + separator)
			    	          .then(response => response.json())
			    	          .then(events => successCallback(events))
			    	          .catch(error => {
			    	            console.error("ì°¨ëŸ‰ ì˜ˆì•½ ë¶ˆëŸ¬ì˜¤ê¸° ì‹ªíŒ¨", error);
			    	            failureCallback(error);
			    	          });
			    	      }
			    	    },
			    	    {
			    	      events: function (fetchInfo, successCallback, failureCallback) {
			    	        const apiKey = 'AIzaSyCjXiu1ShbhE0XenBtciLx8ezU-mcZI0R0';
			    	        const calendarId = 'ko.south_korea%23holiday@group.v.calendar.google.com';
			    	        const timeMin = new Date(fetchInfo.start).toISOString();
			    	        const timeMax = new Date(fetchInfo.end).toISOString();
			    	        const url = `https://www.googleapis.com/calendar/v3/calendars/${calendarId}/events?key=${apiKey}&timeMin=${timeMin}&timeMax=${timeMax}&orderBy=startTime&singleEvents=true`;

			    	        fetch(url)
			    	          .then(response => response.json())
			    	          .then(data => {
			    	            if (!data.items) {
			    	              console.warn("ê³µíœ´ì¼ ë°ì´í„° ì—†ìŒ", data);
			    	              return successCallback([]);
			    	            }
			    	            const holidays = data.items.map(item => ({
			    	              title: item.summary,
			    	              start: item.start.date,
			    	              allDay: true,
			    	              extendedProps: {
			    	            	    type: 'holiday'
			    	            	  }
			    	              
			    	            }));
			    	            successCallback(holidays);
			    	          })
			    	          .catch(error => {
			    	            console.error("ê³µíœ´ì¼ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨", error);
			    	            failureCallback(error);
			    	          });
			    	      }
			    	    }
			    	  ],
			      eventDisplay: 'block',
			      dayCellContent: function (info) {
			        return info.date.getDate();
			      },
			      eventClick: function(info) {
			    	  const event = info.event;

			    	  // ë‚ ì§œ í¬ë§· ì˜µì…˜
			    	  const options = {
			    	    year: 'numeric',
			    	    month: 'long',
			    	    day: 'numeric',
			    	    weekday: 'short',
			    	    hour: '2-digit',
			    	    minute: '2-digit',
			    	    hour12: false
			    	  };
			    	  
			    	  //ë¡œê·¸ì¸í•œ ì‚¬ëŒê³¼ ì˜ˆì•½í•œ ì‚¬ëŒì˜ idê°€ ê°™ë‹¤ë©´ ìˆ˜ì •/ì‚­ì œ
			    	  const isOwner = loginEmployeeId === event.extendedProps.reservationCreator;
			    	  //document.getElementById("editVehicleBtn").style.display = isOwner ? 'inline-block' : 'none';
			    	  document.getElementById("deleteVehicleBtn").style.display = isOwner ? 'inline-block' : 'none';


			    	  // ìƒì„¸ ëª¨ë‹¬ ê°’ ì±„ìš°ê¸°
			    	  document.getElementById("detailReservationNo").value = event.extendedProps.reservation_no || '';
			    	  document.getElementById("detailVehicleName").textContent = event.extendedProps.vehicleName || '';
			    	  document.getElementById("detailReserverName").textContent = event.extendedProps.reserverName || '';
			    	  document.getElementById("detailLocation").textContent = event.extendedProps.reservationLocation || '';
			    	  
			    	  // ë‚ ì§œ í˜•ì‹ ì •ë¦¬í•´ì„œ í‘œì‹œ
			    	  document.getElementById("detailStartTime").textContent = 
			    	    new Intl.DateTimeFormat('ko-KR', options).format(new Date(event.start));

			    	  document.getElementById("detailEndTime").textContent = 
			    	    new Intl.DateTimeFormat('ko-KR', options).format(new Date(event.end));
			    	  
			    	  
			    	  


			    	  // ëª¨ë‹¬ ì—´ê¸°
			    	  const modalElement = document.getElementById('vehicleDetailModal');
			    	  if (modalElement) {
			    	    const modal = new bootstrap.Modal(modalElement);
			    	    modal.show();
			    	  } else {
			    	    console.error("ëª¨ë‹¬ì´ ì—†ìŠµë‹ˆë‹¤.");
			    	  }
			    	},
			      eventDidMount: function(info) {
			    	  const el = info.el;
			    	  const isHoliday = info.event.extendedProps.type === "holiday";

			    	  // ê³µíœ´ì¼ì¼ ê²½ìš°
			    	  if (isHoliday) {
			    	    el.style.setProperty("background-color", "#FFF8B3", "important"); // ì—°ë…¸ë‘
			    	    el.style.setProperty("border", "1px solid #F5E79E", "important");
			    	    el.style.setProperty("color", "#4B4B4B", "important");
			    	    el.style.setProperty("pointer-events", "none", "important"); // í´ë¦­ ë§‰ê¸°
			    	    el.style.setProperty("opacity", "1", "important");

			    	    // ê³µí†µ ìŠ¤íƒ€ì¼ ì ìš© 
			    	    el.style.setProperty("font-size", "9px", "important");
			    	    el.style.setProperty("font-weight", "400", "important");
			    	    el.style.setProperty("padding", "0 2px", "important");
			    	    el.style.setProperty("margin", "1px 0", "important");
			    	    el.style.setProperty("border-radius", "2px", "important");
			    	    el.style.setProperty("height", "auto", "important");
			    	    el.style.setProperty("white-space", "nowrap", "important");
			    	    el.style.setProperty("overflow", "hidden", "important");
			    	    el.style.setProperty("text-overflow", "ellipsis", "important");

			    	    const eventMain = el.querySelector(".fc-event-main");
			    	    if (eventMain) {
			    	      eventMain.style.setProperty("white-space", "nowrap", "important");
			    	      eventMain.style.setProperty("overflow", "hidden", "important");
			    	      eventMain.style.setProperty("text-overflow", "ellipsis", "important");
			    	      eventMain.style.setProperty("font-size", "9px", "important");
			    	    }

			    	    return;
			    	  }

			    	  //ì¼ë°˜ ì´ë²¤íŠ¸ ìŠ¤íƒ€ì¼ (ì´ˆìŠ¬ë¦¼ ê³µí†µ ì ìš©)
			    	  el.style.setProperty("font-size", "9px", "important");
			    	  el.style.setProperty("font-weight", "400", "important");
			    	  el.style.setProperty("padding", "0 2px", "important");
			    	  el.style.setProperty("margin", "1px 0", "important");
			    	  el.style.setProperty("border-radius", "2px", "important");
			    	  el.style.setProperty("height", "auto", "important");
			    	  el.style.setProperty("white-space", "nowrap", "important");
			    	  el.style.setProperty("overflow", "hidden", "important");
			    	  el.style.setProperty("text-overflow", "ellipsis", "important");

			    	  const eventMain = el.querySelector(".fc-event-main");
			    	  if (eventMain) {
			    	    eventMain.style.setProperty("white-space", "nowrap", "important");
			    	    eventMain.style.setProperty("overflow", "hidden", "important");
			    	    eventMain.style.setProperty("text-overflow", "ellipsis", "important");
			    	    eventMain.style.setProperty("font-size", "9px", "important");
			    	}
			      }
			  });
			  
			  //ìˆ˜ì • ëª¨ë‹¬ì— ê°’ ì±„ì›Œë„£ê¸° + resvationNo ê¸°ì¤€
			/* document.getElementById("editVehicleBtn").addEventListener("click", function () {
			  const reservationNo = document.getElementById("detailReservationNo").value;
			
			  // ìƒì„¸ ëª¨ë‹¬ ë‹«ê¸°
			  const detailModalEl = document.getElementById("vehicleDetailModal");
			  const detailModal = bootstrap.Modal.getInstance(detailModalEl);
			  if (detailModal) {
			    detailModal.hide();
			  }
			
			  // ì„œë²„ì—ì„œ ìˆ˜ì •í•  ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
			  fetch('/resvehicle/detail/' + reservationNo)
			    .then(response => response.json())
			    .then(data => {
			      // ìˆ˜ì • ëª¨ë‹¬ ë°ì´í„° ì±„ìš°ê¸°
			      document.getElementById("editReservationNo").value = data.reservation_no;
			      document.getElementById("editFacilityNo").value = data.facility_no;
			      document.getElementById("editLocation").value = data.reservation_location;
			
			      const startDate = data.reservation_start.split("T")[0];
			      const endDate = data.reservation_end.split("T")[0];
			
			      document.getElementById("editStartDate").value = startDate;
			      document.getElementById("editEndDate").value = endDate;
			      document.getElementById("editEndDate").min = startDate; 
			      const today = new Date().toISOString().split("T")[0];
			      document.getElementById("editStartDate").min = today;
			      document.getElementById("editStartTime").value = data.reservation_start.split("T")[1].substring(0, 5);
			      document.getElementById("editEndTime").value = data.reservation_end.split("T")[1].substring(0, 5);

			      //ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
			      const editModal = new bootstrap.Modal(document.getElementById("editVehicleModal"));
			      editModal.show();
			    });
			});
			  
			  //ìˆ˜ì •ìš© ëª¨ë‹¬ì—ì„œ ìˆ˜ì •ì™„ë£Œ ë²„íŠ¼ì„ ëˆŒëŸ¬ UPDATE
			  document.getElementById("editVehicleForm").addEventListener("submit", function (e) {
				  e.preventDefault();

				  // ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
				  const reservationNo = document.getElementById("detailReservationNo").value;
				  const startDate = document.getElementById("editStartDate").value;
				  const startTime = document.getElementById("editStartTime").value;
				  const endDate = document.getElementById("editEndDate").value;
				  const endTime = document.getElementById("editEndTime").value;
				  const locationValue = document.getElementById("editLocation").value.trim();

				  const startDateTime = `${startDate}T${startTime}`;
				  const endDateTime = `${endDate}T${endTime}`;
				  
				  //console.log(reservationNo+"!!!!!!!!!!!!!!!!!!!!!!!!!!");

				  //ëª©ì ì§€ ìœ íš¨ì„± ê²€ì‚¬
				  if (!locationValue) {
				    alert("ëª©ì ì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
				    return;
				  }

				  const now = new Date();
				  const today = now.toISOString().split("T")[0];
				  if (startDate === today) {
				    const startDateTimeObj = new Date(startDateTime);
				    if (startDateTimeObj < now) {
				      alert("ì§€ë‚˜ê°„ ì‹œê°„ìœ¼ë¡œëŠ” ì˜ˆì•½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
				      return;
				    }
				  }

				  //ì‹œê°„ ìœ íš¨ì„± ê²€ì‚¬
				  if (new Date(startDateTime) >= new Date(endDateTime)) {
				    alert("ì¢…ë£Œ ì‹œê°„ì€ ì‹œì‘ ì‹œê°„ ì´í›„ì—¬ì•¼ í•©ë‹ˆë‹¤.");
				    return;
				  }

				  // datetime-local ê°’ hidden inputì— ë„£ê¸°
				  document.getElementById("editCalendarStartTime").value = startDateTime;
				  document.getElementById("editCalendarEndTime").value = endDateTime;

				  // fetch ì „ì†¡
				  const form = e.target;
				  const formData = new FormData(form);

				  fetch("/resvehicle/update/" + reservationNo, {
				    method: "post",
				    headers: {
				      'header': document.querySelector('meta[name="_csrf_header"]').content,
				      'X-CSRF-Token': document.querySelector('meta[name="_csrf"]').content
				    },
				    body: formData
				  })
				    .then(response => response.json())
				    .then(data => {
					   alert(data.res_msg); 
					  if (data.res_code == 200) {
					    location.reload();   
					  } 
					})

				    .catch(error => {
				      console.error("ìˆ˜ì • ì¤‘ ì˜¤ë¥˜:", error);
				      alert("ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
				    });
				}); */
			  	//ì˜ˆì•½ ì‚­ì œ
			  	document.getElementById("deleteVehicleBtn").addEventListener("click", function () {
				    const reservationNo = document.getElementById("detailReservationNo").value;

				    const confirmDelete = confirm("ì°¨ëŸ‰ ì˜ˆì•½ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
				    if (!confirmDelete) return;

				    fetch('/resvehicle/delete/'+reservationNo, {
				      method: "post",
				      headers: {
				        'header': document.querySelector('meta[name="_csrf_header"]').content,
				        'X-CSRF-Token': document.querySelector('meta[name="_csrf"]').content
				      }
				    })
				    .then(response => response.json())
				    .then(data => {
				      alert(data.res_msg);
				      if (data.res_code == 200) {
				        location.reload();
				      }
				    })
				    .catch(error => {
				      console.error("ì‚­ì œ ì¤‘ ì˜¤ë¥˜:", error);
				      alert("ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
				    });
				  });
			  	// setTimeout ì‚¬ìš©
				/* <head>ì— ìˆëŠ” FullCalendar CSS íŒŒì¼ì´ ì•„ì§ ë¡œë“œ ì¤‘ì´ë¼
				ìº˜ë¦°ë”ëŠ” ê·¸ë ¤ì¡Œì§€ë§Œ ìŠ¤íƒ€ì¼ì´ ì ìš©ë˜ì§€ ì•Šì€ ìƒíƒœë¡œ ë‚˜ì™€ë²„ë¦¼. */
			  setTimeout(() => {
			    calendar.render();
			  }, 0); 
			});
		</script>
		
		<!-- ì¹´ì¹´ì˜¤ TMAP -->
		<script>
	      const companyLat = 37.477902;
		  const companyLng = 126.886443;
		  const TMAP_APP_KEY = "";
		
		  function getDistanceFromTmap(address) {
		    const geocoder = new kakao.maps.services.Geocoder();
		    geocoder.addressSearch(address, function (result, status) {
		      if (status === kakao.maps.services.Status.OK) {
		        const userLat = parseFloat(result[0].y);
		        const userLng = parseFloat(result[0].x);
		
		        fetch("https://apis.openapi.sk.com/tmap/routes?version=1", {
		          method: "POST",
		          headers: {
		            "Content-Type": "application/json",
		            "appKey": TMAP_APP_KEY
		          },
		          body: JSON.stringify({
		            startX: companyLng.toString(),
		            startY: companyLat.toString(),
		            endX: userLng.toString(),
		            endY: userLat.toString(),
		            reqCoordType: "WGS84GEO",
		            resCoordType: "WGS84GEO",
		            searchOption: 0
		          })
		        })
		        .then(res => res.json())
		        .then(data => {
		          const distance = data.features[0].properties.totalDistance;
		          const time = data.features[0].properties.totalTime;
		          
		          onAddressSelected(distance, time);
		          
		        });
		      } else {
		        alert("ì£¼ì†Œ ì¢Œí‘œ ëª» ì°¾ì•˜ì–´ ğŸ˜­");
		      }
		    });
		  }
		  
		  function onAddressSelected(distance, time) {
				// ê±°ë¦¬/ì‹œê°„ í‘œì‹œìš© í…ìŠ¤íŠ¸
				const distanceStr = `ğŸš— ${(distance / 1000).toFixed(2)}km ê±°ë¦¬`;
				const timeStr = `â° ${(time / 60).toFixed(1)}ë¶„ ì†Œìš” ì˜ˆìƒ`;

				// ìˆ¨ê²¨ì¡Œë˜ div ë³´ì´ê²Œ í•˜ê¸°
				document.getElementById("distanceInfoBox").style.display = "block";

				// í…ìŠ¤íŠ¸ ì±„ì›Œì£¼ê¸°
				document.getElementById("distanceText").innerText = distanceStr;
				document.getElementById("durationText").innerText = timeStr;
			}
		
		  // ì „ì—­ í•¨ìˆ˜ ë“±ë¡
		  function openPostcode() {
		    new daum.Postcode({
		      oncomplete: function (data) {
		        const address = data.address;
		        document.getElementById("calendarLocation").value = address;
		        document.activeElement.blur();
		        getDistanceFromTmap(address);
		      }
		    }).open();
		  }
		</script>



	</main>
</body>
</html>