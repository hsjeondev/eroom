<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{/include/layout}">
<head>
<meta charset="UTF-8">
<title>íšŒì˜ì‹¤ ëª©ë¡</title>
<style>
.fc-event-main::after {
  display: none !important;
}
</style>
</head>


<body>
	<main class="main" id="top" layout:fragment="content">

		<div class="row">

			<!-- ì™¼ìª½: íšŒì˜ì‹¤ ì˜ˆì•½ ëª©ë¡ + ì˜¤ëŠ˜ ì˜ˆì•½ í˜„í™© -->
			<div class="col-md-6 d-flex flex-column gap-4">

				<!-- íšŒì˜ì‹¤ ì˜ˆì•½ ëª©ë¡ -->
				<div>
					<h5 class="fw-bold">íšŒì˜ì‹¤ ì˜ˆì•½ ëª©ë¡</h5>
					<div id="meetingRoomTable"
						data-list='{"valueNames":["no","room","capacity","date"], "page": 5, "pagination": true}'>
						<div class="table-responsive">
							<table class="table table-striped table-sm fs-9 mb-0 text-center">
								<thead class="text-center align-middle">
									<tr>
										<th class="sort" data-sort="no" style="width: 5%;">ë²ˆí˜¸</th>
										<th class="sort" data-sort="room" style="width: 25%;">íšŒì˜ì‹¤</th>
										<th class="sort" data-sort="capacity" style="width: 20%;">ìˆ˜ìš©
											ì¸ì›</th>
										<th class="sort" data-sort="date" style="width: 20%;">ë“±ë¡ì¼</th>
										<th style="width: 10%;"></th>
									</tr>
								</thead>
								<tbody class="list align-middle">
									<tr th:if="${#lists.isEmpty(list)}">
										<td colspan="5">ë“±ë¡ëœ íšŒì˜ì‹¤ì´ ì—†ìŠµë‹ˆë‹¤ ğŸ˜“</td>
									</tr>
									<tr class="align-middle room-row"
										th:each="result, stat : ${list}">
										<td class="no" th:text="${stat.count}"></td>
										<td class="room" th:text="${result.facilityName}"></td>
										<td class="capacity" th:text="${result.facilityCapacity}"></td>
										<td class="date"
											th:text="${#temporals.format(result.facilityRegDate, 'yy-MM-dd')}"></td>
										<td class="text-end pe-0">
											<button class="btn btn-sm btn-outline-primary"
												data-bs-toggle="modal" data-bs-target="#addEventModal"
												th:attr="data-facility-no=${result.facilityNo}, data-facility-name=${result.facilityName}">
												ì˜ˆì•½í•˜ê¸°</button>
										</td>
									</tr>
								</tbody>
							</table>
						</div>

						<!-- âœ… í˜ì´ì§• -->
						<div class="d-flex justify-content-center mt-3">
							<div class="d-flex">
								<button class="page-link" data-list-pagination="prev">
									<i class="fas fa-chevron-left"></i>
								</button>
								<ul class="mb-0 pagination"></ul>
								<button class="page-link" data-list-pagination="next">
									<i class="fas fa-chevron-right"></i>
								</button>
							</div>
						</div>
					</div>
				</div>

				<!-- ì˜¤ëŠ˜ ì˜ˆì•½ í˜„í™© -->
				<div>
					<h5 class="fw-bold">ì˜¤ëŠ˜ ì˜ˆì•½ í˜„í™©</h5>
					<div class="table-responsive">
						<table class="table table-striped table-sm fs-9 mb-0 text-center">
							<thead class="text-center align-middle">
								<tr>
									<th style="width: 5%;">ë²ˆí˜¸</th>
									<th style="width: 20%;">íšŒì˜ì‹¤</th>
									<th style="width: 20%;">ì˜ˆì•½ì</th>
									<th style="width: 20%;">ì˜ˆì•½ ë‚ ì§œ</th>
									<th style="width: 25%;">ì˜ˆì•½ ì‹œê°„</th>
								</tr>
							</thead>
							<tbody class="align-middle">
								<tr th:if="${#lists.isEmpty(todayReservations)}">
									<td colspan="5">ì˜¤ëŠ˜ ì˜ˆì•½ëœ íšŒì˜ì‹¤ì´ ì—†ìŠµë‹ˆë‹¤ ğŸ˜Š</td>
								</tr>
								<tr th:each="res, stat : ${todayReservations}">
									<td th:text="${stat.count}"></td>
									<td th:text="${res.meetingRoomName}"></td>
									<td th:text="${res.reserverName}"></td>
									<td
										th:text="${#temporals.format(res.reservation_start, 'yyyy-MM-dd')}"></td>
									<td><span
										th:text="${#temporals.format(res.reservation_start, 'HH:mm')}"></span>
										~ <span
										th:text="${#temporals.format(res.reservation_end, 'HH:mm')}"></span>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>

			</div>

			<!-- ì˜¤ë¥¸ìª½: ìº˜ë¦°ë” -->
			<div class="col-md-6">
				<div class="calendar-outline" id="appCalendar"
					style="height: 400px;"></div>
			</div>

		</div>
		
		
		
		
		<div class="modal fade" id="addEventModal" tabindex="-1">
							<div class="modal-dialog modal-dialog-centered">
								<div class="modal-content border border-translucent">
									<form id="addEventForm" autocomplete="off" name="addEventForm">
										<div class="modal-header px-card border-0">
											<h5 class="mb-0 text-body-highlight">íšŒì˜ì‹¤ ì˜ˆì•½</h5>
											<button
												class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 mt-2 me-2 px-2 py-1"
												style="font-size: 0.9rem;" type="button"
												data-bs-dismiss="modal" aria-label="Close">Ã—</button>
										</div>


									

										<!-- ë“±ë¡ ëª¨ë‹¬ì°½ -->
										<div class="modal-body p-4">
											<!-- ìˆ¨ê²¨ì§„ ê°’ë“¤ -->
											<input type="hidden" name="employee_no"
												th:value="${#authentication.principal.employee.employeeNo}" />
											<input type="hidden" name="facility_no" id="modalFacilityNo"
												value="" /> <input type="hidden" name="separator_code"
												value="F001" id="separator"> <input type="hidden"
												name="reservation_creator"
												th:value="${#authentication.principal.employee.employeeId}" />

											<div class="mb-3 text-center">
												<label class="form-label text-primary fw-semibold mb-1"
													for="selectedFacilityName" style="font-size: 1rem;">
													ì„ íƒí•œ íšŒì˜ì‹¤ </label>
												<div class="form-control text-center fw-bold fs-5"
													id="selectedFacilityName"
													style="border: none; background-color: #f8f9fa;">íšŒì˜ì‹¤ì´
													ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</div>
											</div>

											<div class="mb-3">
												<label class="form-label">ì†Œì†</label> <select
													class="form-select" id="departmentSelect">
													<option disabled selected>-- ì†Œì† ì„ íƒ --</option>
													<option th:each="dept : ${structureList}"
														th:value="${dept.separator_code}"
														th:text="${dept.separator_name}"
														th:selected="${dept.separator_name == param.department}">
													</option>
												</select>
											</div>

											<!-- ì°¸ì—¬ì ì„ íƒ -->
											<div class="mb-3">
												<label class="form-label">ì°¸ì—¬ì ì„ íƒ</label>
												<div class="d-flex">
													<select id="employeeSelect" class="form-select me-2"
														style="flex: 1;">
														<option disabled selected>-- ì°¸ì—¬ì ì„ íƒ --</option>
													</select>
													<button type="button" class="btn btn-outline-primary"
														onclick="addParticipant()">ì¶”ê°€</button>
												</div>
											</div>

											<!-- ì„ íƒëœ ì°¸ì—¬ì í‘œì‹œ -->
											<div class="mb-3">
												<label class="form-label">ì„ íƒëœ ì°¸ì—¬ì</label>
												<div id="selectedParticipants"
													class="d-flex flex-wrap gap-1">								
												</div>
											</div>

											<!-- ì‹œê°„ -->
											<div class="row g-2 mb-3">
												<!-- ë‚ ì§œ ì„ íƒ -->
												<div class="row g-2">
													<div class="col">
														<label class="form-label">ì‹œì‘ ë‚ ì§œ</label> <input type="date"
															id="startDate" class="form-control"
															name="reservation_start_date">
													</div>
													<div class="col">
														<label class="form-label">ì¢…ë£Œ ë‚ ì§œ</label> <input type="date"
															id="endDate" class="form-control"
															name="reservation_end_date">
													</div>
												</div>

												<!-- ì‹œê°„ ì„ íƒ -->
												<div class="row g-2 mt-2">
													<div class="col">
														<label class="form-label">ì‹œì‘ ì‹œê°„</label> <select
															id="startTime" class="form-select" name="startTime">
															<option value="09:00">09:00</option>
															<option value="10:00">10:00</option>
															<option value="11:00">11:00</option>
															<option value="12:00">12:00</option>
															<option value="13:00">13:00</option>
															<option value="14:00">14:00</option>
															<option value="15:00">15:00</option>
															<option value="16:00">16:00</option>
															<option value="17:00">17:00</option>
														</select>
													</div>
													<div class="col">
														<label class="form-label">ì¢…ë£Œ ì‹œê°„</label> <select
															id="endTime" class="form-select" name="endTime">
															<option value="10:00">10:00</option>
															<option value="11:00">11:00</option>
															<option value="12:00">12:00</option>
															<option value="13:00">13:00</option>
															<option value="14:00">14:00</option>
															<option value="15:00">15:00</option>
															<option value="16:00">16:00</option>
															<option value="17:00">17:00</option>
															<option value="18:00">18:00</option>
															<option value="19:00">19:00</option>
															<option value="20:00">20:00</option>
															<option value="21:00">21:00</option>
															<option value="22:00">22:00</option>
															<option value="23:00">23:00</option>
														</select>
													</div>
												</div>
												
												

												<!-- ìˆ¨ê²¨ì„œ ì„œë²„ë¡œ ë³´ë‚¼ datetime-local ê°’ -->
												<input type="hidden" name="reservation_start"
													id="calendarStartTime"> <input type="hidden"
													name="reservation_end" id="calendarEndTime">
											</div>
										</div>
										<div class="modal-body p-4">

											<div class="alert text-center mb-3" role="alert"
												style="font-size: 0.9rem; background-color: #E3F2FD; border: 1px solid #BBDEFB; color: #0D47A1;">
												â„¹ï¸ <strong>ì˜ˆì•½ í™•ì • í›„ì—ëŠ” ì‹œê°„ ìˆ˜ì •ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.</strong><br> ë³€ê²½ì´
												í•„ìš”í•  ê²½ìš° <strong>ê¸°ì¡´ ì˜ˆì•½ì„ ì·¨ì†Œ</strong>í•œ ë’¤ ë‹¤ì‹œ ì˜ˆì•½í•´ì£¼ì„¸ìš”.<br>
												<br> ğŸ¢ <strong>íšŒì˜ì‹¤ì€ ë‹¤ìŒ ì´ìš©ìì™€ì˜ ì›í™œí•œ ì´ìš©ì„ ìœ„í•´</strong><br>
												<strong>ì‚¬ìš© ì¢…ë£Œ ì‹œê°„ì„ ë°˜ë“œì‹œ ì§€ì¼œì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.</strong><br>
												<br> ì‹ ì¤‘í•˜ê²Œ ì˜ˆì•½í•˜ê³ , <strong>ì •ì‹œì— ì¢…ë£Œ</strong>í•´ ì£¼ì„¸ìš” ğŸ˜Š
											</div>
										</div>

											<div class="modal-footer border-0 px-4 pb-3">
												<button class="btn btn-primary w-100" type="submit">
													ì˜ˆì•½í•˜ê¸°</button>
											</div>
									</form>
								</div>
							</div>
						</div>
						
						
						<script>
							document.addEventListener("DOMContentLoaded", function () {
							  const modal = document.getElementById("addEventModal");
							  const form = document.forms["addEventForm"];
							  const facilityInput = document.getElementById("modalFacilityNo");
							  const submitBtn = form.querySelector('button[type="submit"]');
							
							  if (!modal || !form) return;
							
							  // ëª¨ë‹¬ ì—´ë¦´ ë•Œ ì´ˆê¸°í™”
							  modal.addEventListener("show.bs.modal", function (event) {
							    form.reset();
							    const selectedParticipants = document.getElementById('selectedParticipants');
							    if (selectedParticipants) selectedParticipants.innerHTML = '';
							
							    const startDate = document.getElementById('startDate');
							    const endDate = document.getElementById('endDate');
							    const startTime = document.getElementById('startTime');
							    const endTime = document.getElementById('endTime');
							    const calendarStartTime = document.getElementById('calendarStartTime');
							    const calendarEndTime = document.getElementById('calendarEndTime');
							
							    const today = new Date().toISOString().split("T")[0]; // âœ¨ ì˜¤ëŠ˜ ë‚ ì§œ êµ¬í•˜ê¸°
							
							    if (startDate) {
							      startDate.value = today;    // âœ¨ ì‹œì‘ë‚ ì§œ ê¸°ë³¸ê°’ ì„¸íŒ…
							      startDate.min = today;      // âœ¨ ê³¼ê±° ì„ íƒ ê¸ˆì§€
							    }
							    if (endDate) {
							      endDate.value = today;      // âœ¨ ì¢…ë£Œë‚ ì§œ ê¸°ë³¸ê°’ ì„¸íŒ…
							      endDate.min = today;        // âœ¨ ê³¼ê±° ì„ íƒ ê¸ˆì§€
							    }
							    if (startTime) startTime.selectedIndex = 0;
							    if (endTime) endTime.selectedIndex = 0;
							    if (calendarStartTime) calendarStartTime.value = '';
							    if (calendarEndTime) calendarEndTime.value = '';
							
							    const button = event.relatedTarget;
							    const facilityNo = button.getAttribute("data-facility-no");
							    const facilityName = button.getAttribute("data-facility-name");
							
							    facilityInput.value = facilityNo;
							    document.getElementById("selectedFacilityName").textContent = facilityName || "ì°¨ëŸ‰ëª…ì´ ì—†ìŠµë‹ˆë‹¤";
							  });
							
							  // submit ì²˜ë¦¬
							  form.addEventListener("submit", function (e) {
							    e.preventDefault();
							    submitBtn.disabled = true;
							
							    const today = new Date().toISOString().split("T")[0];
							    form.reservation_start_date.min = today;
							    form.reservation_end_date.min = today;
							
							    const participantBadges = document.querySelectorAll('#selectedParticipants .badge');
							    const participantIds = Array.from(participantBadges).map(badge => badge.dataset.id);
							
							    if (participantIds.length === 0) {
							      alert("ì°¸ì—¬ìë¥¼ 1ëª… ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”!");
							      submitBtn.disabled = false;
							      return;
							    }
							
							    const startDate = form.reservation_start_date.value;
							    const endDate = form.reservation_end_date.value;
							    const startTime = form.startTime.value;
							    const endTime = form.endTime.value;
							
							    if (!startDate || !endDate || !startTime || !endTime) {
							      alert("ë‚ ì§œì™€ ì‹œê°„ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”!");
							      submitBtn.disabled = false;
							      return;
							    }
							
							    const fullStart = `${startDate}T${startTime}`;
							    const fullEnd = `${endDate}T${endTime}`;
							
							    if (fullStart >= fullEnd) {
							      alert("ì¢…ë£Œì¼ì‹œëŠ” ì‹œì‘ì¼ì‹œë³´ë‹¤ ëŠ¦ì–´ì•¼ í•©ë‹ˆë‹¤!");
							      submitBtn.disabled = false;
							      return;
							    }
							
							    // ì¤‘ë³µ ì‹œê°„ ê²€ì‚¬
							    const startHour = parseInt(startTime.split(":")[0]);
							    const endHour = parseInt(endTime.split(":")[0]);
							    const bookedHours = [...form.startTime.options]
							      .filter(opt => opt.disabled)
							      .map(opt => parseInt(opt.value.split(":")[0]));
							
							    for (let hour = startHour; hour < endHour; hour++) {
							      if (bookedHours.includes(hour)) {
							        alert("ì„ íƒí•œ ì‹œê°„ ë²”ìœ„ì— ì´ë¯¸ ì˜ˆì•½ëœ ì‹œê°„ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤!");
							        submitBtn.disabled = false;
							        return;
							      }
							    }
							
							    form.calendarStartTime.value = fullStart;
							    form.calendarEndTime.value = fullEnd;
							
							    const payload = new FormData(form);
							    participantIds.forEach(id => payload.append("participants", id));
							
							    fetch('/reservation/meetingroom/reserve', {
							      method: 'POST',
							      headers: {
							        'header': document.querySelector('meta[name="_csrf_header"]').content,
							        'X-CSRF-Token': document.querySelector('meta[name="_csrf"]').content
							      },
							      body: payload
							    })
							    .then(response => response.json())
							    .then(data => {
							      alert(data.res_msg);
							      if (data.res_code == "200") {
							        location.reload();
							      } else {
							        submitBtn.disabled = false;
							      }
							    })
							    .catch(error => {
							      console.error(error);
							      alert("ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ ğŸ˜­");
							      submitBtn.disabled = false;
							    });
							  });
							});
							</script>


					  
					


						<script>
						let isCreateMode = true; // ê¸°ë³¸ì€ ìƒì„± ëª¨ë“œ
						document.addEventListener("DOMContentLoaded", function () {
							  bindDepartmentChange();
							  bindParticipantAdd();
							});
				
						function bindDepartmentChange() {
							  const departmentSelect = document.getElementById("departmentSelect");
							  if (!departmentSelect) return;
							 
							
							  departmentSelect.addEventListener("change", function () {
								  const deptId = this.value;
								  //console.log("ì†Œì† ì„ íƒë¨:", deptId);
							  
							    fetch('/reservation/employees?separator_code=' + encodeURIComponent(deptId))
							      .then(response => response.json())
							      .then(data => {
							    	console.log("ë°›ì•„ì˜¨ ì§ì› ëª©ë¡:", data);
							        const select = document.getElementById('employeeSelect');
							        select.innerHTML = '<option disabled selected>-- ì°¸ì—¬ì ì„ íƒ --</option>';
							        data.forEach(emp => {
							          const option = document.createElement('option');
							          option.value = emp.employee_no;
							          option.text = emp.employee_name;
							          select.appendChild(option);
							        });
							      })
							      .catch(error => console.error('ì§ì› ë¡œë”© ì‹¤íŒ¨:', error));
							  });
							}
							
					// ì°¸ì—¬ì ì¶”ê°€
					function bindParticipantAdd() {
						  const btn = document.querySelector("button[onclick='addParticipant()']");
						  if (!btn) return;
						
						  btn.addEventListener("click", () => {
						    const select = document.getElementById('employeeSelect');
						    const selectedOptions = Array.from(select.selectedOptions);
						
						    if (selectedOptions.length === 0) {
						      alert('ì°¸ì—¬ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
						      return;
						    }
						
						    selectedOptions.forEach(option => {
						      const participantId = option.value;
						      const participantName = option.text;
						
						      // ì¤‘ë³µ ì¶”ê°€ ë°©ì§€
						      if (document.getElementById('participant-' + participantId)) {
						        alert('ì´ë¯¸ ì¶”ê°€ëœ ì°¸ì—¬ìì…ë‹ˆë‹¤.');
						        return;
						      }
						
						      // ë°°ì§€ ìƒì„±
						      const badge = document.createElement('span');
						      badge.className = 'badge badge-phoenix badge-phoenix-secondary me-2 mb-2';
						      badge.id = 'participant-' + participantId;
						      badge.dataset.id = participantId;
						      badge.innerHTML = `
						        ${participantName}
						        <button type="button" class="btn-close ms-1" style="font-size:0.6rem;" onclick="this.parentElement.remove();"></button>
						      `;
						
						      document.getElementById('selectedParticipants').appendChild(badge);
						    });
						
						   
						  });
						}
						
						</script>
						
					

						<!-- íšŒì˜ì‹¤ ì˜ˆì•½ ìƒì„¸ì¡°íšŒ ëª¨ë‹¬ -->
						<div class="modal fade" id="vehicleDetailModal" tabindex="-1"
							aria-labelledby="vehicleDetailModalLabel" aria-hidden="true">
							<div class="modal-dialog modal-dialog-centered">
								<div class="modal-content border border-translucent">
									<div class="modal-header px-card border-0 position-relative">
										<h5 class="mb-0 lh-sm text-body-highlight"
											id="vehicleDetailModalLabel">íšŒì˜ì‹¤ ì˜ˆì•½ ìƒì„¸ì¡°íšŒ</h5>
										<button
											class="btn-close position-absolute top-0 end-0 mt-2 me-2"
											type="button" data-bs-dismiss="modal" aria-label="Close"></button>
									</div>

									<div class="modal-body p-4">
										<input type="hidden" id="detailReservationNo"> <input
											type="hidden" name="reservation_creator" id="loginEmployeeId"
											th:value="${#authentication.principal.employee.employeeId}" />

										<div class="mb-3">
											<strong>íšŒì˜ì‹¤ëª…:</strong> <span id="detailVehicleName"></span>
										</div>
										<div class="mb-3">
											<strong>ì˜ˆì•½ì:</strong> <span id="detailReserverName"></span>
										</div>
										<div class="mb-3">
											<strong>ì°¸ì—¬ì:</strong> <span id="detailLocation"></span>
										</div>
										<div class="mb-3">
											<strong>ì‹œì‘ ì‹œê°„:</strong> <span id="detailStartTime"></span>
										</div>
										<div class="mb-3">
											<strong>ì¢…ë£Œ ì‹œê°„:</strong> <span id="detailEndTime"></span>
										</div>
									</div>

									<div
										class="modal-footer d-flex justify-content-between align-items-center border-0">
										<div class="d-flex">
											<!-- <button class="btn btn-subtle-secondary me-1 mb-1"
						type="button" id="editVehicleBtn">ìˆ˜ì •</button> -->
											<button class="btn btn-outline-info me-1 mb-1" type="button"
												id="deleteVehicleBtn">ì‚­ì œ</button>
										</div>
										<div>
											<button class="btn btn-primary px-4" type="button"
												data-bs-dismiss="modal">í™•ì¸</button>
										</div>
									</div>
								</div>
							</div>
						</div>

						<!-- í˜ì´ì§• -->
	<!-- 					<div class="d-flex justify-content-center mt-3">
							<div class="d-flex">
								<button class="page-link disabled" data-list-pagination="prev"
									disabled>
									<i class="fas fa-chevron-left"></i>
								</button>
								<ul class="mb-0 pagination">
									<li class="active">
										<button class="page" type="button" data-i="1" data-page="5">1</button>
									</li>
								</ul>
								<button class="page-link pe-0" data-list-pagination="next"
									disabled>
									<i class="fas fa-chevron-right"></i>
								</button>
							</div>
						</div>
					</div>
				</div>
			</div>
 -->
		


		
		<!-- ìº˜ë¦°ë” script -->
		<script>
			document.addEventListener('DOMContentLoaded', function () {
			  const calendarEl = document.getElementById('appCalendar');
			  const separator = document.getElementById('separator').value;
			  const loginEmployeeId = document.getElementById("loginEmployeeId").value;
			
			  const calendar = new FullCalendar.Calendar(calendarEl, {
			    initialView: 'listMonth',
			    locale: 'ko',
			    headerToolbar: {
			      left: 'prev,next today',
			      center: 'title',
			      right: ''
			    },
			    buttonText: {
			      today: 'ì˜¤ëŠ˜'
			    },
			    noEventsContent: 'ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤',
			    validRange: {           
			        start: new Date()      
			      },
			    dayMaxEventRows: true,
			    views: {
			      dayGridMonth: {
			        dayMaxEventRows: 3,
			        moreLinkText: "ë”ë³´ê¸°"
			      }
			    },
			    eventSources: [
			      {
			        events: function (fetchInfo, successCallback, failureCallback) {
			          fetch('/meetingroom/list/' + separator)
			            .then(response => response.json())
			            .then(events => successCallback(events))
			            .catch(error => {
			              console.error("íšŒì˜ì‹¤ ì˜ˆì•½ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨", error);
			              failureCallback(error);
			            });
			        }
			      }
			    ],
			    eventDisplay: 'block',
			    dayCellContent: function (info) {
			      return info.date.getDate();
			    },
			    eventClick: function(info) {
			      const event = info.event;
			      const options = {
			        year: 'numeric', month: 'long', day: 'numeric', weekday: 'short',
			        hour: '2-digit', minute: '2-digit', hour12: false
			      };
			
			      const isOwner = loginEmployeeId === event.extendedProps.reservationCreator;
			      document.getElementById("deleteVehicleBtn").style.display = isOwner ? 'inline-block' : 'none';
			
			      document.getElementById("detailReservationNo").value = event.extendedProps.reservation_no || '';
			      document.getElementById("detailVehicleName").textContent = event.extendedProps.meetingRoomName || '';
			      document.getElementById("detailReserverName").textContent = event.extendedProps.reserverName || '';
			      document.getElementById("detailLocation").textContent =
			        (event.extendedProps.participantNames || []).join(', ') || 'ì—†ìŒ';
			
			      document.getElementById("detailStartTime").textContent =
			        new Intl.DateTimeFormat('ko-KR', options).format(new Date(event.start));
			      document.getElementById("detailEndTime").textContent =
			        new Intl.DateTimeFormat('ko-KR', options).format(new Date(event.end));
			
			      const modalElement = document.getElementById('vehicleDetailModal');
			      if (modalElement) {
			        const modal = new bootstrap.Modal(modalElement);
			        modal.show();
			      } else {
			        console.error("ëª¨ë‹¬ì´ ì—†ìŠµë‹ˆë‹¤.");
			      }
			    },
			    eventDidMount: function(info) {
			    	  const el = info.el;
			    	  const eventDate = new Date(info.event.start);
			    	  const today = new Date();

			    	  const isToday = eventDate.getFullYear() === today.getFullYear() &&
			    	                  eventDate.getMonth() === today.getMonth() &&
			    	                  eventDate.getDate() === today.getDate();

			    	  // ê¸°ë³¸ ìŠ¤íƒ€ì¼ ë¨¼ì € ì ìš©
			    	  el.style.setProperty("background-color", "#F9F9F9", "important");
			    	  el.style.setProperty("border", "1px solid #DDD", "important");
			    	  el.style.setProperty("color", "#000", "important");
			    	  el.style.setProperty("font-size", "12px", "important");
			    	  el.style.setProperty("font-weight", "700", "important");
			    	  el.style.setProperty("padding", "6px 10px", "important");
			    	  el.style.setProperty("margin", "4px 0", "important");
			    	  el.style.setProperty("border-radius", "6px", "important");
			    	  el.style.setProperty("box-shadow", "0 2px 5px rgba(0,0,0,0.05)", "important");
			    	  el.style.setProperty("transition", "background-color 0.2s ease", "important");
			    	  el.style.setProperty("white-space", "nowrap", "important");
			    	  el.style.setProperty("overflow", "hidden", "important");
			    	  el.style.setProperty("text-overflow", "ellipsis", "important");

			    	  // ì˜¤ëŠ˜ì´ë©´ ìŠ¤íƒ€ì¼ ë®ì–´ì“°ê¸°
			    	  if (isToday) {
			    		  el.style.setProperty("background-color", "#D6EBFF", "important");  
			    		  el.style.setProperty("border", "2px solid #3399FF", "important");   
			    		  el.style.setProperty("color", "#0D47A1", "important");              
			    		  el.style.setProperty("font-weight", "bold", "important");      
			    	  }

			    	  // hover íš¨ê³¼
			    	  el.addEventListener("mouseenter", function() {
			    	    el.style.backgroundColor = "#EEF6FF";
			    	  });
			    	  el.addEventListener("mouseleave", function() {
			    	    if (isToday) {
			    	      el.style.backgroundColor = "#D6EBFF";  // ì˜¤ëŠ˜ì€ ë‹¤ì‹œ ì—°ë…¹ìƒ‰ ë³µê·€
			    	    } else {
			    	      el.style.backgroundColor = "#F9F9F9";  // ê¸°ë³¸ì€ íšŒìƒ‰ ë³µê·€
			    	    }
			    	  });
			    	}
			  });
			
			  document.getElementById("deleteVehicleBtn").addEventListener("click", function () {
			    const reservationNo = document.getElementById("detailReservationNo").value;
			    const confirmDelete = confirm("íšŒì˜ì‹¤ ì˜ˆì•½ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
			    if (!confirmDelete) return;
			
			    fetch('/meetingroom/delete/' + reservationNo, {
			      method: "post",
			      headers: {
			        'header': document.querySelector('meta[name="_csrf_header"]').content,
			        'X-CSRF-Token': document.querySelector('meta[name="_csrf"]').content
			      }
			    })
			    .then(response => response.json())
			    .then(data => {
			      alert(data.res_msg);
			      if (data.res_code == 200) {
			        location.reload();
			      }
			    })
			    .catch(error => {
			      console.error("ì‚­ì œ ì¤‘ ì˜¤ë¥˜:", error);
			      alert("ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
			    });
			  });
			
			  setTimeout(() => {
			    calendar.render();
			  }, 0);
			});
			</script>

	</main>
</body>
</html>