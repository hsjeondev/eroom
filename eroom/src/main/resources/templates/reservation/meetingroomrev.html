<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{include/layout}">
<head>
<meta charset="UTF-8">
<title>íšŒì˜ì‹¤ ì˜ˆì•½</title>
<style>
/* ì  ì‚¬ë¼ì§€ê²Œ */
.fc-list-event-graphic {
  display: none !important;
}

/* í˜¹ì‹œ ë‚¨ì•„ìˆì„ borderê¹Œì§€ í™•ì‹¤íˆ ì—†ì• ê¸° */
.fc-list-event-graphic {
  border-right: none !important;
}
  .treeview-label-strong {
      font-weight: bold;
      text-decoration: underline;
      color: #007bff;
    }
    .treeview-row {
      pointer-events: none;
    }
    .treeview-text a {
      text-decoration: none !important;
    display: block;
    width: 100%;
    height: 100%;
    padding: 5px 10px;
    }

    .treeview-text summary::marker,
    .treeview-text a::before,
    .treeview-text a::after {
      display: none !important;
      content: none !important;
    }
      .treeview-text {
    cursor: pointer; /* ë§ˆìš°ìŠ¤ ì»¤ì„œë¥¼ í´ë¦­ ê°€ëŠ¥ ëª¨ì–‘ìœ¼ë¡œ ë³€ê²½ */
  }
  
  .treeview-text:hover {
    background-color: #f0f4ff; /* í˜¸ë²„ ì‹œ ì‚´ì§ ìƒ‰ìƒ ë³€í™” */    
}

.treeview-text input[type="checkbox"] {
  display: none;
  }
</style>

</head>


<body>
	<main class="main" id="top" layout:fragment="content">
	

		<div class="row">

			<!-- ì™¼ìª½: íšŒì˜ì‹¤ ì˜ˆì•½ ëª©ë¡ + ì˜¤ëŠ˜ ì˜ˆì•½ í˜„í™© -->
			<div class="col-md-6 d-flex flex-column gap-4">

				<!-- íšŒì˜ì‹¤ ì˜ˆì•½ ëª©ë¡ -->
				<div>
					<h5 class="fw-bold">íšŒì˜ì‹¤ ì˜ˆì•½ ëª©ë¡</h5>
					<div id="meetingRoomTable"
						data-list='{"valueNames":["no","room","capacity","date"], "page": 5, "pagination": true}'>
						<div class="table-responsive">
							<table class="table table-striped table-sm fs-9 mb-0 text-center">
								<thead class="text-center align-middle">
									<tr>
										<th class="sort" data-sort="no" style="width: 5%;">ë²ˆí˜¸</th>
										<th class="sort" data-sort="room" style="width: 25%;">íšŒì˜ì‹¤</th>
										<th class="sort" data-sort="capacity" style="width: 20%;">ìˆ˜ìš©
											ì¸ì›</th>
										<th class="sort" data-sort="date" style="width: 20%;">ë“±ë¡ì¼</th>
										<th style="width: 10%;"></th>
									</tr>
								</thead>
								<tbody class="list align-middle">
									<tr th:if="${#lists.isEmpty(list)}">
										<td colspan="5">ë“±ë¡ëœ íšŒì˜ì‹¤ì´ ì—†ìŠµë‹ˆë‹¤ ğŸ˜“</td>
									</tr>
									<tr class="align-middle room-row"
										th:each="result, stat : ${list}">
										<td class="no" th:text="${stat.count}"></td>
										<td class="room" th:text="${result.facilityName}"></td>
										<td class="capacity" th:text="${result.facilityCapacity}"></td>
										<td class="date"
											th:text="${#temporals.format(result.facilityRegDate, 'yyyy.MM.dd')}"></td>
										<td class="text-end pe-0">
											<button class="btn btn-sm btn-outline-primary"
												data-bs-toggle="modal" data-bs-target="#addEventModal"
												th:attr="data-facility-no=${result.facilityNo}, data-facility-name=${result.facilityName}">
												ì˜ˆì•½í•˜ê¸°</button>
										</td>
									</tr>
								</tbody>
							</table>
						</div>

						<!-- âœ… í˜ì´ì§• -->
						<div class="d-flex justify-content-center mt-3">
							<div class="d-flex">
								<button class="page-link" data-list-pagination="prev">
									<i class="fas fa-chevron-left"></i>
								</button>
								<ul class="mb-0 pagination"></ul>
								<button class="page-link" data-list-pagination="next">
									<i class="fas fa-chevron-right"></i>
								</button>
							</div>
						</div>
					</div>
				</div>

				<!-- ì˜¤ëŠ˜ ì˜ˆì•½ í˜„í™© -->
				<div>
					<h5 class="fw-bold">ì˜¤ëŠ˜ ì˜ˆì•½ í˜„í™©</h5>
					<div class="table-responsive">
						<table class="table table-striped table-sm fs-9 mb-0 text-center">
							<thead class="text-center align-middle">
								<tr>
									<th style="width: 5%;">ë²ˆí˜¸</th>
									<th style="width: 20%;">íšŒì˜ì‹¤</th>
									<th style="width: 20%;">ì˜ˆì•½ì</th>
									<th style="width: 20%;">ì˜ˆì•½ ë‚ ì§œ</th>
									<th style="width: 25%;">ì˜ˆì•½ ì‹œê°„</th>
								</tr>
							</thead>
							<tbody class="align-middle">
								<tr th:if="${#lists.isEmpty(todayReservations)}">
									<td colspan="5">ì˜¤ëŠ˜ ì˜ˆì•½ëœ íšŒì˜ì‹¤ì´ ì—†ìŠµë‹ˆë‹¤ ğŸ˜Š</td>
								</tr>
								<tr th:each="res, stat : ${todayReservations}">
									<td th:text="${stat.count}"></td>
									<td th:text="${res.meetingRoomName}"></td>
									<td th:text="${res.reserverName}"></td>
									<td
										th:text="${#temporals.format(res.reservation_start, 'yyyy.MM.dd')}"></td>
									<td><span
										th:text="${#temporals.format(res.reservation_start, 'HH:mm')}"></span>
										~ <span
										th:text="${#temporals.format(res.reservation_end, 'HH:mm')}"></span>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>

			</div>

			<!-- ì˜¤ë¥¸ìª½: ìº˜ë¦°ë” -->
			<div class="col-md-6">
				<div class="calendar-outline" id="appCalendar"
					style="height: 400px;"></div>
			</div>

		</div>
		
		
		
		
		<div class="modal fade" id="addEventModal" tabindex="-1">
							<div class="modal-dialog modal-dialog-centered">
								<div class="modal-content border border-translucent">
									<form id="addEventForm" autocomplete="off" name="addEventForm">
										<div class="modal-header px-card border-0">
											<h5 class="mb-0 text-body-highlight">íšŒì˜ì‹¤ ì˜ˆì•½</h5>
											<button
												class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 mt-2 me-2 px-2 py-1"
												style="font-size: 0.9rem;" type="button"
												data-bs-dismiss="modal" aria-label="Close">Ã—</button>
										</div>


									

										<!-- ë“±ë¡ ëª¨ë‹¬ì°½ -->
										<div class="modal-body p-4">
											<!-- ìˆ¨ê²¨ì§„ ê°’ë“¤ -->
											<input type="hidden" name="employee_no"
												th:value="${#authentication.principal.employee.employeeNo}" />
											<input type="hidden" name="facility_no" id="modalFacilityNo"
												value="" /> <input type="hidden" name="separator_code"
												value="F001" id="separator"> <input type="hidden"
												name="reservation_creator"
												th:value="${#authentication.principal.employee.employeeId}" />

											<div class="mb-3 text-center">
												<label class="form-label text-primary fw-semibold mb-1"
													for="selectedFacilityName" style="font-size: 1rem;">
													ì„ íƒí•œ íšŒì˜ì‹¤ </label>
												<div class="form-control text-center fw-bold fs-5"
													id="selectedFacilityName"
													style="border: none; background-color: #f8f9fa;">íšŒì˜ì‹¤ì´
													ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</div>
											</div>
											

								<!-- 			<div class="mb-3">
												<label class="form-label">ì†Œì†</label> <select
													class="form-select" id="departmentSelect">
													<option disabled selected>-- ì†Œì† ì„ íƒ --</option>
													<option th:each="dept : ${structureList}"
														th:value="${dept.separator_code}"
														th:text="${dept.separator_name}"
														th:selected="${dept.separator_name == param.department}">
													</option>
												</select>
											</div> -->

											<!-- ì°¸ì—¬ì ì„ íƒ -->
										<!-- 	<div class="mb-3">
												<label class="form-label">ì°¸ì—¬ì ì„ íƒ</label>
												<div class="d-flex">
													<select id="employeeSelect" class="form-select me-2"
														style="flex: 1;">
														<option disabled selected>-- ì°¸ì—¬ì ì„ íƒ --</option>
													</select>
													<button type="button" class="btn btn-outline-primary"
														onclick="addParticipant()">ì¶”ê°€</button>
												</div>
											</div> -->
											
							<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#treeModal">
							  ì°¸ì—¬ì ì„ íƒí•˜ê¸°
							</button>

							<!-- ì„ íƒëœ ì°¸ì—¬ì í‘œì‹œ -->
											<div class="mb-3">
												<label class="form-label">ì„ íƒëœ ì°¸ì—¬ì</label>
												<div id="selectedParticipants"
													class="d-flex flex-wrap gap-1">								
												</div>
											</div>

											<!-- ì‹œê°„ -->
											<div class="row g-2 mb-3">
												<!-- ë‚ ì§œ ì„ íƒ -->
												<div class="row g-2">
													<div class="col">
														<label class="form-label">ì‹œì‘ ë‚ ì§œ</label> <input type="date"
															id="startDate" class="form-control"
															name="reservation_start_date">
													</div>
													<div class="col">
														<label class="form-label">ì¢…ë£Œ ë‚ ì§œ</label> <input type="date"
															id="endDate" class="form-control"
															name="reservation_end_date">
													</div>
												</div>

												<!-- ì‹œê°„ ì„ íƒ -->
												<div class="row g-2 mt-2">
													<div class="col">
														<label class="form-label">ì‹œì‘ ì‹œê°„</label> <select
															id="startTime" class="form-select" name="startTime">
															<option value="09:00">09:00</option>
															<option value="10:00">10:00</option>
															<option value="11:00">11:00</option>
															<option value="12:00">12:00</option>
															<option value="13:00">13:00</option>
															<option value="14:00">14:00</option>
															<option value="15:00">15:00</option>
															<option value="16:00">16:00</option>
															<option value="17:00">17:00</option>
														</select>
													</div>
													<div class="col">
														<label class="form-label">ì¢…ë£Œ ì‹œê°„</label> <select
															id="endTime" class="form-select" name="endTime">
															<option value="10:00">10:00</option>
															<option value="11:00">11:00</option>
															<option value="12:00">12:00</option>
															<option value="13:00">13:00</option>
															<option value="14:00">14:00</option>
															<option value="15:00">15:00</option>
															<option value="16:00">16:00</option>
															<option value="17:00">17:00</option>
															<option value="18:00">18:00</option>
															<option value="19:00">19:00</option>
															<option value="20:00">20:00</option>
															<option value="21:00">21:00</option>
															<option value="22:00">22:00</option>
															<option value="23:00">23:00</option>
														</select>
													</div>
												</div>
												
												

												<!-- ìˆ¨ê²¨ì„œ ì„œë²„ë¡œ ë³´ë‚¼ datetime-local ê°’ -->
												<input type="hidden" name="reservation_start"
													id="calendarStartTime"> <input type="hidden"
													name="reservation_end" id="calendarEndTime">
											</div>
										</div>
										<div class="modal-body p-4">

											<div class="alert text-center mb-3" role="alert"
												style="font-size: 0.9rem; background-color: #E3F2FD; border: 1px solid #BBDEFB; color: #0D47A1;">
												â„¹ï¸ <strong>ì˜ˆì•½ í™•ì • í›„ì—ëŠ” ì‹œê°„ ìˆ˜ì •ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.</strong><br> ë³€ê²½ì´
												í•„ìš”í•  ê²½ìš° <strong>ê¸°ì¡´ ì˜ˆì•½ì„ ì·¨ì†Œ</strong>í•œ ë’¤ ë‹¤ì‹œ ì˜ˆì•½í•´ì£¼ì„¸ìš”.<br>
												<br> ğŸ¢ <strong>íšŒì˜ì‹¤ì€ ë‹¤ìŒ ì´ìš©ìì™€ì˜ ì›í™œí•œ ì´ìš©ì„ ìœ„í•´</strong><br>
												<strong>ì‚¬ìš© ì¢…ë£Œ ì‹œê°„ì„ ë°˜ë“œì‹œ ì§€ì¼œì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.</strong><br>
												<br> ì‹ ì¤‘í•˜ê²Œ ì˜ˆì•½í•˜ê³ , <strong>ì •ì‹œì— ì¢…ë£Œ</strong>í•´ ì£¼ì„¸ìš” ğŸ˜Š
											</div>
										</div>

											<div class="modal-footer border-0 px-4 pb-3">
												<button class="btn btn-primary w-100" type="submit">
													ì˜ˆì•½í•˜ê¸°</button>
											</div>
									</form>
								</div>
							</div>
						</div>
		
		<!-- íŠ¸ë¦¬ êµ¬ì¡° ëª¨ë‹¬ -->
		<div class="modal fade" id="treeModal" tabindex="-1"
			aria-labelledby="treeModalLabel" aria-hidden="true"
			data-bs-focus="false">
			<div class="modal-dialog modal-dialog-centered modal-lg"
				style="max-width: 550px; height: 400px;">
				<div class="modal-content">
					<div class="modal-header bg-light">
						<h5 class="modal-title" id="treeModalLabel">ì¡°ì§ë„ ì„ íƒ</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal"
							aria-label="ë‹«ê¸°"></button>
					</div>

					<div class="modal-body px-4"
						style="height: 400px; overflow-y: auto;">
						<div class="row" style="height: 100%;">
							<div class="col-6">
								<ul class="treeview" id="treeviewTree">
									<li class="treeview-list-item">
										<p class="treeview-text">
											<input type="checkbox"
												class="form-check-input me-2 root-checkbox"
												data-name="ì´ë£¸ ì»´í¼ë‹ˆ" data-no="root"
												onchange="handleCheck(this)" > <a
												href="javascript:void(0);" data-bs-target="#tree-company">
												<span
												class="fa-solid fa-folder treeview-icon text-info-light"></span>
												<span id="eroomCompanySpan"
												class="treeview-label-text fw-bold treeview-label-strong">ì´ë£¸
													ì»´í¼ë‹ˆ</span>
											</a>
										</p>
										<ul class="collapse show treeview-list" id="tree-company">
											<li class="treeview-list-item"
												th:each="dept : ${departmentList}">
												<p class="treeview-text ms-2">
													<input type="checkbox"
														class="form-check-input me-2 dept-checkbox"
														th:attr="data-name=${dept.codeName}, data-no=${dept.separatorCode}"
														onchange="handleCheck(this)"> <a
														href="javascript:void(0);"
														th:attr="data-bs-toggle='collapse', data-bs-target='#dept-'+${dept.separatorCode}">
														<span class="fa-solid fa-folder treeview-icon"></span> <span
														class="treeview-label-text" th:text="${dept.codeName}">ë¶€ì„œëª…</span>
													</a>
												</p>
												<ul class="collapse treeview-list"
													th:id="'dept-'+${dept.separatorCode}">
													<li class="treeview-list-item"
														th:each="team : ${teamMap[dept.codeName]}">
														<p class="treeview-text ms-3">
															<input type="checkbox"
																class="form-check-input me-2 team-checkbox"
																th:attr="data-name=${team.codeName}, data-no=${team.separatorCode}"
																onchange="handleCheck(this)"> <a
																href="javascript:void(0);"
																th:attr="data-bs-toggle='collapse', data-bs-target='#team-'+${team.separatorCode}">
																<span class="fa-solid fa-file-lines treeview-icon"></span>
																<span class="treeview-label-text"
																th:text="${team.codeName}">íŒ€ëª…</span>
															</a>
														</p>
														<ul class="collapse treeview-list"
															th:id="'team-'+${team.separatorCode}">
															<li class="treeview-list-item"
																th:each="emp : ${teamEmployeeMap[team.separatorCode]}">
																<p class="treeview-text ms-4">
																	<input type="checkbox"
																		class="form-check-input me-2 emp-checkbox"
																		th:attr="data-name=${emp.employee_name}, data-no=${emp.employee_no}"
																		onchange="handleCheck(this)"> <span
																		class="fa-solid fa-user treeview-icon"></span> <span
																		class="treeview-label-text"
																		th:text="${emp.employee_name}">ì‚¬ì›ëª…</span>
																</p>
															</li>
														</ul>
													</li>
													<!-- ë¶€ì„œëŠ” ìˆì§€ë§Œ íŒ€ ì—†ëŠ” ì‚¬ëŒ -->
													<li class="treeview-list-item"
														th:each="emp : ${teamEmployeeMap[dept.separatorCode + '_notAssigned']}">
														<p class="treeview-text ms-3">
															<!-- â† ms-4 ì—ì„œ ms-3ìœ¼ë¡œ ë§ì¶°ì¤Œ -->
															<input type="checkbox"
																class="form-check-input me-2 emp-checkbox"
																th:attr="data-name=${emp.employee_name}, data-no=${emp.employee_no}"
																onchange="handleCheck(this)"> <span
																class="fa-solid fa-user treeview-icon"></span> <span
																class="treeview-label-text"
																th:text="${emp.employee_name}">ì‚¬ì›ëª…</span>
														</p>
													</li>
												</ul>
											</li>
										
										</ul>
									</li>
								</ul>
							</div>

							<div class="col-6 d-flex flex-column">
								<!-- [1] ìƒë‹¨ ê³ ì • ì˜ì—­ -->
								<div id="selectedResult"
									class="border bg-white rounded p-2 mb-2 small"
									style="position: sticky; top: 0; z-index: 2; background-color: white;">
									<strong>ì„ íƒí•œ í•­ëª©:</strong>
									<div style="overflow-y: auto; max-height: 270px;"
										id="selectedTags" class="mt-1 flex-wrap gap-2"></div>
								</div>

								<!-- [2] ì¤‘ê°„: ë¹ˆ ì˜ì—­ (ìŠ¤í¬ë¡¤ ì—¬ìœ ) -->
								<div class="flex-grow-1"></div>

								<!-- [3] í•˜ë‹¨ ê³ ì • ì˜ì—­ -->
								<div class="text-end"
									style="position: sticky; bottom: 0; z-index: 2; background-color: white;">
									<button id="clearBtn" class="btn btn-light btn-sm"
										type="button">ë¹„ìš°ê¸°</button>
								</div>
							</div>


						</div>
					</div>

						<div class="modal-footer py-2">
							<button type="button" class="btn btn-light btn-sm"
								data-bs-dismiss="modal">ì·¨ì†Œ</button>
							<button type="button" class="btn btn-primary btn-sm"
								onclick="confirmSelection()">ì„ íƒ ì™„ë£Œ</button>
						</div>
					</div>
				</div>
			</div>
	
		
		<script>
		
			document.addEventListener("DOMContentLoaded", function () {
				  const treeModal = document.getElementById("treeModal");
	
				  if (treeModal) {
				    treeModal.addEventListener("hidden.bs.modal", function () {
				      resetTree(); // ì²´í¬ë°•ìŠ¤, íƒœê·¸ ë“± ì´ˆê¸°í™” í•¨ìˆ˜ í˜¸ì¶œ
				    });
				  }
				});
			function handleCheck(checkbox) {
			  const name = checkbox.getAttribute('data-name');
			  const code = checkbox.getAttribute('data-no');
			  const li = checkbox.closest('li.treeview-list-item');
			  
			  if (name === 'ì´ë£¸ ì»´í¼ë‹ˆ') return;
			
			  if (checkbox.checked) {
			    addTag(name, code);
			    handleHighlight(li);
			  } else {
			    removeTag(code);
			  }
			
			  updateChildren(checkbox, checkbox.checked);
			  updateParents(checkbox);
			}
			
			function updateChildren(checkbox, isChecked) {
				  const li = checkbox.closest('li.treeview-list-item');
				  if (!li) return;
			
				  const descendants = li.querySelectorAll('input[type="checkbox"]');
				  descendants.forEach(child => {
				    if (child !== checkbox) {
				      child.checked = isChecked;
			
				      // í•˜ìœ„ íƒœê·¸ ì œê±° (ìƒìœ„ í´ë¦­ ì‹œ ê¸°ì¡´ í•˜ìœ„ íƒœê·¸ ë‚¨ëŠ” ë¬¸ì œ í•´ê²°)
				      const code = child.getAttribute('data-no');
				      removeTag(code);
				    }
				  });
				}
			
			
			function updateParents(checkbox) {
				  let li = checkbox.closest('li.treeview-list-item');
			
				  while (li) {
				    const parentLi = li.parentElement.closest('li.treeview-list-item');
				    if (!parentLi) break;
			
				    const parentCheckbox = parentLi.querySelector(':scope > .treeview-text input[type="checkbox"]');
				    const childCheckboxes = Array.from(parentLi.querySelectorAll(':scope > ul > li.treeview-list-item > .treeview-text input[type="checkbox"]'));
			
				    const allChecked = childCheckboxes.length > 0 && childCheckboxes.every(cb => cb.checked);
				    const someChecked = childCheckboxes.some(cb => cb.checked);
			
				    if (parentCheckbox) {
				      if (allChecked) {
				        parentCheckbox.checked = true;
			
				        // ìƒìœ„ë§Œ tag
				        const pname = parentCheckbox.getAttribute('data-name');
				        const pcode = parentCheckbox.getAttribute('data-no');
				        addTag(pname, pcode);
			
				        // í•˜ìœ„ tag ì œê±°
				        childCheckboxes.forEach(cb => removeTag(cb.getAttribute('data-no')));
			
				      } else if (someChecked) {
				        parentCheckbox.checked = false;
			
				        // ìƒìœ„ tag ì œê±°
				        const pcode = parentCheckbox.getAttribute('data-no');
				        removeTag(pcode);
			
				        // í•˜ìœ„ ì¤‘ ì²´í¬ëœ ê²ƒë§Œ tag ì¶”ê°€
				        childCheckboxes.forEach(cb => {
				          const cname = cb.getAttribute('data-name');
				          const ccode = cb.getAttribute('data-no');
				          if (cb.checked) addTag(cname, ccode);
				          else removeTag(ccode);
				        });
			
				      } else {
				        parentCheckbox.checked = false;
			
				        // ì „ë¶€ ì œê±°
				        const pcode = parentCheckbox.getAttribute('data-no');
				        removeTag(pcode);
				      }
				    }
			
				    li = parentLi;
				  }
				}
			

				function addTag(label, code) {
					  const tagWrap = document.getElementById("selectedTags");
					  if (document.getElementById(`tag-${code}`)) return;
			
					  // Card ìƒì„±
					  const card = document.createElement("div");
					  card.className = "card mb-2"; // ì—¬ê¸°ì„œ flexëŠ” ì œê±°ë¨
					  card.id = `tag-${code}`;
					  card.name = `tag-${label}`;
					  card.style.borderRadius = "5px";
					  card.style.padding = "8px";
					  card.style.backgroundColor = "#f8f9fa";
					  card.style.display = "block"; // í•œ ì¤„ì”© í‘œì‹œ
			
					  // ì´ë¦„ ë¼ë²¨
					  const labelElement = document.createElement("span");
					  labelElement.textContent = label;
					  card.appendChild(labelElement);
			
					  // ì‚­ì œ ë²„íŠ¼
					  const button = document.createElement("button");
					  button.type = "button";
					  button.className = "btn-close";
					  button.style.float = "right"; // ì˜¤ë¥¸ìª½ ì •ë ¬
					  button.setAttribute("aria-label", "Remove");
					  button.addEventListener("click", () => {
					    card.remove();
					    removeTag(code, true);  // íƒœê·¸ ì‚­ì œ ì‹œ ì²´í¬ë°•ìŠ¤ë„ í•´ì œ
					  });
			
					  card.appendChild(button);
			
					  // Cardë¥¼ ì„ íƒëœ íƒœê·¸ ì»¨í…Œì´ë„ˆì— ì¶”ê°€
					  tagWrap.appendChild(card);
					}
			
				
				function removeTag(code, skipCheckbox = false) {
					  const tag = document.getElementById(`tag-${code}`);
					  if (tag) tag.remove();
			
					  if (!skipCheckbox) return;
			
					  const checkbox = document.querySelector(`input[type="checkbox"][data-no="${code}"]`);
					  if (checkbox && checkbox.checked) {
					    checkbox.checked = false;
					    handleCheck(checkbox); // ì—°ì‡„ ë™ê¸°í™”
					  }
					}
			
			
				function confirmSelection() {
					  const selected = document.querySelectorAll("#selectedTags .card");

					  const result = Array.from(selected).map((el, index) => ({
					    code: el.id.replace('tag-', ''),
					    name: el.name.replace('tag-', ''),
					    step: index + 1
					  }));

					  // ğŸ‘‰ ì°¸ì—¬ì í‘œì‹œ ì˜ì—­ ê°€ì ¸ì˜¤ê¸°
					  const participantBox = document.getElementById("selectedParticipants");
					  participantBox.innerHTML = ''; // ê¸°ì¡´ í•­ëª© ì´ˆê¸°í™”

					  result.forEach(item => {
					    const badge = document.createElement("span");
					    badge.className = "badge badge-phoenix badge-phoenix-secondary me-2 mb-2";
					    badge.dataset.id = item.code;
					    badge.id = 'participant-' + item.code;
					    badge.innerHTML = `
					      ${item.name}
					      <button type="button" class="btn-close ms-1" style="font-size:0.6rem;" onclick="this.parentElement.remove();"></button>
					    `;
					    participantBox.appendChild(badge);
					  });

					  // íŠ¸ë¦¬ ëª¨ë‹¬ ë‹«ê¸°
					  bootstrap.Modal.getInstance(document.getElementById('treeModal')).hide();
					  const addEventModal = new bootstrap.Modal(document.getElementById('addEventModal'));
					  addEventModal.show(); // ğŸ”¥ ì´ê±° ì¶”ê°€í•´ì•¼ ì›ë˜ ëª¨ë‹¬ë¡œ ëŒì•„ê°
					}

					document.addEventListener('DOMContentLoaded', function () {
				
			
				  const tree = document.querySelector('#treeviewTree');

				  tree.addEventListener('click', function (e) {
				    const clickedLi = e.target.closest('li.treeview-list-item');
				    if (!clickedLi) return;

				    // í´ë¦­ëœ ìš”ì†Œê°€ label-text ë˜ëŠ” treeview-textì¼ ë•Œë§Œ ë°˜ì‘
				    if (
				      e.target.classList.contains('treeview-label-text') ||
				      e.target.classList.contains('treeview-text')
				    ) {
				      const checkbox = clickedLi.querySelector('input[type="checkbox"]');
				      if (checkbox) {
				        checkbox.checked = !checkbox.checked;
				        handleCheck(checkbox);
				      }
				    }

				    // ê°•ì¡° íš¨ê³¼
				    handleHighlight(clickedLi);
				  });
				
				});
			
			
			</script>
			
			<!-- ë¹„ìš°ê¸° ë²„íŠ¼ -->
			<script>
				document.getElementById('clearBtn').addEventListener('click', resetTree);
				
				function resetTree() {
					  // 1. ì„ íƒëœ íƒœê·¸ ë¹„ìš°ê¸°
					  document.getElementById('selectedTags').innerHTML = '';
			
					  // 2. ëª¨ë“  ì²´í¬ë°•ìŠ¤ í•´ì œ
					  const checkboxes = document.querySelectorAll('#treeviewTree input[type="checkbox"]');
					  checkboxes.forEach(cb => {
					    cb.checked = false;
					  });
			
					  // 3. ê°•ì¡° ìŠ¤íƒ€ì¼ ì œê±° (ì´ë£¸ ì»´í¼ë‹ˆ ì œì™¸)
					  document.querySelectorAll('.treeview-icon.text-info-light').forEach(el => {
					    // ì´ë£¸ ì»´í¼ë‹ˆ ì œì™¸
					    if (!el.closest('a')?.querySelector('#eroomCompanySpan')) {
					      el.classList.remove('text-info-light');
					    }
					  });
			
					  document.querySelectorAll('.treeview-label-text.treeview-label-strong').forEach(el => {
					    if (el.id !== 'eroomCompanySpan') {
					      el.classList.remove('treeview-label-strong');
					    }
					  });
			
					  // 4. íŠ¸ë¦¬ ì ‘ê¸° (ì´ë£¸ ì»´í¼ë‹ˆ ì œì™¸)
					  document.querySelectorAll('.treeview-list.collapse').forEach(ul => {
					    if (ul.id !== 'tree-company') {
					      ul.classList.remove('show');
					    } else {
					      ul.classList.add('show');
					    }
					  });
					}
			
			
			</script>
			
			<!-- ìƒ‰ìƒ ê°•ì¡° -->
			<script>
			function handleHighlight(li) {
				  if (!li) return; // â—ì˜ˆì™¸ ì²˜ë¦¬
			
				  // ê¸°ì¡´ ê°•ì¡° ì œê±°
				  document.querySelectorAll('.treeview-icon.text-info-light').forEach(el => el.classList.remove('text-info-light'));
				  document.querySelectorAll('.treeview-label-text.treeview-label-strong').forEach(el => el.classList.remove('treeview-label-strong'));
			
				  // í˜„ì¬ ê°•ì¡°
				  const icon = li.querySelector('.treeview-icon');
				  const label = li.querySelector('.treeview-label-text');
				  if (icon) icon.classList.add('text-info-light');
				  if (label) label.classList.add('treeview-label-strong');
			
				  // ìƒìœ„ ê°•ì¡°
				  let currentUl = li.parentElement;
				  while (currentUl && currentUl.classList.contains('treeview-list')) {
				    const parentLi = currentUl.closest('li.treeview-list-item');
				    if (!parentLi) break;
			
				    const parentIcon = parentLi.querySelector('.treeview-icon');
				    const parentLabel = parentLi.querySelector('.treeview-label-text');
				    if (parentIcon) parentIcon.classList.add('text-info-light');
				    if (parentLabel) parentLabel.classList.add('treeview-label-strong');
			
				    currentUl = parentLi.parentElement;
				  }
				}
			
			</script>

		<!-- ì»¤ìŠ¤í…€ ë©”ì‹œì§€ ëª¨ë‹¬ -->
							<div class="modal fade" id="messageModal" tabindex="-1"
								aria-hidden="true">
								<div class="modal-dialog modal-dialog-centered modal-sm">
									<div
										class="modal-content bg-light text-body rounded-3 shadow-lg border border-secondary-light">
										<div class="modal-header border-0">
											<h5 class="modal-title text-dark" id="messageModalTitle">ì•Œë¦¼</h5>
										</div>
										<div class="modal-body text-center">
											<p class="mb-0 text-body" id="messageModalBody">ë©”ì‹œì§€ ë‚´ìš©ì´
												ë“¤ì–´ê°‘ë‹ˆë‹¤.</p>
										</div>
										<div class="modal-footer justify-content-center border-0">
											<button type="button" class="btn btn-primary"
												data-bs-dismiss="modal">í™•ì¸</button>
										</div>
									</div>
								</div>
							</div>
							
							
					
							<script>
							function showMessageModal(message, title = "ì•Œë¦¼", reload = false) {
								  const modalTitle = document.getElementById("messageModalTitle");
								  const modalBody = document.getElementById("messageModalBody");
								  modalTitle.textContent = title;
								  modalBody.textContent = message;

								  const modalEl = document.getElementById("messageModal");
								  const modal = new bootstrap.Modal(modalEl);
								  modal.show();

								  const confirmBtn = modalEl.querySelector('button[data-bs-dismiss="modal"]');

								  // âœ… ê¸°ì¡´ ì´ë²¤íŠ¸ ì œê±°
								  const newBtn = confirmBtn.cloneNode(true);
								  confirmBtn.parentNode.replaceChild(newBtn, confirmBtn);

								  // âœ… reload ì¡°ê±´ ì²˜ë¦¬
								  if (reload) {
								    newBtn.addEventListener("click", () => location.reload());
								  }
								}


								</script>
					
					
					
							<script>
							
							document.addEventListener("DOMContentLoaded", function () {
							  const modal = document.getElementById("addEventModal");
							  const form = document.forms["addEventForm"];
							  const facilityInput = document.getElementById("modalFacilityNo");
							  const submitBtn = form.querySelector('button[type="submit"]');
							
							  if (!modal || !form) return;
							
							  // ëª¨ë‹¬ ì—´ë¦´ ë•Œ ì´ˆê¸°í™”
							  modal.addEventListener("show.bs.modal", function (event) {
							    form.reset();
							    const selectedParticipants = document.getElementById('selectedParticipants');
							   
							
							    const startDate = document.getElementById('startDate');
							    const endDate = document.getElementById('endDate');
							    const startTime = document.getElementById('startTime');
							    const endTime = document.getElementById('endTime');
							    const calendarStartTime = document.getElementById('calendarStartTime');
							    const calendarEndTime = document.getElementById('calendarEndTime');
							
							    const today = new Date().toISOString().split("T")[0]; // âœ¨ ì˜¤ëŠ˜ ë‚ ì§œ êµ¬í•˜ê¸°
							
							    if (startDate) {
							      startDate.value = today;    //  ì‹œì‘ë‚ ì§œ ê¸°ë³¸ê°’ ì„¸íŒ…
							      startDate.min = today;      //  ê³¼ê±° ì„ íƒ ê¸ˆì§€
							    }
							    if (endDate) {
							      endDate.value = today;      // ì¢…ë£Œë‚ ì§œ ê¸°ë³¸ê°’ ì„¸íŒ…
							      endDate.min = today;        // ê³¼ê±° ì„ íƒ ê¸ˆì§€
							    }
							    if (startTime) startTime.selectedIndex = 0;
							    if (endTime) endTime.selectedIndex = 0;
							    if (calendarStartTime) calendarStartTime.value = '';
							    if (calendarEndTime) calendarEndTime.value = '';
							
							    const button = event.relatedTarget;
							    const facilityNo = button.getAttribute("data-facility-no");
							    const facilityName = button.getAttribute("data-facility-name");
							
							    facilityInput.value = facilityNo;
							    document.getElementById("selectedFacilityName").textContent = facilityName || "ì°¨ëŸ‰ëª…ì´ ì—†ìŠµë‹ˆë‹¤";
							  });
							
							  // submit ì²˜ë¦¬
							 form.addEventListener("submit", function (e) {
							  e.preventDefault();
							  submitBtn.disabled = true;
							
							  const today = new Date().toISOString().split("T")[0];
							  form.reservation_start_date.min = today;
							  form.reservation_end_date.min = today;
							
							
							  const participantBadges = document.querySelectorAll('#selectedParticipants .badge');
							  const participantIds = Array.from(participantBadges).map(badge => badge.dataset.id);
							
							  if (participantIds.length === 0) {
								  showMessageModal("ì°¸ì—¬ìë¥¼ 1ëª… ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”!");
								  submitBtn.disabled = false;
								  return;
								}
							
							  const startDate = form.reservation_start_date.value;
							  const endDate = form.reservation_end_date.value;
							  const startTime = form.startTime.value;
							  const endTime = form.endTime.value;
							
							  if (!startDate || !endDate || !startTime || !endTime) {
							    showMessageModal("ë‚ ì§œì™€ ì‹œê°„ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”!");
							    submitBtn.disabled = false;
							    return;
							  }
							
							  const fullStart = `${startDate}T${startTime}`;
							  const fullEnd = `${endDate}T${endTime}`;
							
							  if (fullStart >= fullEnd) {
							    showMessageModal("ì¢…ë£Œì¼ì‹œëŠ” ì‹œì‘ì¼ì‹œë³´ë‹¤ ëŠ¦ì–´ì•¼ í•©ë‹ˆë‹¤!");
							    submitBtn.disabled = false;
							    return;
							  }
							
							  // ì¤‘ë³µ ì‹œê°„ ê²€ì‚¬
							  const startHour = parseInt(startTime.split(":")[0]);
							  const endHour = parseInt(endTime.split(":")[0]);
							  const bookedHours = [...form.startTime.options]
							    .filter(opt => opt.disabled)
							    .map(opt => parseInt(opt.value.split(":")[0]));
							
							  for (let hour = startHour; hour < endHour; hour++) {
							    if (bookedHours.includes(hour)) {
							      showMessageModal("ì„ íƒí•œ ì‹œê°„ ë²”ìœ„ì— ì´ë¯¸ ì˜ˆì•½ëœ ì‹œê°„ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤!");
							      submitBtn.disabled = false;
							      return;
							    }
							  }
							
							  form.calendarStartTime.value = fullStart;
							  form.calendarEndTime.value = fullEnd;
							
							  const payload = new FormData(form);
							  participantIds.forEach(id => payload.append("participants", id));
							
							  fetch('/reservation/meetingroom/reserve', {
							    method: 'POST',
							    headers: {
							      'header': document.querySelector('meta[name="_csrf_header"]').content,
							      'X-CSRF-Token': document.querySelector('meta[name="_csrf"]').content
							    },
							    body: payload
							  })
							    .then(response => response.json())
							    .then(data => {
							      if (data.res_code == "200") {
							        showMessageModal(data.res_msg || "íšŒì˜ì‹¤ ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.", "ì•Œë¦¼", true); // âœ… í™•ì¸ í›„ ìƒˆë¡œê³ ì¹¨
							      } else {
							        showMessageModal(data.res_msg || "íšŒì˜ì‹¤ ì˜ˆì•½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
							        submitBtn.disabled = false;
							      }
							    })
							    .catch(error => {
							      console.error(error);
							      showMessageModal("ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš” ğŸ˜­");
							      submitBtn.disabled = false;
							    	});
								});
							}); 
							</script>

						<script>
						let isCreateMode = true; // ê¸°ë³¸ì€ ìƒì„± ëª¨ë“œ
						document.addEventListener("DOMContentLoaded", function () {
							  bindDepartmentChange();
							  bindParticipantAdd();
							});
				
						function bindDepartmentChange() {
							  const departmentSelect = document.getElementById("departmentSelect");
							  if (!departmentSelect) return;
							 
							
							  departmentSelect.addEventListener("change", function () {
								  const deptId = this.value;
								  //console.log("ì†Œì† ì„ íƒë¨:", deptId);
							  
							    fetch('/reservation/employees?separator_code=' + encodeURIComponent(deptId))
							      .then(response => response.json())
							      .then(data => {
							    	console.log("ë°›ì•„ì˜¨ ì§ì› ëª©ë¡:", data);
							        const select = document.getElementById('employeeSelect');
							        select.innerHTML = '<option disabled selected>-- ì°¸ì—¬ì ì„ íƒ --</option>';
							        data.forEach(emp => {
							          const option = document.createElement('option');
							          option.value = emp.employee_no;
							          option.text = emp.employee_name;
							          select.appendChild(option);
							        });
							      })
							      .catch(error => console.error('ì§ì› ë¡œë”© ì‹¤íŒ¨:', error));
							  });
							}
							
					// ì°¸ì—¬ì ì¶”ê°€
					function bindParticipantAdd() {
						  const btn = document.querySelector("button[onclick='addParticipant()']");
						  if (!btn) return;
						
						  btn.addEventListener("click", () => {
						    const select = document.getElementById('employeeSelect');
						    const selectedOptions = Array.from(select.selectedOptions);
						
						    if (selectedOptions.length === 0) {
						      alert('ì°¸ì—¬ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
						      return;
						    }
						
						    selectedOptions.forEach(option => {
						      const participantId = option.value;
						      const participantName = option.text;
						
						      // ì¤‘ë³µ ì¶”ê°€ ë°©ì§€
						      if (document.getElementById('participant-' + participantId)) {
						        alert('ì´ë¯¸ ì¶”ê°€ëœ ì°¸ì—¬ìì…ë‹ˆë‹¤.');
						        return;
						      }
						
						      // ë°°ì§€ ìƒì„±
						      const badge = document.createElement('span');
						      badge.className = 'badge badge-phoenix badge-phoenix-secondary me-2 mb-2';
						      badge.id = 'participant-' + participantId;
						      badge.dataset.id = participantId;
						      badge.innerHTML = `
						        ${participantName}
						        <button type="button" class="btn-close ms-1" style="font-size:0.6rem;" onclick="this.parentElement.remove();"></button>
						      `;
						
						      document.getElementById('selectedParticipants').appendChild(badge);
						    });
						
						   
						  });
						  
						}
						
						</script>
						
					

						<!-- íšŒì˜ì‹¤ ì˜ˆì•½ ìƒì„¸ì¡°íšŒ ëª¨ë‹¬ -->
						<div class="modal fade" id="vehicleDetailModal" tabindex="-1"
							aria-labelledby="vehicleDetailModalLabel" aria-hidden="true">
							<div class="modal-dialog modal-dialog-centered">
								<div class="modal-content border border-translucent">
									<div class="modal-header px-card border-0 position-relative">
										<h5 class="mb-0 lh-sm text-body-highlight"
											id="vehicleDetailModalLabel">íšŒì˜ì‹¤ ì˜ˆì•½ ìƒì„¸ì¡°íšŒ</h5>
										<button
											class="btn-close position-absolute top-0 end-0 mt-2 me-2"
											type="button" data-bs-dismiss="modal" aria-label="Close"></button>
									</div>

									<div class="modal-body p-4">
										<input type="hidden" id="detailReservationNo"> <input
											type="hidden" name="reservation_creator" id="loginEmployeeId"
											th:value="${#authentication.principal.employee.employeeId}" />

										<div class="mb-3">
											<strong>íšŒì˜ì‹¤ëª…:</strong> <span id="detailVehicleName"></span>
										</div>
										<div class="mb-3">
											<strong>ì˜ˆì•½ì:</strong> <span id="detailReserverName"></span>
										</div>
										<div class="mb-3">
											<strong>ì°¸ì—¬ì:</strong> <span id="detailLocation"></span>
										</div>
										<div class="mb-3">
											<strong>ì‹œì‘ ì‹œê°„:</strong> <span id="detailStartTime"></span>
										</div>
										<div class="mb-3">
											<strong>ì¢…ë£Œ ì‹œê°„:</strong> <span id="detailEndTime"></span>
										</div>
									</div>

									<div
										class="modal-footer d-flex justify-content-between align-items-center border-0">
										<div class="d-flex">
											<!-- <button class="btn btn-subtle-secondary me-1 mb-1"
						type="button" id="editVehicleBtn">ìˆ˜ì •</button> -->
											<button class="btn btn-outline-info me-1 mb-1" type="button"
												id="deleteVehicleBtn">ì˜ˆì•½ì·¨ì†Œ</button>
										</div>
										<div>
											<button class="btn btn-primary px-4" type="button"
												data-bs-dismiss="modal">í™•ì¸</button>
										</div>
									</div>
								</div>
							</div>
						</div>

				<!-- ì‚­ì œ ëª¨ë‹¬ -->
			<!-- 				<div class="modal fade" id="confirmDeleteModal" tabindex="-1"
								aria-hidden="true">
								<div class="modal-dialog modal-dialog-centered modal-sm">
									<div
										class="modal-content bg-light text-body rounded-3 shadow-lg border border-secondary-light">
									
										<div class="modal-body text-center">
											<p class="mb-0 text-body">
												ì˜ˆì•½ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br>ì·¨ì†Œ í›„ ìë™ìœ¼ë¡œ ìƒˆë¡œê³ ì¹¨ë©ë‹ˆë‹¤.
											</p>
										</div>
										<div class="modal-footer justify-content-center border-0">
											<button type="button" class="btn btn-phoenix-secondary"
												data-bs-dismiss="modal">ì·¨ì†Œ</button>
											<button type="button" class="btn btn-danger" id="confirmDeleteBtn">ì‚­ì œ</button>
										</div>
									</div>
								</div>
							</div> -->


		
		<!-- ìº˜ë¦°ë” script -->
		<script>
			document.addEventListener('DOMContentLoaded', function () {
			  const calendarEl = document.getElementById('appCalendar');
			  const separator = document.getElementById('separator').value;
			  const loginEmployeeId = document.getElementById("loginEmployeeId").value;
			
			  const calendar = new FullCalendar.Calendar(calendarEl, {
			    initialView: 'listMonth',
			    locale: 'ko',
			    headerToolbar: {
			      left: 'prev,next today',
			      center: 'title',
			      right: ''
			    },
			    buttonText: {
			      today: 'ì˜¤ëŠ˜'
			    },
			    noEventsContent: 'ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤',
			    validRange: {           
			        start: new Date()      
			      },
			    dayMaxEventRows: true,
			    views: {
			      dayGridMonth: {
			        dayMaxEventRows: 3,
			        moreLinkText: "ë”ë³´ê¸°"
			      }
			    },
			    eventSources: [
			      {
			        events: function (fetchInfo, successCallback, failureCallback) {
			          fetch('/meetingroom/list/' + separator)
			            .then(response => response.json())
			            .then(events => successCallback(events))
			            .catch(error => {
			              console.error("íšŒì˜ì‹¤ ì˜ˆì•½ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨", error);
			              failureCallback(error);
			            });
			        }
			      }
			    ],
			    eventDisplay: 'block',
			    dayCellContent: function (info) {
			      return info.date.getDate();
			    },
			    eventClick: function(info) {
			      const event = info.event;
			      const options = {
			        year: 'numeric', month: 'long', day: 'numeric', weekday: 'short',
			        hour: '2-digit', minute: '2-digit', hour12: false
			      };
			
			      const isOwner = loginEmployeeId === event.extendedProps.reservationCreator;
			      document.getElementById("deleteVehicleBtn").style.display = isOwner ? 'inline-block' : 'none';
			
			      document.getElementById("detailReservationNo").value = event.extendedProps.reservation_no || '';
			      document.getElementById("detailVehicleName").textContent = event.extendedProps.meetingRoomName || '';
			      document.getElementById("detailReserverName").textContent = event.extendedProps.reserverName || '';
			      document.getElementById("detailLocation").textContent =
			        (event.extendedProps.participantNames || []).join(', ') || 'ì—†ìŒ';
			
			      document.getElementById("detailStartTime").textContent =
			        new Intl.DateTimeFormat('ko-KR', options).format(new Date(event.start));
			      document.getElementById("detailEndTime").textContent =
			        new Intl.DateTimeFormat('ko-KR', options).format(new Date(event.end));
			
			      const modalElement = document.getElementById('vehicleDetailModal');
			      if (modalElement) {
			        const modal = new bootstrap.Modal(modalElement);
			        modal.show();
			      } else {
			        console.error("ëª¨ë‹¬ì´ ì—†ìŠµë‹ˆë‹¤.");
			      }
			    },
			    eventDidMount: function(info) {
			    	  const el = info.el;
			    	  const eventDate = new Date(info.event.start);
			    	  

			    	 
			    	  // ê¸°ë³¸ ìŠ¤íƒ€ì¼ ë¨¼ì € ì ìš©
			    	  el.style.setProperty("background-color", "#F9F9F9", "important");
			    	  el.style.setProperty("border", "1px solid #DDD", "important");
			    	  el.style.setProperty("color", "#000", "important");
			    	  el.style.setProperty("font-size", "12px", "important");
			    	  el.style.setProperty("font-weight", "700", "important");
			    	  el.style.setProperty("padding", "6px 10px", "important");
			    	  el.style.setProperty("margin", "4px 0", "important");
			    	  el.style.setProperty("border-radius", "6px", "important");
			    	  el.style.setProperty("box-shadow", "0 2px 5px rgba(0,0,0,0.05)", "important");
			    	  el.style.setProperty("transition", "background-color 0.2s ease", "important");
			    	  el.style.setProperty("white-space", "nowrap", "important");
			    	  el.style.setProperty("overflow", "hidden", "important");
			    	  el.style.setProperty("text-overflow", "ellipsis", "important");

			    	
			    	 
			    	}
			  });
			
			// ì‚­ì œ ë²„íŠ¼ ëˆ„ë¥´ë©´ ëª¨ë‹¬ ë„ìš°ê¸°
			document.getElementById("deleteVehicleBtn").addEventListener("click", function () {
			  const reservationNo = document.getElementById("detailReservationNo").value;
			
			  const modalEl = document.getElementById("messageModal");
			  const modalTitle = document.getElementById("messageModalTitle");
			  const modalBody = document.getElementById("messageModalBody");
			  const modalBtn = document.querySelector("#messageModal .modal-footer button");
			
			  // 1. í™•ì¸ìš© ë©”ì‹œì§€ ì„¸íŒ…
			  modalTitle.textContent = "ì•Œë¦¼";
			  modalBody.textContent = "ì •ë§ ì˜ˆì•½ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?";
			
			  // 2. ê¸°ì¡´ ë²„íŠ¼ ì´ˆê¸°í™”
			  const newBtn = modalBtn.cloneNode(true);
			  modalBtn.parentNode.replaceChild(newBtn, modalBtn);
			  newBtn.textContent = "í™•ì¸";
			  newBtn.className = "btn btn-primary";
			
			  // 3. í˜¹ì‹œ ë–  ìˆëŠ” ëª¨ë‹¬ ìˆìœ¼ë©´ ë‹«ê¸°
			  document.querySelectorAll(".modal.show").forEach(modalEl => {
			    bootstrap.Modal.getInstance(modalEl)?.hide();
			  });
			
			  // 4. í™•ì¸ ë²„íŠ¼ í´ë¦­ ì‹œ â†’ ëª¨ë‹¬ ë‹«ê³  ì‚­ì œ ì‹¤í–‰
			  newBtn.addEventListener("click", () => {
			    const modalInstance = bootstrap.Modal.getInstance(modalEl);
			    modalInstance.hide();
			
			    // ëª¨ë‹¬ì´ ì™„ì „íˆ ë‹«íŒ í›„ ì‚­ì œ ìš”ì²­
			    modalEl.addEventListener("hidden.bs.modal", () => {
			      fetch('/meetingroom/delete/' + reservationNo, {
			        method: "POST",
			        headers: {
			          'header': document.querySelector('meta[name="_csrf_header"]').content,
			          'X-CSRF-Token': document.querySelector('meta[name="_csrf"]').content
			        }
			      })
			        .then(response => response.json())
			        .then(data => {
			          showMessageModal(data.res_msg || "ì·¨ì†Œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.", "ì•Œë¦¼", true); // í™•ì¸ í›„ ìƒˆë¡œê³ ì¹¨
			        })
			        .catch(error => {
			          console.error("âŒ ì‚­ì œ ì¤‘ ì˜¤ë¥˜:", error);
			          showMessageModal("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.", "ì˜¤ë¥˜");
			        });
			    }, { once: true });
			  });
			
			  // 5. ëª¨ë‹¬ ë„ìš°ê¸°
			  const confirmModal = new bootstrap.Modal(modalEl);
			  confirmModal.show();
			});

			
			  setTimeout(() => {
			    calendar.render();
			  }, 0);
			});
			</script>

	</main>
</body>
</html>