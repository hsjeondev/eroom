<!DOCTYPE html>
<html lang="ko-KR" dir="ltr" data-navigation-type="default"
    data-navbar-horizontal-shape="default"
    xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{/include/layout}">
    <style>
	/* ê¸°ë³¸ ìƒíƒœ: ì˜¤ë¥¸ìª½ ì˜ì—­ì€ íˆ¬ëª…í•˜ê³  ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì•½ê°„ ì´ë™í•œ ìƒíƒœ */
	.tab-pane {
	  opacity: 0;
	  transform: translateX(50px);
	  transition: opacity 0.3s ease, transform 0.3s ease;
	  pointer-events: none;
	}
	
	/* í™œì„±í™”ëœ ìƒíƒœ: í´ë¦­ ì‹œ 'active' í´ë˜ìŠ¤ê°€ ì¶”ê°€ë˜ì–´ ë‚˜íƒ€ë‚¨ */
	.tab-pane.active {
	  opacity: 1;
	  transform: translateX(0);
	  pointer-events: auto;
	}
	
	</style>
<body>
  <main class="main" id="top" layout:fragment="content">
  
   <input type="hidden" id="myEmployeeNo" th:value="${#authentication.principal.employee.employeeNo}">
    <div class="chat d-flex phoenix-offcanvas-container pt-1 mt-n1 mb-9">
      <!-- ì™¼ìª½ ì±„íŒ… ëª©ë¡ ì˜ì—­ -->
      <div class="card p-3 p-xl-1 mt-xl-n1 chat-sidebar me-3 phoenix-offcanvas phoenix-offcanvas-start" id="chat-sidebar">
        <button class="btn d-none d-sm-block d-xl-none mb-2" data-bs-toggle="modal" data-bs-target="#chatSearchBoxModal">
          <span class="fa-solid fa-magnifying-glass text-body-tertiary text-opacity-85 fs-7"></span>
        </button>
        <div class="d-none d-sm-block d-xl-none mb-5">
          <button class="btn w-100 mx-auto" type="button" data-bs-toggle="dropdown" data-boundary="window"
            aria-haspopup="true" aria-expanded="false" data-bs-reference="parent">
            <span class="fa-solid fa-bars text-body-tertiary text-opacity-85 fs-7"></span>
          </button>
          <ul class="dropdown-menu dropdown-menu-end p-0">
            <li><a class="dropdown-item" href="#!">All</a></li>
            <li><a class="dropdown-item" href="#!">Read</a></li>
            <li><a class="dropdown-item" href="#!">Unread</a></li>
          </ul>
        </div>
        <!-- ìƒˆ ì±„íŒ…ë°© ë§Œë“¤ê¸° ë²„íŠ¼ -->
        <div class="d-grid gap-2 mb-3">
          <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#createChatModal">
            + ìƒˆ ì±„íŒ…ë°© ë§Œë“¤ê¸°
          </button>
        </div>
        <!-- ê²€ìƒ‰ ì…ë ¥ë€ -->
        <div class="form-icon-container mb-4 d-sm-none d-xl-block">
          <input class="form-control form-icon-input search" type="text" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" />
          <span class="fas fa-user text-body fs-9 form-icon"></span>
        </div>
        <!-- íƒ­ ë©”ë‰´ (ì „ì²´, ì½ì§€ì•ŠìŒ, ì½ìŒ) -->
        <ul class="nav nav-phoenix-pills mb-5 d-sm-none d-xl-flex"
          id="contactListTab" data-chat-thread-tab="data-chat-thread-tab" role="tablist">
          <li class="nav-item" role="presentation">
            <a class="nav-link cursor-pointer active" data-bs-toggle="tab"
              data-chat-thread-list="all" role="tab" aria-selected="true">ì „ì²´</a>
          </li>
          <li class="nav-item" role="presentation">
            <a class="nav-link cursor-pointer" data-bs-toggle="tab"
              role="tab" data-chat-thread-list="read" aria-selected="false">ì½ì§€ì•ŠìŒ</a>
          </li>
          <li class="nav-item" role="presentation">
            <a class="nav-link cursor-pointer" data-bs-toggle="tab"
              role="tab" data-chat-thread-list="unread" aria-selected="false">ì½ìŒ</a>
          </li>
        </ul>
        <!-- ì±„íŒ… ëª©ë¡ -->
        <div class="scrollbar">
          <div class="tab-content" id="contactListTabContent">
            <div data-chat-thread-tab-content="data-chat-thread-tab-content">
              <ul class="nav chat-thread-tab flex-column list chat_list">
                <!-- ì±„íŒ…ë°©ì´ ì—†ì„ ê²½ìš° -->
                <div th:if="${#lists.isEmpty(chatroomList)}">
                  <p class="text-center text-muted mt-4">ì°¸ì—¬ ì¤‘ì¸ ì±„íŒ…ë°©ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                </div>
                <!-- ì±„íŒ…ë°© ëª©ë¡ -->
                <li th:if="${!#lists.isEmpty(chatroomList)}"
                  th:each="chatroom : ${chatroomList}"
                  th:attr="data-room-no=${chatroom.chatroomNo}"
                  class="nav-item read mb-1 item" role="presentation">
                  <a class="nav-link d-flex align-items-center justify-content-center p-2"
					   th:href="'#chatroom-' + ${chatroom.chatroomNo}"
					   th:attr="data-room-no=${chatroom.chatroomNo}, data-group=${chatroom.chatIsGroupYn}"
					   data-bs-toggle="tab"
					   data-chat-thread="data-chat-thread"
					   role="tab" aria-selected="true">
                    <!-- ì•„ë°”íƒ€ ì´ë¯¸ì§€ -->
                    <div class="avatar avatar-xl status-online position-relative me-2 me-sm-0 me-xl-2">
                      <img class="rounded-circle border border-2 border-light-subtle" src="../assets/img/team/20.webp" alt="" />
                    </div>
                    <div class="flex-1 d-sm-none d-xl-block">
                      <div class="d-flex justify-content-between align-items-center">
                        <h5 th:text="${chatroom.chatroomName}"
                          class="text-body fw-normal name text-nowrap">ì±„íŒ…ë°© ì´ë¦„</h5>
                        <p th:text="${#temporals.format(chatroom.lastMessageRegDate, 'yy.MM.dd')}" 
                        class="fs-10 text-body-tertiary text-opacity-85 mb-0 text-nowrap">ë§ˆì§€ë§‰ ë©”ì‹œì§€ ì‹œê°„</p>
                      </div>
                      <div class="d-flex justify-content-between">
                        <p th:text="${chatroom.chatLastMessage}"
                          class="fs-9 mb-0 line-clamp-1 text-body-tertiary text-opacity-85 message">
                          ë§ˆì§€ë§‰ë©”ì‹œì§€</p>
                      </div>
                    </div>
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      
      <!-- ì±„íŒ…ë°© ìƒì„± ëª¨ë‹¬ -->
      <div class="modal fade" id="createChatModal" tabindex="-1"
        aria-labelledby="createChatModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h3>ìƒˆ ì±„íŒ…ë°© ë§Œë“¤ê¸°</h3>
              <button type="button" class="btn-close" data-bs-dismiss="modal"
                aria-label="ë‹«ê¸°"></button>
            </div>
            <form id="createChatForm">
              <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
              <div class="modal-body">
                <!-- ì±„íŒ… ì¢…ë¥˜ ì„ íƒ -->
                <div class="mb-3">
                  <label class="form-label">ì±„íŒ… ì¢…ë¥˜</label>
                  <div id="chatTypeGroup">
                    <input type="radio" name="chatIsGroupYn" value="N" checked> 1:1 ì±„íŒ…
                    <input type="radio" name="chatIsGroupYn" value="Y"> ê·¸ë£¹ ì±„íŒ…
                  </div>
                </div>
                <div class="mb-3" id="chatroomNameBox">
                  <label class="form-label">ì±„íŒ…ë°© ì´ë¦„</label>
                  <input type="text" id="chatroomName" name="chatroomName" class="form-control"
                    placeholder="ì˜ˆ: ê°œë°œíŒ€ ì±„íŒ…ë°©" readonly>
                </div>
                <!-- ì†Œì† ì„ íƒ -->
                <div class="mb-3">
                  <label class="form-label">ì†Œì†</label>
                  <select class="form-select" id="departmentSelect" onchange="changeDepartment(this.value)">
                    <option disabled selected>-- ì†Œì† ì„ íƒ --</option>
                    <option th:each="dept : ${structureList}" 
                      th:value="${dept.separator_code}" 
                      th:text="${dept.separator_name}" 
                      th:selected="${dept.separator_name == param.department}">
                    </option>
                  </select>
                </div>
                <!-- ì°¸ì—¬ì ì„ íƒ -->
                <div class="mb-3">
                  <label class="form-label">ì°¸ì—¬ì ì„ íƒ</label>
                  <div class="d-flex">
                    <select id="employeeSelect" class="form-select me-2" style="flex:1;">
                      <option disabled selected>-- ì°¸ì—¬ì ì„ íƒ --</option>
                    </select>
                    <button type="button" class="btn btn-outline-primary" onclick="addParticipant()">ì¶”ê°€</button>
                  </div>
                </div>
                <!-- ì„ íƒëœ ì°¸ì—¬ì í‘œì‹œ -->
                <div class="mb-3">
                  <label class="form-label">ì„ íƒëœ ì°¸ì—¬ì</label>
                  <div id="selectedParticipants">
                    <!-- badge í˜•íƒœë¡œ ì¶”ê°€ -->
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                <button type="submit" class="btn btn-primary">ìƒì„±</button>
              </div>
              <div>
                <input type="hidden" name="creater" th:value="${#authentication.principal.employee.employeeNo}">
              </div>
            </form>
          </div>
        </div>
      </div>
      
      <!-- ì˜¤ë¥¸ìª½ ì±„íŒ… ì˜ì—­ (ì„ íƒ ì „ ê¸°ë³¸ í™”ë©´) -->
      <div class="card tab-content flex-1 phoenix-offcanvas-container" id="chat-content">
      
        <div class="tab-pane h-100 fade active show" id="tab-thread-1"
          role="tabpanel" aria-labelledby="tab-thread-1">
          <div class="d-flex flex-column h-100">
            <div id="default-chat-area" class="d-flex flex-column justify-content-center align-items-center h-100">
              <h4 class="text-body-secondary mb-2">ì±„íŒ…ë°©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</h4>
              <a href="#" class="fw-bold text-primary text-decoration-none"
                data-bs-toggle="modal" data-bs-target="#createChatModal">
                ìƒˆ ì±„íŒ…ë°© ë§Œë“¤ê¸°
              </a>
            </div>
          </div>
        </div>
      </div>
      <!-- ì±„íŒ…ë°© ìƒì„¸ ëª¨ë‹¬ -->
		<div class="modal fade" id="chatroomDetailModal" tabindex="-1" aria-labelledby="chatroomDetailModalLabel" aria-hidden="true">
		  <div class="modal-dialog modal-lg modal-dialog-centered">
		    <div class="modal-content">
		      <div class="modal-body">
		        <div class="text-center mb-3">
		          <img src="../assets/img/team/20.webp" class="rounded-circle" width="80" />
		          <h5 id="modalChatroomName" class="mt-2">ì±„íŒ…ë°© ì´ë¦„</h5>
		        </div>
		        <div id="group-only-options">
		        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
			        <ul class="list-unstyled mb-4">
			          <li><font style="vertical-align: inherit;">ì±„íŒ…ë°© ì´ë¦„ ë³€ê²½</font></li>
			          <li><font style="vertical-align: inherit;">ì°¸ì—¬ì ì¶”ê°€í•˜ê¸°</font></li>
			          <li><font style="vertical-align: inherit;">ì±„íŒ…ë°© ì‚­ì œ</font></li>
			        </ul>
			        
		        </div>
		        <div id="participantListBox" class="mb-4">
				  <h6 class="fw-semibold border-bottom border-translucent pb-2 mb-2">ì°¸ì—¬ì</h6>
				  <ul id="participantList" class="list-unstyled mb-0">
				    <!-- ì°¸ì—¬ì ì´ë¦„ë“¤ì´ ì—¬ê¸°ì— ì±„ì›Œì§ˆê±°ì•¼ -->
				  </ul>
				</div>
		        <!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© ìƒì„¸ë³´ê¸° íŒŒì¼  --> 
		        <div class="mb-5">
                      <div class="d-flex"><svg class="svg-inline--fa fa-folder me-3 fs-9" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="folder" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M64 480H448c35.3 0 64-28.7 64-64V160c0-35.3-28.7-64-64-64H288c-10.1 0-19.6-4.7-25.6-12.8L243.2 57.6C231.1 41.5 212.1 32 192 32H64C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64z"></path></svg><!-- <span class="fa-solid fa-folder me-3 fs-9"></span> Font Awesome fontawesome.com -->
                        <div class="flex-1">
                          <h6 class="fw-semibold border-bottom border-translucent pb-2 mb-0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ê³µìœ  íŒŒì¼</font></font></h6>
                          <div class="mb-2">
                            <div class="border-bottom border-translucent d-flex align-items-center justify-content-between"><a class="text-decoration-none d-flex align-items-center py-3" href="#!">
                                <div class="btn-icon btn-icon-lg border rounded-3 text-body-quaternary flex-column me-2"><svg class="svg-inline--fa fa-file-zipper fs-8 mb-1" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="file-zipper" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" data-fa-i2svg=""><path fill="currentColor" d="M64 0C28.7 0 0 28.7 0 64V448c0 35.3 28.7 64 64 64H320c35.3 0 64-28.7 64-64V160H256c-17.7 0-32-14.3-32-32V0H64zM256 0V128H384L256 0zM96 48c0-8.8 7.2-16 16-16h32c8.8 0 16 7.2 16 16s-7.2 16-16 16H112c-8.8 0-16-7.2-16-16zm0 64c0-8.8 7.2-16 16-16h32c8.8 0 16 7.2 16 16s-7.2 16-16 16H112c-8.8 0-16-7.2-16-16zm0 64c0-8.8 7.2-16 16-16h32c8.8 0 16 7.2 16 16s-7.2 16-16 16H112c-8.8 0-16-7.2-16-16zm-6.3 71.8c3.7-14 16.4-23.8 30.9-23.8h14.8c14.5 0 27.2 9.7 30.9 23.8l23.5 88.2c1.4 5.4 2.1 10.9 2.1 16.4c0 35.2-28.8 63.7-64 63.7s-64-28.5-64-63.7c0-5.5 .7-11.1 2.1-16.4l23.5-88.2zM112 336c-8.8 0-16 7.2-16 16s7.2 16 16 16h32c8.8 0 16-7.2 16-16s-7.2-16-16-16H112z"></path></svg><!-- <span class="fs-8 mb-1 fa-solid fa-file-zipper"></span> Font Awesome fontawesome.com -->
                                  <p class="mb-0 fs-10 fw-bold lh-1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ì§€í¼</font></font></p>
                                </div>
                                <div class="flex-1">
                                  <h6 class="text-body line-clamp-1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">í˜ë°ë¦¬ì½”_ê³ ë‹¤ë¥´í”„_ë””ìì¸.zip</font></font></h6>
                                  <div class="d-flex align-items-center lh-1">
                                    <p class="fs-10 mb-0 text-body-tertiary fw-semibold"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">53.34MB</font></font></p><svg class="svg-inline--fa fa-circle text-body-quaternary fs-10" data-fa-transform="shrink-12" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg="" style="transform-origin: 0.5em 0.5em;"><g transform="translate(256 256)"><g transform="translate(0, 0)  scale(0.25, 0.25)  rotate(0 0 0)"><path fill="currentColor" d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512z" transform="translate(-256 -256)"></path></g></g></svg><!-- <span class="fa-solid fa-circle text-body-quaternary fs-10" data-fa-transform="shrink-12"></span> Font Awesome fontawesome.com -->
                                    <p class="fs-10 mb-0 text-body-tertiary fw-semibold"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2011ë…„ 12ì›” 8ì¼</font></font></p>
                                  </div>
                                </div>
                              </a>
                              <button class="btn p-0"><svg class="svg-inline--fa fa-circle-down fs-8 text-body-tertiary" aria-hidden="true" focusable="false" data-prefix="far" data-icon="circle-down" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 464a208 208 0 1 1 0-416 208 208 0 1 1 0 416zM256 0a256 256 0 1 0 0 512A256 256 0 1 0 256 0zM376.9 294.6c4.5-4.2 7.1-10.1 7.1-16.3c0-12.3-10-22.3-22.3-22.3H304V160c0-17.7-14.3-32-32-32l-32 0c-17.7 0-32 14.3-32 32v96H150.3C138 256 128 266 128 278.3c0 6.2 2.6 12.1 7.1 16.3l107.1 99.9c3.8 3.5 8.7 5.5 13.8 5.5s10.1-2 13.8-5.5l107.1-99.9z"></path></svg><!-- <span class="fa-regular fa-arrow-alt-circle-down fs-8 text-body-tertiary"></span> Font Awesome fontawesome.com --></button>
                            </div>
                            <div class="border-bottom border-translucent d-flex align-items-center justify-content-between"><a class="text-decoration-none d-flex align-items-center py-3" href="#!">
                                <div class="btn-icon btn-icon-lg border rounded-3 text-body-quaternary flex-column me-2"><svg class="svg-inline--fa fa-file-code fs-8 mb-1" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="file-code" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" data-fa-i2svg=""><path fill="currentColor" d="M64 0C28.7 0 0 28.7 0 64V448c0 35.3 28.7 64 64 64H320c35.3 0 64-28.7 64-64V160H256c-17.7 0-32-14.3-32-32V0H64zM256 0V128H384L256 0zM153 289l-31 31 31 31c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0L71 337c-9.4-9.4-9.4-24.6 0-33.9l48-48c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9zM265 255l48 48c9.4 9.4 9.4 24.6 0 33.9l-48 48c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l31-31-31-31c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0z"></path></svg><!-- <span class="fs-8 mb-1 fa-solid fa-file-code"></span> Font Awesome fontawesome.com -->
                                  <p class="mb-0 fs-10 fw-bold lh-1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ë°•ì¥</font></font></p>
                                </div>
                                <div class="flex-1">
                                  <h6 class="text-body line-clamp-1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Restart_lyf.bat</font></font></h6>
                                  <div class="d-flex align-items-center lh-1">
                                    <p class="fs-10 mb-0 text-body-tertiary fw-semibold"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.13KB</font></font></p><svg class="svg-inline--fa fa-circle text-body-quaternary fs-10" data-fa-transform="shrink-12" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg="" style="transform-origin: 0.5em 0.5em;"><g transform="translate(256 256)"><g transform="translate(0, 0)  scale(0.25, 0.25)  rotate(0 0 0)"><path fill="currentColor" d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512z" transform="translate(-256 -256)"></path></g></g></svg><!-- <span class="fa-solid fa-circle text-body-quaternary fs-10" data-fa-transform="shrink-12"></span> Font Awesome fontawesome.com -->
                                    <p class="fs-10 mb-0 text-body-tertiary fw-semibold"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2011ë…„ 12ì›” 2ì¼</font></font></p>
                                  </div>
                                </div>
                              </a>
                              <button class="btn p-0"><svg class="svg-inline--fa fa-circle-down fs-8 text-body-tertiary" aria-hidden="true" focusable="false" data-prefix="far" data-icon="circle-down" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 464a208 208 0 1 1 0-416 208 208 0 1 1 0 416zM256 0a256 256 0 1 0 0 512A256 256 0 1 0 256 0zM376.9 294.6c4.5-4.2 7.1-10.1 7.1-16.3c0-12.3-10-22.3-22.3-22.3H304V160c0-17.7-14.3-32-32-32l-32 0c-17.7 0-32 14.3-32 32v96H150.3C138 256 128 266 128 278.3c0 6.2 2.6 12.1 7.1 16.3l107.1 99.9c3.8 3.5 8.7 5.5 13.8 5.5s10.1-2 13.8-5.5l107.1-99.9z"></path></svg><!-- <span class="fa-regular fa-arrow-alt-circle-down fs-8 text-body-tertiary"></span> Font Awesome fontawesome.com --></button>
                            </div>
                            <div class="border-bottom border-translucent d-flex align-items-center justify-content-between"><a class="text-decoration-none d-flex align-items-center py-3" href="#!">
                                <div class="btn-icon btn-icon-lg border rounded-3 text-body-quaternary flex-column me-2"><svg class="svg-inline--fa fa-file-lines fs-8 mb-1" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="file-lines" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" data-fa-i2svg=""><path fill="currentColor" d="M64 0C28.7 0 0 28.7 0 64V448c0 35.3 28.7 64 64 64H320c35.3 0 64-28.7 64-64V160H256c-17.7 0-32-14.3-32-32V0H64zM256 0V128H384L256 0zM112 256H272c8.8 0 16 7.2 16 16s-7.2 16-16 16H112c-8.8 0-16-7.2-16-16s7.2-16 16-16zm0 64H272c8.8 0 16 7.2 16 16s-7.2 16-16 16H112c-8.8 0-16-7.2-16-16s7.2-16 16-16zm0 64H272c8.8 0 16 7.2 16 16s-7.2 16-16 16H112c-8.8 0-16-7.2-16-16s7.2-16 16-16z"></path></svg><!-- <span class="fs-8 mb-1 fa-solid fa-file-lines"></span> Font Awesome fontawesome.com -->
                                  <p class="mb-0 fs-10 fw-bold lh-1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">í…ìŠ¤íŠ¸</font></font></p>
                                </div>
                                <div class="flex-1">
                                  <h6 class="text-body line-clamp-1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ê°€ì§œ lorem ipsum fr fr.txt</font></font></h6>
                                  <div class="d-flex align-items-center lh-1">
                                    <p class="fs-10 mb-0 text-body-tertiary fw-semibold"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.13KB</font></font></p><svg class="svg-inline--fa fa-circle text-body-quaternary fs-10" data-fa-transform="shrink-12" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg="" style="transform-origin: 0.5em 0.5em;"><g transform="translate(256 256)"><g transform="translate(0, 0)  scale(0.25, 0.25)  rotate(0 0 0)"><path fill="currentColor" d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512z" transform="translate(-256 -256)"></path></g></g></svg><!-- <span class="fa-solid fa-circle text-body-quaternary fs-10" data-fa-transform="shrink-12"></span> Font Awesome fontawesome.com -->
                                    <p class="fs-10 mb-0 text-body-tertiary fw-semibold"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2011ë…„ 12ì›” 2ì¼</font></font></p>
                                  </div>
                                </div>
                              </a>
                              <button class="btn p-0"><svg class="svg-inline--fa fa-circle-down fs-8 text-body-tertiary" aria-hidden="true" focusable="false" data-prefix="far" data-icon="circle-down" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 464a208 208 0 1 1 0-416 208 208 0 1 1 0 416zM256 0a256 256 0 1 0 0 512A256 256 0 1 0 256 0zM376.9 294.6c4.5-4.2 7.1-10.1 7.1-16.3c0-12.3-10-22.3-22.3-22.3H304V160c0-17.7-14.3-32-32-32l-32 0c-17.7 0-32 14.3-32 32v96H150.3C138 256 128 266 128 278.3c0 6.2 2.6 12.1 7.1 16.3l107.1 99.9c3.8 3.5 8.7 5.5 13.8 5.5s10.1-2 13.8-5.5l107.1-99.9z"></path></svg><!-- <span class="fa-regular fa-arrow-alt-circle-down fs-8 text-body-tertiary"></span> Font Awesome fontawesome.com --></button>
                            </div>
                            <div class="border-bottom border-translucent d-flex align-items-center justify-content-between"><a class="text-decoration-none d-flex align-items-center py-3" href="#!">
                                <div class="btn-icon btn-icon-lg border rounded-3 text-body-quaternary flex-column me-2"><svg class="svg-inline--fa fa-file-circle-exclamation fs-8 mb-1" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="file-circle-exclamation" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" data-fa-i2svg=""><path fill="currentColor" d="M0 64C0 28.7 28.7 0 64 0H224V128c0 17.7 14.3 32 32 32H384v38.6C310.1 219.5 256 287.4 256 368c0 59.1 29.1 111.3 73.7 143.3c-3.2 .5-6.4 .7-9.7 .7H64c-35.3 0-64-28.7-64-64V64zm384 64H256V0L384 128zm48 96a144 144 0 1 1 0 288 144 144 0 1 1 0-288zm0 240a24 24 0 1 0 0-48 24 24 0 1 0 0 48zm0-192c-8.8 0-16 7.2-16 16v80c0 8.8 7.2 16 16 16s16-7.2 16-16V288c0-8.8-7.2-16-16-16z"></path></svg><!-- <span class="fs-8 mb-1 fa-solid fa-file-circle-exclamation"></span> Font Awesome fontawesome.com -->
                                  <p class="mb-0 fs-10 fw-bold lh-1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ë¯¸ì¹œ</font></font></p>
                                </div>
                                <div class="flex-1">
                                  <h6 class="text-body line-clamp-1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ì§€ì›ë˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.mad</font></font></h6>
                                  <div class="d-flex align-items-center lh-1">
                                    <p class="fs-10 mb-0 text-body-tertiary fw-semibold"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.13KB</font></font></p><svg class="svg-inline--fa fa-circle text-body-quaternary fs-10" data-fa-transform="shrink-12" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg="" style="transform-origin: 0.5em 0.5em;"><g transform="translate(256 256)"><g transform="translate(0, 0)  scale(0.25, 0.25)  rotate(0 0 0)"><path fill="currentColor" d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512z" transform="translate(-256 -256)"></path></g></g></svg><!-- <span class="fa-solid fa-circle text-body-quaternary fs-10" data-fa-transform="shrink-12"></span> Font Awesome fontawesome.com -->
                                    <p class="fs-10 mb-0 text-body-tertiary fw-semibold"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2011ë…„ 12ì›” 2ì¼</font></font></p>
                                  </div>
                                </div>
                              </a>
                              <button class="btn p-0"><svg class="svg-inline--fa fa-circle-down fs-8 text-body-tertiary" aria-hidden="true" focusable="false" data-prefix="far" data-icon="circle-down" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 464a208 208 0 1 1 0-416 208 208 0 1 1 0 416zM256 0a256 256 0 1 0 0 512A256 256 0 1 0 256 0zM376.9 294.6c4.5-4.2 7.1-10.1 7.1-16.3c0-12.3-10-22.3-22.3-22.3H304V160c0-17.7-14.3-32-32-32l-32 0c-17.7 0-32 14.3-32 32v96H150.3C138 256 128 266 128 278.3c0 6.2 2.6 12.1 7.1 16.3l107.1 99.9c3.8 3.5 8.7 5.5 13.8 5.5s10.1-2 13.8-5.5l107.1-99.9z"></path></svg><!-- <span class="fa-regular fa-arrow-alt-circle-down fs-8 text-body-tertiary"></span> Font Awesome fontawesome.com --></button>
                            </div>
                          </div><a class="btn btn-link fs-10 p-0" href="#!"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19ê°œ ë” ë³´ê¸°</font></font><svg class="svg-inline--fa fa-chevron-down ms-1" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="chevron-down" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M233.4 406.6c12.5 12.5 32.8 12.5 45.3 0l192-192c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L256 338.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l192 192z"></path></svg><!-- <span class="fa-solid fa-chevron-down ms-1"></span> Font Awesome fontawesome.com --></a>
                        </div>
                      </div>
                    </div>
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
		      </div>
		    </div>
		  </div>
		</div>
      
      
    </div>
	 <script>
	 	let socket = null; 
		let currentReceiverNo = null;
		let isCreateMode = true; // ê¸°ë³¸ì€ ìƒì„± ëª¨ë“œ
		
		document.addEventListener("DOMContentLoaded", () => {
		  bindModalReset(); // ëª¨ë‹¬ ì´ˆê¸°í™”
		  bindChatroomPanelEvents(); // ì±„íŒ…ë°© í´ë¦­ ì´ë²¤íŠ¸
		  bindChatroomRename(); // ì±„íŒ…ë°© ì´ë¦„ ë³€ê²½
		  bindParticipantAddButton(); // ì°¸ì—¬ì ì¶”ê°€ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
		  bindChatroomCreate(); // ì±„íŒ…ë°© ìƒì„± ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
		  bindDepartmentChange(); // ì†Œì† ì„ íƒì‹œ ì§ì› ëª©ë¡ ë¡œë”©
		  bindParticipantAdd(); // ì°¸ì—¬ì ì¶”ê°€
		  bindChatTypeChange(); // ì±„íŒ… ì¢…ë¥˜ ë³€ê²½ì‹œ
		  bindChatroomDelete(); // ì±„íŒ…ë°© ì‚­ì œ
		  
		});
		
		// ëª¨ë‹¬ ì´ˆê¸°í™” (ì—´ë¦´ ë•Œ ê¸°ë³¸ ë¦¬ì…‹)
		function bindModalReset() {
		  const modal = document.getElementById("createChatModal");
		  if (!modal) return;
		
		  modal.addEventListener("shown.bs.modal", () => {
		    document.getElementById("chatroomName").value = "";
		    document.getElementById("chatroomName").readOnly = true;
		    document.getElementById("selectedParticipants").innerHTML = "";
		    document.getElementById("departmentSelect").selectedIndex = 0;
		    const empSelect = document.getElementById("employeeSelect");
		    empSelect.innerHTML = '<option disabled selected>-- ì°¸ì—¬ì ì„ íƒ --</option>';
		
		    document.getElementById("chatroomNameBox").style.display = isCreateMode ? "block" : "none";
		    document.getElementById("chatTypeGroup").style.display = isCreateMode ? "block" : "none";
		
		    [...document.querySelectorAll('input[name="participantIds"]')].forEach(el => el.remove());
		  });
		}
		
		// ì†Œì† ì„ íƒì‹œ ì§ì› ëª©ë¡ ë¡œë”©
		function bindDepartmentChange() {
		  const departmentSelect = document.getElementById("departmentSelect");
		  if (!departmentSelect) return;
		
		  departmentSelect.addEventListener("change", function () {
		    const deptId = this.value;
		    fetch('/chat/employes?separator_code=' + encodeURIComponent(deptId))
		      .then(response => response.json())
		      .then(data => {
		        const select = document.getElementById('employeeSelect');
		        select.innerHTML = '<option disabled selected>-- ì°¸ì—¬ì ì„ íƒ --</option>';
		        data.forEach(emp => {
		          const option = document.createElement('option');
		          option.value = emp.employee_no;
		          option.text = emp.employee_name;
		          select.appendChild(option);
		        });
		      })
		      .catch(error => console.error('ì§ì› ë¡œë”© ì‹¤íŒ¨:', error));
		  });
		}
		
		// ì°¸ì—¬ì ì¶”ê°€
		function bindParticipantAdd() {
		  const btn = document.querySelector("button[onclick='addParticipant()']");
		  if (!btn) return;
		  btn.addEventListener("click", () => {
		    const isGroupChat = document.querySelector('input[name="chatIsGroupYn"]:checked')?.value === 'Y';
		    const select = document.getElementById('employeeSelect');
		    const selectedOptions = Array.from(select.selectedOptions);
		
		    if (selectedOptions.length === 0) {
		      alert('ì°¸ì—¬ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
		      return;
		    }
		    const currentCount = document.querySelectorAll('#selectedParticipants .badge').length;
		    if(isCreateMode && !isGroupChat && (currentCount + selectedOptions.length > 1)) {
	    	  alert('1:1 ì±„íŒ…ì€ í•œ ëª…ë§Œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
	    	  return;
	    	}
		
		    selectedOptions.forEach(option => {
		      const participantId = option.value;
		      const participantName = option.text;
		      if (document.getElementById('participant-' + participantId)) {
		        alert('ì´ë¯¸ ì¶”ê°€ëœ ì°¸ì—¬ìì…ë‹ˆë‹¤.');
		        return;
		      }
		      const badge = document.createElement('span');
		      badge.className = 'badge badge-phoenix badge-phoenix-secondary me-2 mb-2';
		      badge.id = 'participant-' + participantId;
		      badge.dataset.id = participantId;
		      badge.innerHTML = `
		        ${participantName}
		        <button type="button" class="btn-close ms-1" style="font-size:0.6rem;" onclick="this.parentElement.remove();"></button>
		      `;
		      document.getElementById('selectedParticipants').appendChild(badge);
		
		      if (!isGroupChat) {
		        document.getElementById("chatroomName").value = participantName;
		      }
		    });
		    select.selectedIndex = -1;
		  });
		}
		
		// ì±„íŒ… ì¢…ë¥˜ ë³€ê²½ì‹œ
		function bindChatTypeChange() {
		  const radios = document.querySelectorAll('input[name="chatIsGroupYn"]');
		  if (!radios) return;
		
		  radios.forEach(radio => {
		    radio.addEventListener("change", () => {
		      const isGroup = document.querySelector('input[name="chatIsGroupYn"]:checked').value === 'Y';
		      const chatroomNameInput = document.getElementById("chatroomName");
		      if (isGroup) {
		        chatroomNameInput.value = "";
		        chatroomNameInput.readOnly = false;
		      } else {
		        chatroomNameInput.value = "";
		        chatroomNameInput.readOnly = true;
		        document.getElementById("selectedParticipants").innerHTML = "";
		        document.getElementById("employeeSelect").selectedIndex = 0;
		      }
		    });
		  });
		}
		
		// ì±„íŒ…ë°© ëª©ë¡ í´ë¦­
		function bindChatroomPanelEvents() {
		  document.addEventListener("click", function (e) {
		    const target = e.target.closest('[data-chat-thread]');
		    if (!target) return;
		
		    const chatroomNo = target.dataset.roomNo;
		    const isGroup = target.dataset.group === "Y";
		    const chatroomName = target.querySelector(".name")?.innerText || "ì•Œ ìˆ˜ ì—†ìŒ";
		
		    const defaultArea = document.getElementById("default-chat-area");
		    if (defaultArea) defaultArea.style.display = "none";
		
		    const chatContent = document.getElementById("chat-content");
		    chatContent.innerHTML = `
		      <div class="tab-pane h-100 fade show active d-flex flex-column">
		        <div class="d-flex align-items-center justify-content-between px-4 pt-3">
		          <h4 class="mb-0 chatroom-title cursor-pointer text-primary" data-group="${isGroup ? 'Y' : 'N'}" data-room-no="${chatroomNo}">${chatroomName}</h4>
		        </div>
		        <div class="flex-grow-1 overflow-auto p-4">
		          <div class="chat-history">
		            <hr>
		            <p>ğŸ“© ì±„íŒ… ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</p>
		          </div>
		        </div>
		        <div class="chat-footer border-top p-3 d-flex align-items-center bg-white">
		          <button class="btn btn-light me-2"><i class="fas fa-smile"></i></button>
		          <label for="fileInput" class="btn btn-light me-2"><i class="fa-solid fa-paperclip"></i></label>
		          <input type="file" id="fileInput" style="display: none;">
		          <input class="form-control me-2" type="text" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." id="messageInput">
		          <button class="btn btn-primary" onclick="sendMessage()">ë³´ë‚´ê¸°</button>
		        </div>
		      </div>
		    `;
		    
		    // ì±„íŒ…ë°© í´ë¦­ì‹œ WebSocket ì—°ê²°
		    connectWebSocket(chatroomNo, isGroup);
		    
		    // ìˆ˜ì‹ ì employeeNo ê°€ì ¸ì˜¤ê¸°
		    if (!isGroup) {
			    fetch('/chat/receiver?chatroomNo=' + chatroomNo)
			    .then(response => response.json())
			    .then(data => {
			        console.log("ë°›ì•„ì˜¨ ìˆ˜ì‹ ì ë²ˆí˜¸ : ", data.receiverNo);
			
			        // hidden input ìƒì„± ë˜ëŠ” ì—…ë°ì´íŠ¸
			        let receiverInput = document.getElementById("receiverNo");
			        if (!receiverInput) {
			            receiverInput = document.createElement("input");
			            receiverInput.type = "hidden";
			            receiverInput.id = "receiverNo";
			            document.body.appendChild(receiverInput);
			        }
			        receiverInput.value = data.receiverNo;
			    })
			    .catch(error => {
			        console.error('ìˆ˜ì‹ ì ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
			    });
		    }
		    
		    
		    // ì±„íŒ… ì´ë ¥ ë¶ˆëŸ¬ì˜¤ê¸°
		    loadChatroomDetail(chatroomNo);
		  });

		  document.addEventListener("click", function (e) {
		    const target = e.target.closest(".chatroom-title");
		    if (!target) return;
		
		    document.getElementById("modalChatroomName").innerText = target.innerText;
		    document.getElementById("modalChatroomName").dataset.roomNo = target.dataset.roomNo;
		
		    const groupOptions = document.getElementById("group-only-options");
		    if (groupOptions) groupOptions.style.display = target.dataset.group === "Y" ? "block" : "none";
		    
			// ì°¸ì—¬ì ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
		    const chatroomNo = target.dataset.roomNo;
		    fetch('/chat/participants?chatroomNo=' + encodeURIComponent(chatroomNo))
		      .then(response => response.json())
		      .then(data => {
		        const participantList = document.getElementById('participantList');
		        participantList.innerHTML = ''; // ì´ˆê¸°í™”
		        data.forEach(name => {
		          const li = document.createElement('li');
		          li.textContent = name;
		          participantList.appendChild(li);
		        });
		      })
		      .catch(error => {
		        console.error('ì°¸ì—¬ì ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
		      });
		    
		    const modal = new bootstrap.Modal(document.getElementById("chatroomDetailModal"));
		    modal.show();
		  });
		}
		
		// ì±„íŒ…ë°© ì´ë¦„ ë³€ê²½
		function bindChatroomRename() {
		  const detailModal = document.getElementById("chatroomDetailModal");
		  if (!detailModal) return;
		
		  detailModal.addEventListener("click", function (e) {
		    const li = e.target.closest("li");
		    if (!li || !li.textContent.includes("ì±„íŒ…ë°© ì´ë¦„ ë³€ê²½")) return;
		
		    const nameEl = document.getElementById("modalChatroomName");
		    const chatroomNo = nameEl.dataset.roomNo;
		    const currentName = nameEl.innerText;
		    const newName = prompt("ìƒˆ ì±„íŒ…ë°© ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:", currentName);
		    if (!newName || newName.trim() === "" || newName === currentName) return;
		
		    fetch('/chat/rename', {
		      method: 'POST',
		      headers: {
		        'Content-Type': 'application/json',
		        'X-CSRF-Token': document.querySelector('meta[name="_csrf"]').content
		      },
		      body: JSON.stringify({ chatroomNo, chatroomName: newName })
		    })
		    .then(res => res.json())
		    .then(data => {
		      if (data.res_code === "200") {
		        alert("ì±„íŒ…ë°© ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.");
		        nameEl.innerText = newName;
		        const titleEl = document.querySelector(".chatroom-title");
		        if (titleEl) titleEl.innerText = newName;
		        const sideNameEl = document.querySelector(`[data-room-no="${chatroomNo}"] .name`);
		        if (sideNameEl) sideNameEl.innerText = newName;
		      } else {
		        alert("ë³€ê²½ ì‹¤íŒ¨: " + data.res_msg);
		      }
		    })
		    .catch(err => {
		      console.error("ìš”ì²­ ì‹¤íŒ¨:", err);
		      alert("ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
		    });
		  });
		}
		
		// ì±„íŒ…ë°© ìƒì„±/ì°¸ì—¬ì ì¶”ê°€ submit
		function bindChatroomCreate() {
		  const form = document.getElementById("createChatForm");
		  if (!form) return;
		
		  form.addEventListener("submit", function (e) {
		    e.preventDefault();
		
		    if (isCreateMode) {
		      const isGroupChat = document.querySelector('input[name="chatIsGroupYn"]:checked').value === 'Y';
		      const chatroomName = document.getElementById("chatroomName").value.trim();
		      if (isGroupChat && chatroomName === "") {
		        alert("ì±„íŒ…ë°© ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
		        return;
		      }
		    }
		
		    [...form.querySelectorAll('input[name="participantIds"]')].forEach(el => el.remove());
		    const selectedIds = [...document.querySelectorAll('#selectedParticipants span[data-id]')].map(span => span.dataset.id);
		    if (selectedIds.length === 0) {
		      alert("ì°¸ì—¬ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
		      return;
		    }
		    selectedIds.forEach(id => {
		      const hidden = document.createElement('input');
		      hidden.type = 'hidden';
		      hidden.name = 'participantIds';
		      hidden.value = id;
		      form.appendChild(hidden);
		    });
		
		    const formData = new FormData(form);
		    const url = isCreateMode ? '/chat/create' : '/chat/addParticipants';
		    fetch(url, {
		      method: 'POST',
		      body: formData
		    })
		    .then(res => res.json())
		    .then(data => {
		      if (data.res_code === "200") {
		        alert(data.res_msg);
		        bootstrap.Modal.getInstance(document.getElementById("createChatModal"))?.hide();
		        location.href = "/chat/list";
		      } else {
		        alert("ì˜¤ë¥˜: " + data.res_msg);
		      }
		    })
		    .catch(err => {
		      console.error("ìš”ì²­ ì‹¤íŒ¨:", err);
		      alert("ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
		    });
		  });
		}
		
		// ì°¸ì—¬ì ì¶”ê°€í•˜ê¸° ë²„íŠ¼
		function bindParticipantAddButton() {
		  const detailModal = document.getElementById("chatroomDetailModal");
		  if (!detailModal) return;
		
		  detailModal.addEventListener("click", function (e) {
		    const li = e.target.closest("li");
		    if (!li || !li.textContent.includes("ì°¸ì—¬ì ì¶”ê°€í•˜ê¸°")) return;
		
		    const chatroomNo = document.getElementById("modalChatroomName").dataset.roomNo;
		    if (chatroomNo) {
		      const detailModalInstance = bootstrap.Modal.getInstance(detailModal);
		      detailModalInstance.hide();
		      setTimeout(() => {
		        openParticipantAddModal(chatroomNo);
		      }, 300);
		    }
		  });
		}
		// ì±„íŒ…ë°© ì‚­ì œ
		function bindChatroomDelete() {
          const detailModal = document.getElementById("chatroomDetailModal");
          if (!detailModal) return;
        
          detailModal.addEventListener("click", function (e) {
            const li = e.target.closest("li");
            if (!li || !li.textContent.includes("ì±„íŒ…ë°© ì‚­ì œ")) return;
        
            const chatroomNo = document.getElementById("modalChatroomName").dataset.roomNo;
            if (chatroomNo) {
              if (confirm("ì •ë§ë¡œ ì±„íŒ…ë°©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                fetch('/chat/delete', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-Token': document.querySelector('meta[name="_csrf"]').content
                  },
                  body: JSON.stringify({ chatroomNo })
                })
                .then(res => res.json())
                .then(data => {
                  if (data.res_code === "200") {
                    alert(data.res_msg);
                    location.href = "/chat/list";
                  } else {
                    alert("ì‚­ì œ ì‹¤íŒ¨: " + data.res_msg);
                  }
                })
                .catch(err => {
                  console.error("ìš”ì²­ ì‹¤íŒ¨:", err);
                  alert("ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                });
              }
            }
          });
        }
		
		// ì°¸ì—¬ì ì¶”ê°€ ëª¨ë‹¬ ì—´ê¸°
		function openParticipantAddModal(chatroomNo) {
		  isCreateMode = false;
		  const modal = bootstrap.Modal.getOrCreateInstance(document.getElementById("createChatModal"));
		  modal.show();
		  document.querySelector("#createChatModal h3").innerText = "ì°¸ì—¬ì ì¶”ê°€í•˜ê¸°";
		  document.getElementById("chatroomNameBox").style.display = "none";
		  document.getElementById("chatTypeGroup").style.display = "none";
		
		  let chatroomInput = document.getElementById("chatroomNoInput");
		  if (!chatroomInput) {
		    chatroomInput = document.createElement('input');
		    chatroomInput.type = 'hidden';
		    chatroomInput.name = 'chatroomNo';
		    chatroomInput.id = 'chatroomNoInput';
		    document.getElementById("createChatForm").appendChild(chatroomInput);
		  }
		  chatroomInput.value = chatroomNo;
		
		  modal._element.addEventListener("hidden.bs.modal", () => {
		    isCreateMode = true;
		    document.querySelector("#createChatModal h3").innerText = "ìƒˆ ì±„íŒ…ë°© ë§Œë“¤ê¸°";
		    document.getElementById("chatroomNameBox").style.display = "block";
		    document.getElementById("chatTypeGroup").style.display = "block";
		  }, { once: true });
		}
		
		
		function connectWebSocket(chatroomNo, isGroup) {
		  const senderNo = document.getElementById("myEmployeeNo").value; 

		  if (socket) {
		    socket.onmessage = null;   // ê¸°ì¡´ ì†Œì¼“ì˜ ë©”ì‹œì§€ ë¦¬ìŠ¤ë„ˆë¥¼ ëŠëŠ”ë‹¤
		    socket.onclose = null;     // (ì„ íƒ) ê¸°ì¡´ ì†Œì¼“ì˜ ì¢…ë£Œ ë¦¬ìŠ¤ë„ˆë„ ëŠëŠ”ë‹¤
		    socket.onerror = null;     // (ì„ íƒ) ê¸°ì¡´ ì†Œì¼“ì˜ ì—ëŸ¬ ë¦¬ìŠ¤ë„ˆë„ ëŠëŠ”ë‹¤
		    socket.close();            // ê¸°ì¡´ ì†Œì¼“ ì—°ê²° ë‹«ëŠ”ë‹¤
		  }

		  // socket = new WebSocket('ws://localhost:8080/ws/chat?senderNo=${senderNo}&roomNo=${chatroomNo}');
		  socket = new WebSocket("ws://localhost:8080/ws/chat?senderNo=" + senderNo + "&roomNo=" + chatroomNo);
		  
		  socket.onopen = function() {
		    console.log('WebSocket ì—°ê²° ì„±ê³µ!');
		  };
		  // ë©”ì‹œì§€ ìˆ˜ì‹ 
		  socket.onmessage = function(event) {
		    console.log('ìˆ˜ì‹ í•œ ë©”ì‹œì§€:', event.data);
		    
		    const data = JSON.parse(event.data);
		    const chatHistory = document.querySelector(".chat-history");
		    if (!chatHistory) {
		      console.error("chat-history ì˜ì—­ì´ ì—†ìŠµë‹ˆë‹¤.");
		      return;
		    }

		    // ë‚´ ë©”ì‹œì§€ì¸ì§€ ìƒëŒ€ë°© ë©”ì‹œì§€ì¸ì§€ êµ¬ë¶„
		    const myEmployeeNo = document.getElementById("myEmployeeNo").value;
		    const isMyMessage = data.senderMember == myEmployeeNo;

		    // ë©”ì‹œì§€ ìš”ì†Œ ë§Œë“¤ê¸°
		    const messageDiv = document.createElement("div");
		    messageDiv.className = "mb-2";

		    messageDiv.innerHTML = `
		      <div class="d-flex ${isMyMessage ? 'justify-content-end' : 'justify-content-start'}">
		        <div class="p-2 rounded-2 ${isMyMessage ? 'bg-primary text-white' : 'bg-light'}" style="max-width: 70%;">
		          ${data.chatMessageContent}
		        </div>
		      </div>
		    `;

		    chatHistory.appendChild(messageDiv);

		    // ìŠ¤í¬ë¡¤ ë§¨ ì•„ë˜ë¡œ ë‚´ë¦¬ê¸°
		    const chatArea = document.querySelector(".flex-grow-1.overflow-auto");
		    if (chatArea) {
		      chatArea.scrollTop = chatArea.scrollHeight;
		    }  
		    
		  };

		  socket.onclose = function(event) {
		    console.log('âŒ WebSocket ì—°ê²° ì¢…ë£Œ:', event);
		  };

		  socket.onerror = function(error) {
		    console.error('ğŸš¨ WebSocket ì˜¤ë¥˜ ë°œìƒ:', error);
		  };
		}
		// ë©”ì‹œì§€ ë³´ë‚´ê¸°
		function sendMessage() {
		    const messageInput = document.getElementById("messageInput");
		    const message = messageInput.value.trim();
		    
		    if (!message) {
		        alert("ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
		        return;
		    }
		    
		    const isGroupChat = document.querySelector('.chatroom-title')?.dataset.group === 'Y';
		    const receiverValue = document.getElementById("receiverNo")?.value;
		    const receiverNo = receiverValue && receiverValue !== "undefined" && receiverValue !== "null" ? Number(receiverValue) : null;
		
		    if (!isGroupChat && (receiverNo === null || isNaN(receiverNo))) {
		        alert("ìˆ˜ì‹ ì ì •ë³´ê°€ ì•„ì§ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
		        return;
		    }
		
		    const chatData = {
		        chatMessageContent: message,
		        senderMember: Number(document.getElementById("myEmployeeNo").value),
		        chatroomNo: Number(document.querySelector(".chatroom-title").dataset.roomNo),
		        receiverMember: receiverNo // ê·¸ë£¹ì´ë©´ null, 1:1ì´ë©´ ë²ˆí˜¸
		    };
		
		    console.log("ë³´ë‚´ëŠ” ë°ì´í„°:", chatData);
		    socket.send(JSON.stringify(chatData));
		    messageInput.value = ""; // ë©”ì‹œì§€ ì „ì†¡ í›„ ì…ë ¥ì°½ ë¹„ìš°ê¸°
		}


		
		function loadChatroomDetail(chatroomNo) {
			  fetch('/chat/roomDetail?roomNo=' + chatroomNo)
			    .then(response => response.json())
			    .then(data => {
			      const chatHistory = document.querySelector(".chat-history");
			      if (!chatHistory) return;
			      
			      chatHistory.innerHTML = "<hr>"; // ì´ˆê¸°í™”

			      if (data.messageList && data.messageList.length > 0) {
			        const myEmployeeNo = document.getElementById("myEmployeeNo").value;
					
			        data.messageList.forEach(msg => {
			          const isMyMessage = (msg.senderMember == myEmployeeNo);
			          const messageDiv = document.createElement("div");
			          messageDiv.className = "mb-2";
			          messageDiv.innerHTML = `
			            <div class="d-flex ${isMyMessage ? 'justify-content-end' : 'justify-content-start'}">
			              <div class="p-2 rounded-2 ${isMyMessage ? 'bg-primary text-white' : 'bg-light'}" style="max-width: 70%;">
			                ${msg.chatMessageContent}
			              </div>
			            </div>
			          `;
			          chatHistory.appendChild(messageDiv);
			        });

			        // ìŠ¤í¬ë¡¤ ë§¨ ë°‘ìœ¼ë¡œ
			        const chatArea = document.querySelector(".flex-grow-1.overflow-auto");
			        if (chatArea) {
			          chatArea.scrollTop = chatArea.scrollHeight;
			        }
			      }
			    })
			    .catch(error => {
			      console.error("ì±„íŒ…ë°© ìƒì„¸ ì¡°íšŒ ì‹¤íŒ¨:", error);
			    });
			}

		
		
		
		</script>
	 
	</main>
	
</body>
</html>