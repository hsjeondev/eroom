<!DOCTYPE html>
<html lang="en-US" dir="ltr" data-navigation-type="default" data-navbar-horizontal-shape="default" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{/include/layout}">
<body>
	<main class="main" id="top" layout:fragment="content">
		<div class="d-flex align-items-center gap-2">
			<a th:href="@{/project/all}" class="text-decoration-none text-dark me-2"> <i class="uil uil-angle-left-b fs-4"></i>
			</a>
			<h1 class="text-primary mb-0 fs-4" th:text="${project.project_name}">프로젝트 디테일</h1>
			<span class="badge badge-phoenix fs-10 badge-phoenix-success" th:text="${project.proceed}">completed</span>
		</div>
		<br>
		<ul class="nav nav-phoenix-pills mt-3" role="tablist">
			<li class="nav-item"><a class="nav-link" th:href="@{/project/detail/{id}/main(id=${project.project_no})}" th:classappend="${requestURI.endsWith('/main')} ? ' active' : ''">메인</a></li>
			<li class="nav-item"><a class="nav-link" th:href="@{/project/detail/{id}/developmentTab(id=${project.project_no})}" th:classappend="${requestURI.endsWith('/developmentTab')} ? ' active' : ''">개발</a></li>
			<li class="nav-item"><a class="nav-link" th:href="@{/project/detail/{id}/todo(id=${project.project_no})}" th:classappend="${requestURI.endsWith('/todo')} ? ' active' : ''">할 일</a></li>
			<li class="nav-item"><a class="nav-link" th:href="@{/project/detail/{id}/files(id=${project.project_no})}" th:classappend="${requestURI.endsWith('/files')} ? ' active' : ''">파일</a></li>
			<li class="nav-item"><a class="nav-link" th:href="@{/project/detail/{id}/minutes(id=${project.project_no})}" th:classappend="${requestURI.endsWith('/minutes')} ? ' active' : ''">회의록</a></li>
		</ul>

		<!-- 본문 -->
		<div id="members" data-list='{"valueNames":["customer","email","mobile_number","city","last_active","joined"],"page":15,"pagination":true}'>
			<div class="row align-items-center justify-content-between g-3 mb-4 mt-2">
				<div class="col col-auto">
					<!-- <div class="search-box">
						<form class="position-relative">
							<input class="form-control search-input search" type="search" placeholder="제목 검색" aria-label="Search" /> <span class="fas fa-search search-box-icon"></span>
						</form>
					</div> -->
				</div>
				<div class="col-auto">
					<div class="d-flex align-items-center">
						<!-- <button class="btn btn-link text-body me-4 px-0">
							<span class="fa-solid fa-file-export fs-9 me-2"></span>문서화
						</button> -->
						<th:block th:if="${isProjectMember}">
							<button type="button" class="btn btn-primary" th:onclick="|location.href='/project/minute/create-page?projectNo=${project.project_no}'|">회의록 작성</button>
						</th:block>
					</div>
				</div>
			</div>
			<div class="row g-4">
				<div class="col-md-8">
					<div class="card shadow-sm">
						<div class="card-header bg-light fw-bold">회의록 목록</div>
						<div class="table-responsive scrollbar ms-n1 ps-1">
							<table class="table table-hover table-sm align-middle text-nowrap">
								<thead class="table-light">
									<tr>
										<th class="text-start ps-4 w-40" data-sort="meeting_title">제목</th>
										<th class="text-center w-15" data-sort="participants">참여인원</th>
										<th class="text-center w-15" data-sort="writer">작성자</th>
										<th class="text-center pe-1 w-30" data-sort="meeting_date">회의일</th>
										<th></th>
									</tr>
								</thead>
								<tbody class="list" id="members-table-body">
									<tr th:each="minute : ${minutes}">
										<td class="text-start ps-4" style="max-width: 150px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"><a th:href="@{/project/minute/detail(minuteNo=${minute.meetingMinuteNo}, projectNo=${project.project_no})}" th:text="${minute.meetingTitle}" class="fw-semibold text-decoration-none text-body text-hover-1000"> 회의 제목 </a></td>
										<td class="text-center" th:text="${minute.participants}+' 명'">회의 참여인원</td>
										<td class="text-center" th:text="${minute.writer}">작성자</td>
										<td class="text-center pe-1 text-body-tertiary" th:text="${#temporals.format(minute.meetingDate, 'yyyy.MM.dd&nbsp&nbsp&nbspHH시 mm분')}">회의일</td>
										<td><a href="javascript:void(0);" class="text-primary show-summary-link" th:data-minute-no="${minute.meetingMinuteNo}"> 요약 </a></td>
									</tr>
								</tbody>
							</table>
						</div>

						<!-- 페이징 영역 유지 -->
						<div class="row align-items-center justify-content-between py-2 pe-0 fs-9">
							<div class="col-auto d-flex"></div>
							<div class="col-auto d-flex">
								<button class="page-link" data-list-pagination="prev">
									<span class="fas fa-chevron-left"></span>
								</button>
								<ul class="mb-0 pagination"></ul>
								<button class="page-link pe-0" data-list-pagination="next">
									<span class="fas fa-chevron-right"></span>
								</button>
							</div>
							<div class="col-auto d-flex"></div>
						</div>
					</div>
				</div>
				<!-- 회의 내용 요약 테이블 -->
				<div class="col-md-4">
					<div class="card shadow-sm">
						<div class="card-header bg-light fw-bold">회의 내용 요약</div>
						<div class="card-body p-2" id="summary-content">
							<div id="summary-placeholder">회의록을 선택하세요.</div>
							<div id="summary-text" class="d-flex flex-column gap-2 fs-8 lh-base text-secondary" style="display: none;"></div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- <footer class="footer position-absolute">
			<div class="row g-0 justify-content-between align-items-center h-100">
				<div class="col-12 col-sm-auto text-center">
					<p class="mb-0 mt-2 mt-sm-0 text-body">
						Thank you for creating with Phoenix<span class="d-none d-sm-inline-block"></span><span class="d-none d-sm-inline-block mx-1">|</span><br class="d-sm-none" />2025 &copy;<a class="mx-1" href="https://themewagon.com">Themewagon</a>
					</p>
				</div>
				<div class="col-12 col-sm-auto text-center">
					<p class="mb-0 text-body-tertiary text-opacity-85">v1.22.0</p>
				</div>
			</div>
		</footer> -->

		<script>
  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".show-summary-link").forEach(link => {
      link.addEventListener("click", function () {
        const minuteNo = this.getAttribute("data-minute-no");

        fetch(`/project/minute/summary?minuteNo=${minuteNo}`)
          .then(response => response.text())
          .then(summary => {
            const summaryText = document.getElementById("summary-text");
            const placeholder = document.getElementById("summary-placeholder");

            if (summary && summary.trim().length > 0) {
              const formatted = summary
                .split("\n")
                .map(line => `
                  <div class="ps-3 text-secondary fs-8 lh-base text-break" style="text-indent: -0.67rem;">
                    ${line.trim()}
                  </div>
                `)
                .join("");

              summaryText.innerHTML = formatted;
              summaryText.style.display = "flex";
              placeholder.style.display = "none";
            } else {
              summaryText.style.display = "none";
              placeholder.textContent = "요약이 존재하지 않습니다.";
              placeholder.style.display = "block";
            }
          })
          .catch(error => {
            console.error("요약 불러오기 실패:", error);

            const summaryText = document.getElementById("summary-text");
            const placeholder = document.getElementById("summary-placeholder");

            summaryText.style.display = "none";
            placeholder.textContent = "요약 로딩 중 오류 발생";
            placeholder.style.display = "block";
          });
      });
    });
  });
</script>

	</main>
</body>
</html>