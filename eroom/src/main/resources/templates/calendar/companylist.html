<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{/include/layout}">

<head>
<title>íšŒì‚¬ ìº˜ë¦°ë”</title>
</head>
<body>

	<main class="main" id="top" layout:fragment="content">

		<div class="row g-0 mb-4 align-items-center">
			<div class="col-5 col-md-6">
				<h4 class="mb-0 text-body-emphasis fw-bold fs-md-6">
					íšŒì‚¬ì¼ì •
				</h4>
			</div>
			<!-- ê´€ë¦¬ìë§Œ ì¼ì •ë“±ë¡ì„ ë³¼ ìˆ˜ ìˆê²Œ ì¡°ê±´ -->
			<div class="col-7 col-md-6 d-flex justify-content-end">
				<button class="btn btn-primary btn-sm" type="button"
					data-bs-toggle="modal" data-bs-target="#addEventModal" th:if="${#authentication.principal.employee.employeePosition=='ê´€ë¦¬ì'}" >
					<span class="fas fa-plus pe-2 fs-10"></span>ì¼ì • ë“±ë¡
				</button>
			</div>
		</div>
		



		<!-- ì¼ì • ë“±ë¡ ëª¨ë‹¬ -->
		<div class="modal fade" id="addEventModal" tabindex="-1">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content border border-translucent">
					<form id="addEventForm" autocomplete="off" name="addEventForm">
						<div class="modal-header px-card border-0">
							<div
								class="w-100 d-flex justify-content-between align-items-start">
								<h5 class="mb-0 lh-sm text-body-highlight">ì¼ì • ë“±ë¡</h5>
								<button class="btn p-1 fs-10 text-body" type="button"
									data-bs-dismiss="modal" aria-label="Close">ë‹«ê¸°</button>
							</div>
						</div>
						<div class="mb-4"></div>
						<div class="modal-body p-card py-0">
							<!-- ìˆ¨ê²¨ì§„ ê°’ë“¤ -->
							<input type="hidden" name="employee_no"
								th:value="${#authentication.principal.employee.employeeNo}" />
							<input type="hidden" name="separator" value="A001" /> <input
								type="hidden" name="company_creator"
								th:value="${#authentication.principal.employee.employeeId}" />

							<!-- ì œëª© / ì¥ì†Œ ê°€ë¡œ ë°°ì¹˜ -->
							<div class="row mb-2">
								<div class="col-6">
									<label class="form-label" for="calendarTitle">ì œëª©</label> <input
										type="text" class="form-control form-control-sm"
										id="calendarTitle" name="company_title" placeholder="ì¼ì • ì œëª©"
										aria-label="ì¼ì • ì œëª©" />
								</div>
								<div class="col-6">
									<label class="form-label" for="calendarLocation">ì¥ì†Œ</label> <input
										type="text" class="form-control form-control-sm"
										id="calendarLocation" name="company_location"
										placeholder="ì¼ì • ì¥ì†Œ" aria-label="ì¼ì • ì¥ì†Œ" />
								</div>
							</div>

							<div class="mb-4"></div>

							<!-- ì‹œì‘ ì‹œê°„ / ì¢…ë£Œ ì‹œê°„ ê°€ë¡œ ë°°ì¹˜ -->
							<div class="row mb-3">
								<div class="col-6">
									<div class="mb-3">
										<label class="form-label" for="calendarStartTime">ì‹œì‘ì‹œê°„</label>
										<input class="form-control" id="calendarStartTime"
											type="datetime-local" name="calendar_start_time" />
									</div>
								</div>
								<div class="col-6">
									<div class="mb-3">
										<label class="form-label" for="calendarEndTime">ì¢…ë£Œì‹œê°„</label> <input
											class="form-control" id="calendarEndTime"
											type="datetime-local" name="calendar_end_time" />
									</div>
								</div>
							</div>

							<!-- ì„¤ëª… -->
							<div class="input-group input-group-sm mb-3">
								<span class="input-group-text">ì„¤ëª…</span> <input type="text"
									class="form-control" id="calendarContent"
									name="company_content" placeholder="ì¼ì • ì„¤ëª…" aria-label="ì¼ì • ì„¤ëª…" />
							</div>

							<!-- ë²„íŠ¼ -->
							<div
								class="modal-footer d-flex justify-content-between align-items-center border-0">
								<span></span>
								<button class="btn btn-primary px-4" type="submit">ì¼ì •
									ë“±ë¡</button>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>




		<!-- ìº˜ë¦°ë” ìœ„ì¹˜ -->
		<div class="calendar-outline mt-6 mb-9" id="appCalendar"></div>
		
		
		
		<!-- ì¼ì • ìƒì„¸ ì¡°íšŒ ëª¨ë‹¬ -->

		<button class="btn btn-primary" type="button" data-bs-toggle="modal"
			data-bs-target="#tooltipModal" style="display: none;"
			id="modalButton"></button>

		<!-- ëª¨ë‹¬ ì°½ -->
		<div class="modal fade" id="tooltipModal" tabindex="-1"
			aria-labelledby="tooltipModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content border border-translucent">
					<div class="modal-header px-card border-0 position-relative">
						<h5 class="mb-0 lh-sm text-body-highlight" id="tooltipModalLabel">íšŒì‚¬ ì¼ì •
							ìƒì„¸ì¡°íšŒ</h5>
						<button class="btn-close position-absolute top-0 end-0 mt-2 me-2"
							type="button" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body p-card py-0">
						<input type="hidden" name="calendar_no" value="">
						<div class="mb-3">
							<strong>ì¼ì •:</strong> <span id="eventTitle"></span>
						</div>
						<div class="mb-3">
							<strong>ì‹œì‘ ì‹œê°„:</strong> <span id="eventDate"></span>
						</div>
						<div class="mb-3">
							<strong>ì¢…ë£Œ ì‹œê°„:</strong> <span id="eventEndDate"></span>
						</div>
						<div class="mb-3">
							<strong>ì¥ì†Œ:</strong> <span id="eventLocation"></span>
						</div>
						<div class="mb-3">
							<strong>ì„¤ëª…:</strong> <span id="eventDescription"></span>
						</div>
					</div>
					<div
						class="modal-footer d-flex justify-content-between align-items-center border-0" >
						<div class="d-flex">
							<button class="btn btn-subtle-secondary me-1 mb-1" type="button"
								id="editEventBtn" >ìˆ˜ì •</button>
							<button class="btn btn-outline-info me-1 mb-1" type="button"
								id="deleteEventBtn">ì‚­ì œ</button>
						</div>
						<div>
							<button class="btn btn-primary px-4" type="button"
								data-bs-dismiss="modal">í™•ì¸</button>
						</div>
					</div>
				</div>
			</div>
		</div>


		<div class="modal fade" id="editEventModal" tabindex="-1">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content border border-translucent">
					<form id="editEventForm" autocomplete="off" name="editEventForm">
						<div class="modal-header px-card border-0">
							<div
								class="w-100 d-flex justify-content-between align-items-start">
								<h5 class="mb-0 lh-sm text-body-highlight">ì¼ì • ìˆ˜ì •</h5>
								<button class="btn p-1 fs-10 text-body" type="button"
									data-bs-dismiss="modal" aria-label="Close">ë‹«ê¸°</button>
							</div>
						</div>
						<div class="mb-4"></div>
						<div class="modal-body p-card py-0">
							<!-- ìˆ¨ê²¨ì§„ ê°’ë“¤ -->
							<input type="hidden" name="calendar_no" id="calendar_no" /> <input
								type="hidden" name="employee_no"
								th:value="${#authentication.principal.employee.employeeNo}" />
							<input type="hidden" name="separator" value="A001" /> <input
								type="hidden" name="company_editor"
								th:value="${#authentication.principal.employee.employeeId}" />

							<!-- ì œëª© / ì¥ì†Œ ê°€ë¡œ ë°°ì¹˜ -->
							<div class="row mb-2">
								<div class="col-6">
									<label class="form-label" for="calendarTitle">ì œëª©</label> <input
										type="text" class="form-control form-control-sm"
										id="calendarTitle" name="company_title" placeholder="ì¼ì • ì œëª©"
										aria-label="ì¼ì • ì œëª©" />
								</div>
								<div class="col-6">
									<label class="form-label" for="calendarLocation">ì¥ì†Œ</label> <input
										type="text" class="form-control form-control-sm"
										id="calendarLocation" name="company_location"
										placeholder="ì¼ì • ì¥ì†Œ" aria-label="ì¼ì • ì¥ì†Œ" />
								</div>
							</div>

							<div class="mb-4"></div>

							<!-- ì‹œì‘ ì‹œê°„ / ì¢…ë£Œ ì‹œê°„ ê°€ë¡œ ë°°ì¹˜ -->
							<div class="row mb-3">
								<div class="col-6">
									<div class="mb-3">
										<label class="form-label" for="editStartTime">ì‹œì‘ì‹œê°„</label>
										<input class="form-control" id="editStartTime"
											type="datetime-local" name="calendar_start_time"
											onchange="setMinEndTime()" />
									</div>
								</div>
								<div class="col-6">
									<div class="mb-3">
										<label class="form-label" for="editEndTime">ì¢…ë£Œì‹œê°„</label> <input
											class="form-control" id="editEndTime"
											type="datetime-local" name="calendar_end_time" />
									</div>
								</div>
							</div>

							<!-- ì„¤ëª… -->
							<div class="input-group input-group-sm mb-3">
								<span class="input-group-text">ì„¤ëª…</span> <input type="text"
									class="form-control" id="calendarContent"
									name="company_content" placeholder="ì¼ì • ì„¤ëª…" aria-label="ì¼ì • ì„¤ëª…" />
							</div>

							<!-- ë²„íŠ¼ -->
							<div
								class="modal-footer d-flex justify-content-between align-items-center border-0">
								<span></span>
								<button class="btn btn-primary px-4" type="submit"
									id="saveEventButton">ì¼ì • ìˆ˜ì •</button>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
		
		<!-- íšŒì‚¬ ì¼ì •ì—ì„œ ìº˜ë¦°ë”ë¥¼ í´ë¦­í•˜ë©´ ëˆ„êµ¬ë‚˜ ì¼ì •ì„ ë“±ë¡í• ìˆ˜ ìˆê¸°ì—, ê´€ë¦¬ì ë¼ëŠ” ê°’ì„ ë„˜ê²¨ì¤Œ dateClickì†ì„±-->  
		<script th:inline="javascript">
			let employeePosition = /*[[${#authentication.principal.employee.employeePosition}]]*/ "";
  			console.log(employeePosition)
		</script>

		<script>
		document.addEventListener('DOMContentLoaded', function () {
		    const calendarEl = document.getElementById('appCalendar');
  			const separator = document.querySelector('input[name="separator"]').value;
		  	const employeeNo = document.addEventForm.employee_no.value;
		    let selectedCalendarNo = null;
			
		    
		    //WEEKVIEWëŠ” NO Monthviewë§Œ ë‚˜ì˜¤ê²Œ ì„¤ì •, í•œêµ­ì–´ , ì™¼ìª½ ìƒë‹¨ì— ì €ë²ˆë‹¬,ë‹¤ìŒë‹¬ë¡œ ê°€ëŠ” í™”ì‚´í‘œ, ê°€ìš´ë°ëŠ” ë…„ë„,ì›”
		    const calendar = new FullCalendar.Calendar(calendarEl, {
		      initialView: 'dayGridMonth',
		      locale: 'ko',
		      headerToolbar: {
		        left: 'prev,next today',
		        center: 'title',
		        right: ''
		      },
		      buttonText: {
		    	    today: 'ì˜¤ëŠ˜' 
		    	  },
		      dayMaxEventRows: true,
		      views: {
		        dayGridMonth: {
		          dayMaxEventRows: 3,
		          moreLinkText: "ë”ë³´ê¸°"		       
		          }
		      },
		      eventDisplay: 'block',
		      dayCellContent: function (info) {
		        return info.date.getDate();
		      },
		      
		      //ì¼ì • ë“±ë¡ì´ ì•ˆë˜ì–´ìˆëŠ” ë‚ ì„ í´ë¦­í•˜ë©´ ì¼ì •ì„ ë“±ë¡í• ìˆ˜ ìˆê²Œ í•˜ëŠ” event
		      dateClick: function (info) {
		    	  
		    	  if (employeePosition.trim() !== 'ê´€ë¦¬ì') {
		    		  return;
		    		}
		      
		        const dateStr = info.dateStr + "T09:00";
		        document.getElementById('calendarStartTime').value = dateStr;
		        document.getElementById('calendarEndTime').value = info.dateStr + "T18:00";

		        const addEventModal = new bootstrap.Modal(document.getElementById('addEventModal'));
		        addEventModal.show();
		      },
		      
		      eventSources: [ //êµ¬ê¸€ ìº˜ë¦°ë”ë¡œ ê³µíœ´ì¼ ë¶ˆëŸ¬ì˜¤ê¸°, ê·¸ë¦¬ê³  í•´ë‹¹ ì§ì›ì˜ ì¼ì • ë¶ˆëŸ¬ì˜¤ê¸°
		    	    {
		    	      events: function (fetchInfo, successCallback, failureCallback) {
		    	        fetch('/companycalendar/list/' + separator)
		    	          .then(response => response.json())
		    	          .then(events => successCallback(events))
		    	          .catch(error => {
		    	            console.error("ë‚´ ì¼ì • ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨", error);
		    	            failureCallback(error);
		    	          });
		    	      }
		    	    },
		    	    {
		    	      events: function (fetchInfo, successCallback, failureCallback) {
		    	        const apiKey = 'AIzaSyCjXiu1ShbhE0XenBtciLx8ezU-mcZI0R0';
		    	        const calendarId = 'ko.south_korea%23holiday@group.v.calendar.google.com';
		    	        const timeMin = new Date(fetchInfo.start).toISOString();
		    	        const timeMax = new Date(fetchInfo.end).toISOString();
		    	        const url = `https://www.googleapis.com/calendar/v3/calendars/${calendarId}/events?key=${apiKey}&timeMin=${timeMin}&timeMax=${timeMax}&orderBy=startTime&singleEvents=true`;

		    	        fetch(url)
		    	          .then(response => response.json())
		    	          .then(data => {
		    	            if (!data.items) {
		    	              console.warn("ê³µíœ´ì¼ ë°ì´í„° ì—†ìŒ", data);
		    	              return successCallback([]);
		    	            }
		    	            const holidays = data.items.map(item => ({
		    	              title: item.summary,
		    	              start: item.start.date,
		    	              allDay: true,
		    	              extendedProps: {
		    	            	    type: 'holiday'
		    	            	  }
		    	              
		    	            }));
		    	            successCallback(holidays);
		    	          })
		    	          .catch(error => {
		    	            console.error("ê³µíœ´ì¼ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨", error);
		    	            failureCallback(error);
		    	          });
		    	      }
		    	    }
		    	  ],
			  
		      
		      //ë“±ë¡ëœ ì¼ì •ì„ í´ë¦­í•˜ë©´ ìƒì„¸ì¡°íšŒê°€ ë‚˜ì˜¤ëŠ” fullcalendarì˜ event
			eventClick: function (info) {
			  const calendarNo = info.event.extendedProps.calendar_no;
			  console.log("ì œë°œ ê°€ì ¸ì™€ !!!!!!!!! " + calendarNo);
			
			  // ë‚ ì§œ í¬ë§·íŒ… ì˜µì…˜
			  const options = {
			    year: 'numeric',
			    month: 'long',
			    day: 'numeric',
			    weekday: 'short',
			    hour: '2-digit',
			    minute: '2-digit',
			    hour12: true
			  };
			  
			  //ê´€ë¦¬ìë§Œ ìƒì„¸ì¡°íšŒì—ì„œ ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ì´ ë³´ì¼ ìˆ˜ ìˆê²Œ ì„¤ì •
			  if (employeePosition.trim() === 'ê´€ë¦¬ì') {
				    document.getElementById('editEventBtn').style.display = 'inline-block';
				    document.getElementById('deleteEventBtn').style.display = 'inline-block';
				  } else {
				    document.getElementById('editEventBtn').style.display = 'none';
				    document.getElementById('deleteEventBtn').style.display = 'none';
				  }
			
			  // 1. ì¼ì •, ì‹œê°„, ì¥ì†Œ, ì„¤ëª…ì„ ê°€ì ¸ì˜µë‹ˆë‹¤
			  const title = info.event.title || '';
			  const start = info.event.start; // í•œ ë²ˆë§Œ ì„ ì–¸
			  const end = info.event.end || '';
			  const location = info.event.extendedProps.location || '';
			  const description = info.event.extendedProps.description || '';
			
			  // ë‚ ì§œ í¬ë§·íŒ…
			  const date = start ? new Intl.DateTimeFormat('ko-KR', options).format(start) : '';
			  const endDate = end ? new Intl.DateTimeFormat('ko-KR', options).format(end) : '';
			
			  // 2. ê°ê° í•­ëª©ì„ ì±„ìš°ê³ , ê°’ì´ ì—†ìœ¼ë©´ í•´ë‹¹ í•­ëª©ì„ ìˆ¨ê¹ë‹ˆë‹¤
			  const eventTitleElement = document.getElementById('eventTitle');
			  if (eventTitleElement) {
			    if (title) {
			      eventTitleElement.textContent = title;
			    } else {
			      eventTitleElement.parentElement.style.display = 'none'; // ì œëª© ìˆ¨ê¸°ê¸°
			    }
			  }
			
			  const eventDateElement = document.getElementById('eventDate');
			  if (eventDateElement) {
			    if (date) {
			      eventDateElement.textContent = date;
			    } else {
			      eventDateElement.parentElement.style.display = 'none'; // ì‹œì‘ ì‹œê°„ ìˆ¨ê¸°ê¸°
			    }
			  }
			
			  const eventEndDateElement = document.getElementById('eventEndDate');
			  if (eventEndDateElement) {
			    if (endDate) {
			      eventEndDateElement.textContent = endDate;
			    } else {
			      eventEndDateElement.parentElement.style.display = 'none'; // ì¢…ë£Œ ì‹œê°„ ìˆ¨ê¸°ê¸°
			    }
			  }
			
			  const eventLocationElement = document.getElementById('eventLocation');
			  if (eventLocationElement) {
			    if (location) {
			      eventLocationElement.textContent = location;
			    } else {
			      eventLocationElement.parentElement.style.display = 'none'; // ì¥ì†Œ ìˆ¨ê¸°ê¸°
			    }
			  }
			
			  const eventDescriptionElement = document.getElementById('eventDescription');
			  if (eventDescriptionElement) {
			    if (description) {
			      eventDescriptionElement.textContent = description;
			    } else {
			      eventDescriptionElement.parentElement.style.display = 'none'; // ì„¤ëª… ìˆ¨ê¸°ê¸°
			    }
			  }
					
		    selectedCalendarNo = calendarNo;
		
		    const modalButton = document.getElementById('modalButton');
		    if (modalButton) {
		        modalButton.click(); // ëª¨ë‹¬ ë²„íŠ¼ í´ë¦­í•˜ì—¬ ëª¨ë‹¬ ì—´ê¸°
		    } else {
		        console.error('modalButton not found');
		    }
		},

				
		      //ì¼ì •ì˜ ìƒ‰ìƒì„ ì •í•´ì£¼ëŠ” event, E001 -> ê°œì¸ ìº˜ë¦°ë”ëŠ” ì—°í•œ ì—°ë‘ìƒ‰ìœ¼ë¡œ ì§€ì •
		 	eventDidMount: function (info) {
		 		
		 	   const isHoliday = info.event.extendedProps?.type === 'holiday';
			    if (isHoliday) {
			        const el = info.el;
			        el.style.setProperty("background-color", "#FFF8B3", "important"); //  ì—°ë…¸ë‘
			        el.style.setProperty("border", "1px solid #F5E79E", "important");
			        el.style.setProperty("color", "#4B4B4B", "important");
			        el.style.setProperty("pointer-events", "none", "important"); // í´ë¦­ ë§‰ê¸°
			        el.style.setProperty("opacity", "1", "important");
			        return;
			      }
			    
 			 	const separator = info.event.extendedProps.separator || "";
  				let backgroundColor, borderColor, textColor;

				// ê¸°ë³¸ ìƒ‰ìƒ ì„¤ì •
				switch (separator) {
				    case "E001":
				        backgroundColor = "#C1F0E3"; // ì—°í•œ ì—°ë‘ìƒ‰
				        borderColor = "#A3E4A0"; // ì‚´ì§ ì§„í•œ í…Œë‘ë¦¬
				        textColor = "#1A3C1A"; // ì–´ë‘ìš´ ì´ˆë¡ í…ìŠ¤íŠ¸ (ê°€ë…ì„± í–¥ìƒ)
				        break;
				
				    case "A001":
				        backgroundColor = "#F8D7DA"; // ë¼ì´íŠ¸ í•‘í¬ ë°°ê²½
				        borderColor = "#F5C6CB"; // ë¼ì´íŠ¸ í•‘í¬ í…Œë‘ë¦¬
				        textColor = "#721C24"; // ì–´ë‘ìš´ í•‘í¬ í…ìŠ¤íŠ¸ (ê°€ë…ì„± í–¥ìƒ)
				        break;
				}


				// ì´ë²¤íŠ¸ ìŠ¤íƒ€ì¼ ì„¤ì •
				const eventEl = info.el;
				eventEl.style.setProperty("background-color", backgroundColor, "important");
				eventEl.style.setProperty("border", `1px solid ${borderColor}`, "important");
				eventEl.style.setProperty("color", textColor, "important");
				eventEl.style.setProperty("border-radius", "8px", "important"); 
				eventEl.style.setProperty("padding", "4px 8px", "important");
				eventEl.style.setProperty("box-shadow", "0 2px 4px rgba(0, 0, 0, 0.1)", "important"); 
				eventEl.style.setProperty("font-weight", "500", "important"); 
				eventEl.style.setProperty("font-size", "14px", "important"); 
				


  			  // ì´ë²¤íŠ¸ ë©”ì¸ ì½˜í…ì¸  ìŠ¤íƒ€ì¼
			  const eventMain = eventEl.querySelector(".fc-event-main");
			  if (eventMain) {
			    eventMain.style.setProperty("background-color", backgroundColor, "important");
			    eventMain.style.setProperty("border-color", borderColor, "important");
			    eventMain.style.setProperty("color", textColor, "important");
			    eventMain.style.setProperty("border-radius", "8px", "important");
			  }
		 	},
		  });
		 	
		

		    // ìˆ˜ì • ë²„íŠ¼ í´ë¦­
		    // ìˆ˜ì • ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ -> calendarNoê°’ìœ¼ë¡œ ê°€ì ¸ì˜¨ ì •ë³´ê°€ ëª¨ë‹¬ì°½ì— ë“¤ì–´ê°
		    document.getElementById('editEventBtn').addEventListener('click', function () {
			    console.log("ìˆ˜ì • ë²„íŠ¼ í´ë¦­");
			
			    const eventModal = bootstrap.Modal.getInstance(document.getElementById('tooltipModal'));
			    eventModal.hide();
			
			    fetch('/companycalendar/detail/' + selectedCalendarNo)
			        .then(response => response.json())
			        .then(data => {
			            console.log("ë°›ì•„ì˜¨ ë°ì´í„°:", data);
			
			            const form = document.forms["editEventForm"];
			            form.calendar_no.value = data.calendar_no;
			            form.company_title.value = data.company_title;
			            form.company_location.value = data.company_location;
			            form.calendar_start_time.value = data.calendar_start_time.slice(0, 16);
			            form.calendar_end_time.value = data.calendar_end_time.slice(0, 16);
			            form.company_content.value = data.company_content;
			
			            // ì‹œê°„ ì œì–´ ë¡œì§ ì¶”ê°€ 
			            const startEditInput = document.getElementById("editStartTime");
			            const endEditInput = document.getElementById("editEndTime");
			
			            function setMinEndTime() {
			                if (startEditInput && endEditInput) {
			                    endEditInput.min = startEditInput.value;
			
			                    if (endEditInput.value < startEditInput.value) {
			                        endEditInput.value = startEditInput.value;
			                    }
			                }
			            }
			
			            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ 
			            if (startEditInput) {
			                startEditInput.addEventListener("change", setMinEndTime);
			                setMinEndTime(); 
			            }
			
			            const editEventModal = new bootstrap.Modal(document.getElementById('editEventModal'));
			            editEventModal.show();
			        })
			        .catch(error => {
			            console.error('ì¼ì • ìƒì„¸ ì¡°íšŒ ì‹¤íŒ¨:', error);
			            alert('ì¼ì • ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
			        });
			});
		    
		    //ì¼ì • ìˆ˜ì •í•œê±°ë¥¼ ì €ì¥
			document.getElementById('saveEventButton').addEventListener('click', function(e) {
			    e.preventDefault();
			
			    const updateForm = document.editEventForm;
			    const updateData = new FormData(updateForm);
			
			    const startEditInput = document.getElementById("editStartTime");
			    const endEditInput = document.getElementById("editEndTime");
			
			    // ìœ íš¨ì„± ê²€ì‚¬
			    const startTime = new Date(startEditInput.value);
			    const endTime = new Date(endEditInput.value);
			
			    if (startTime > endTime) {
			        endEditInput.setCustomValidity("ì¢…ë£Œì‹œê°„ì€ ì‹œì‘ì‹œê°„ ì´í›„ì—¬ì•¼ í•©ë‹ˆë‹¤!");
			        endEditInput.reportValidity();
			        return;
			    } else {
			        endEditInput.setCustomValidity(""); // ì •ìƒì¼ ë•Œ ì´ˆê¸°í™”
			    }
			
			    // ì„œë²„ë¡œ ì „ì†¡
			    fetch("/companycalendar/update/" + selectedCalendarNo, {
			        method: "POST",
			        headers: {
			            'header': document.querySelector('meta[name="_csrf_header"]').content,
			            'X-CSRF-Token': document.querySelector('meta[name="_csrf"]').content
			        },
			        body: updateData
			    })
			    .then(response => response.json())
			    .then(data => {
			        alert(data.res_msg);
			        if (data.res_code == 200) {
			            location.reload();
			        }
			    })
			    .catch(error => {
			        console.error("Error:", error);
			        alert("ì´ë²¤íŠ¸ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
			    });
			});
		    
		    
			//ì¼ì • ì‚­ì œ -> ì‚¬ìš©ì—¬ë¶€ë¥¼ Y ì—ì„œ N ìœ¼ë¡œ!
			document.getElementById('deleteEventBtn').addEventListener('click',function(){
			const calendarNo = selectedCalendarNo;
			//console.log(calendarNo);
			const perMission = confirm('í•´ë‹¹ ì¼ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
			//console.log(perMission);
			if(!perMission){
				return;
			}else{
				fetch('/companycalendar/delete/'+calendarNo,{
					method: 'post',
					headers: {
			            'header': document.querySelector('meta[name="_csrf_header"]').content,
			            'X-CSRF-Token': document.querySelector('meta[name="_csrf"]').content
			        }
				})
				.then(response => response.json())
				.then(data => {
					alert(data.res_msg);
					if(data.res_code == 200) location.reload();
				})
			}
			
			});
		    
			
			calendar.render();
		
		})
  	
    	</script>




		<!-- ì¼ì • ë“±ë¡ -->
		<script>
		  function format(date) {
		    const pad = (n) => n.toString().padStart(2, '0');
		    const yyyy = date.getFullYear();
		    const MM = pad(date.getMonth() + 1);
		    const dd = pad(date.getDate());
		    const HH = pad(date.getHours());
		    const mm = pad(date.getMinutes());
		    return `${yyyy}-${MM}-${dd}T${HH}:${mm}`;
		  }
		
		  function setDefaultTime() {
		    const startInput = document.getElementById("calendarStartTime");
		    const endInput = document.getElementById("calendarEndTime");
		
		    if (!startInput || !endInput) return;
		
		    const now = new Date();
		    const startTime = new Date(now);
		    const endTime = new Date(now);
		    endTime.setHours(endTime.getHours() + 1);
		
		    startInput.value = format(startTime);
		    endInput.value = format(endTime);
		    endInput.min = startInput.value;
		  }
		
		  function setMinEndTime() {
		    const startInput = document.getElementById("calendarStartTime");
		    const endInput = document.getElementById("calendarEndTime");
		
		    if (startInput && endInput) {
		      endInput.min = startInput.value;
		      if (endInput.value < startInput.value) {
		        endInput.value = startInput.value;
		      }
		    }
		  }
		
		  document.addEventListener("DOMContentLoaded", function () {
		    const startInput = document.getElementById("calendarStartTime");
		    if (startInput) {
		      startInput.addEventListener("change", setMinEndTime);
		    }
		
		    // ğŸ•’ í˜ì´ì§€ ë¡œë“œë  ë•Œ ê¸°ë³¸ ì‹œê°„ ì„¤ì • (í˜„ì¬ + 1ì‹œê°„)
		    setDefaultTime();
		
		    const form = document.addEventForm;
		    form.addEventListener("submit", function (e) {
		      e.preventDefault();
		
		      const startTime = new Date(form.calendar_start_time.value);
		      const endTime = new Date(form.calendar_end_time.value);
		
		      if (!form.company_title.value) {
		        alert("ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
		        return;
		      }
		
		      const payload = new FormData(form);
		      fetch("/companycalendar/add", {
		        method: "post",
		        headers: {
		          'header': document.querySelector('meta[name="_csrf_header"]').content,
		          'X-CSRF-Token': document.querySelector('meta[name="_csrf"]').content
		        },
		        body: payload
		      })
		        .then(response => response.json())
		        .then(data => {
		          alert(data.res_msg);
		          if (data.res_code == 200) {
		            location.reload();
		          }
		        });
		    });
		  });
		</script>





	</main>
</body>
</html>