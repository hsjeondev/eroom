<!DOCTYPE html>
<html 
lang="en-US" dir="ltr" data-navigation-type="default" data-navbar-horizontal-shape="default"
	  xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{include/layout}">
<head>
<meta charset="UTF-8">
<title>ì°¨ëŸ‰ ëª©ë¡</title>
<style>
	.table tbody > tr {
	  height: 45px;  /* ë˜ëŠ” 48px, í•„ìš”ì— ë”°ë¼ ì¡°ì • */
	}
</style>
</head> 
<body>
<main class="main" id="top" layout:fragment="content">
    
<div class="mb-3">
	<div class="d-flex justify-content-start align-items-center mb-2">
		<i class="fas fa-car me-2"></i>
		<span class="fw-bold fs-7"> ì°¨ëŸ‰ ëª©ë¡</span>
	</div>

	<div id="vehicleTable" data-list='{"valueNames":["no","vehicle","passengers","regDate","modDate"], "page": 5, "pagination": true}'>
		<!-- ê²€ìƒ‰ì°½ + ì¶”ê°€ ë²„íŠ¼ ì˜ì—­ -->
		<div class="position-relative mb-3" style="min-height: 38px;"> <!-- ë²„íŠ¼ ë†’ì´ í™•ë³´ -->
			<!-- ê²€ìƒ‰ì°½ (ê°€ìš´ë° ì •ë ¬) -->
			<div class="d-flex justify-content-center">
				<form class="position-relative" style="width: 300px;">
					<input class="form-control search-input search form-control-sm" type="search" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”." aria-label="Search">
					<svg class="svg-inline--fa fa-magnifying-glass search-box-icon position-absolute top-50 end-0 translate-middle-y me-2"
					  aria-hidden="true" focusable="false" data-prefix="fas" data-icon="magnifying-glass" role="img"
					  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="pointer-events: none; height:40%;">
						<path fill="currentColor"
						  d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z">
						</path>
					</svg>
				</form>
			</div>
			<!-- ì¶”ê°€ ë²„íŠ¼ (ì˜¤ë¥¸ìª½ ê³ ì •) -->
			<button class="btn btn-sm btn-primary position-absolute top-0 end-0" type="button"
				data-bs-toggle="modal" data-bs-target="#createVehicleModal">
			 	ì°¨ëŸ‰ ë“±ë¡
			</button>
		</div>
	    <!-- í…Œì´ë¸” ë³¸ë¬¸ -->
	    <div class="table-responsive">
			<table class="table table-striped table-sm fs-9 mb-0 text-center">
				<thead class="text-center align-middle">
					<tr>
						<th class="sort" data-sort="no" style="width: 5%;">ë²ˆí˜¸</th>
						<th class="sort" data-sort="vehicle" style="width: 25%;">ì°¨ëŸ‰</th>
						<th class="sort" data-sort="passengers" style="width: 20%;">íƒ‘ìŠ¹ ì •ì›</th>
						<th class="sort" data-sort="regDate" style="width: 20%;">ë“±ë¡ì¼</th>
						<th class="sort" data-sort="modDate" style="width: 20%;">ìˆ˜ì •ì¼</th>
						<th style="width: 10%;"></th>
					</tr>
				</thead>
				<tbody class="list align-middle">
					<!-- ì°¨ëŸ‰ 1 -->
					<tr th:if="${!#lists.isEmpty(vehicleList)}" th:each="vehicle, status : ${vehicleList}" class="align-middle">
						<td class="no" th:text="${status.count}">ë²ˆí˜¸</td>
						<td class="vehicle" th:text="${vehicle.facilityName}">ì°¨ëŸ‰ëª…</td>
						<td class="passengers" th:text="|${vehicle.facilityCapacity}ëª…|">íƒ‘ìŠ¹ ì •ì›</td>
						<td class="regDate" th:text="${#temporals.format(vehicle.facilityRegDate, 'yy.MM.dd')}">ë“±ë¡ì¼</td>
						<td class="regDate" th:text="${vehicle.facilityModDate != null} ? ${#temporals.format(vehicle.facilityModDate, 'yyyy.MM.dd')} : '-'">ìˆ˜ì •ì¼</td>
						<td class="text-end pe-0">
							<div class="btn-reveal-trigger position-static">
								<button class="btn btn-sm dropdown-toggle dropdown-caret-none transition-none btn-reveal fs-10" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-bs-reference="parent">
									<i class="fas fa-ellipsis fs-10"></i>
								</button>
								<div class="dropdown-menu dropdown-menu-end py-2">
									<a class="dropdown-item editVehicleBtn" href="#!"
										th:attr="data-facility-no=${vehicle.facilityNo}">ìˆ˜ì •</a>
										<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger deleteVehicleBtn" href="#!"
										th:attr="data-facility-no=${vehicle.facilityNo}">ì‚­ì œ</a>
								</div>
							</div>
						</td>
					</tr>
					<tr th:if="${#lists.isEmpty(vehicleList)}">
						<td colspan="6">ë“±ë¡ëœ ì°¨ëŸ‰ì´ ì—†ìŠµë‹ˆë‹¤.</td>
					</tr>
				</tbody>
			</table>
	    </div>
	
	    <!-- í˜ì´ì§• -->
	    <div class="d-flex justify-content-center mt-3">
	      <div class="d-flex">
	        <button class="page-link disabled" data-list-pagination="prev" disabled><i class="fas fa-chevron-left"></i></button>
	        <ul class="mb-0 pagination">
	          <li class="active"><button class="page" type="button" data-i="1" data-page="5">1</button></li>
	        </ul>
	        <button class="page-link pe-0" data-list-pagination="next" disabled><i class="fas fa-chevron-right"></i></button>
	      </div>
	    </div>
	</div>    
</div>    
    
<hr>
<!-- ì°¨ëŸ‰ ì˜ˆì•½ ëª©ë¡ -->  
<div class="mb-3">
	<div class="d-flex justify-content-start align-items-center mb-2">
		<i class="fas fa-edit me-2"></i>
		<span class="fw-bold fs-7"> ì°¨ëŸ‰ ì˜ˆì•½ í˜„í™©</span>
	</div>

	<div id="reservationTable" data-list='{"valueNames":["no","vehicle","reservation","date","time"], "page": 5, "pagination": true}'>
		<!-- ê²€ìƒ‰ì°½ + ì¶”ê°€ ë²„íŠ¼ ì˜ì—­ -->
		<div class="position-relative mb-3" style="min-height: 38px;"> <!-- ë²„íŠ¼ ë†’ì´ í™•ë³´ -->
			<!-- ê²€ìƒ‰ì°½ (ê°€ìš´ë° ì •ë ¬) -->
			<div class="d-flex justify-content-center">
				<form class="position-relative" style="width: 300px;">
					<input class="form-control search-input search form-control-sm" type="search" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”." aria-label="Search">
					<svg class="svg-inline--fa fa-magnifying-glass search-box-icon position-absolute top-50 end-0 translate-middle-y me-2"
					  aria-hidden="true" focusable="false" data-prefix="fas" data-icon="magnifying-glass" role="img"
					  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="pointer-events: none; height:40%;">
						<path fill="currentColor"
						  d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z">
						</path>
					</svg>
				</form>
			</div>
		</div>
		<!-- í…Œì´ë¸” ë³¸ë¬¸ -->
		<div class="table-responsive">
			<table class="table table-striped table-sm fs-9 mb-0 text-center">
				<thead class="text-center align-middle">
					<tr>
						<th class="sort" data-sort="no" style="width: 5%;">ë²ˆí˜¸</th>
						<th class="sort" data-sort="vehicle" style="width: 25%;">ì°¨ëŸ‰</th>
						<th class="sort" data-sort="reservation" style="width: 15%;">ì˜ˆì•½ì</th>
						<th class="sort" data-sort="date" style="width: 25%;">ì˜ˆì•½ì¼</th>
						<th class="sort" data-sort="time" style="width: 30%;">ì˜ˆì•½ ì‹œê°„</th>
					</tr>
				</thead>
				<tbody class="list align-middle">
					<tr th:if="${!#lists.isEmpty(vehicleReservationList)}"
						th:each="res, status : ${vehicleReservationList}">
						<td class="no" th:text="${status.count}">1</td>
						<td class="vehicle" th:text="${res.vehicleName}">ì°¨ëŸ‰ëª…</td>
						<td class="reservation" th:text="${res.reserverName}">ì˜ˆì•½ì</td>
						<td class="date" th:text="${#temporals.format(res.reservation_start, 'yyyy.MM.dd')}">ì˜ˆì•½ë‚ ì§œ</td>
						<td class="time" th:text="${#temporals.format(res.reservation_start, 'HH:mm')} + ' ~ ' + ${#temporals.format(res.reservation_end, 'HH:mm')}">ì˜ˆì•½ì‹œê°„</td>
					</tr>
					<tr th:if="${#lists.isEmpty(vehicleReservationList)}">
						<td colspan="5">ì˜ˆì•½ëœ ì°¨ëŸ‰ì´ ì—†ìŠµë‹ˆë‹¤.</td>
					</tr>
				</tbody>
			</table>
		</div>
		<!-- í˜ì´ì§•? -->
		<div class="d-flex justify-content-center mt-3">
			<div class="d-flex">
				<button class="page-link disabled" data-list-pagination="prev" disabled><i class="fas fa-chevron-left"></i></button>
				<ul class="mb-0 pagination">
					<li class="active"><button class="page" type="button" data-i="1" data-page="5">1</button></li>
				</ul>
				<button class="page-link pe-0" data-list-pagination="next" disabled><i class="fas fa-chevron-right"></i></button>
			</div>
		</div>
	</div> <!-- reservationTable -->   
</div> <!-- mb-3 ì°¨ëŸ‰ì˜ˆì•½ëª©ë¡ -->      

<!-- ì°¨ëŸ‰ ë“±ë¡ ëª¨ë‹¬ -->
<div class="modal fade" id="createVehicleModal" tabindex="-1" aria-labelledby="createVehicleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" style="max-width: 400px;">
    <div class="modal-content border border-secondary">
      <form id="createVehicleForm" autocomplete="off">
        <!-- í—¤ë” -->
        <div class="modal-header bg-light">
          <h5 class="modal-title" id="createVehicleModalLabel">ì°¨ëŸ‰ ë“±ë¡</h5>
          <button type="button" class="btn-close btn-close-secondary" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <!-- ë°”ë”” -->
        <div class="modal-body px-4 py-3">
          <!-- ì°¨ëŸ‰ëª… -->
          <div class="mb-3">
            <label for="createVehicleName" class="form-label fw-semibold">ì°¨ëŸ‰ëª…</label>
            <div class="input-group">
              <input type="text" class="form-control" id="createVehicleName" name="facility_name" required placeholder="ì°¨ëŸ‰ëª… [00ê°€ 0000]">
              <button type="button" class="btn btn-outline-secondary" id="checkVehicleNameBtn">ì¤‘ë³µí™•ì¸</button>
            </div>
            <small id="vehicleNameCheckMsg" class="form-text d-none"></small>
          </div>
          <!-- íƒ‘ìŠ¹ ì •ì› -->
          <div class="mb-3">
            <label for="createVehicleCapacity" class="form-label fw-semibold">íƒ‘ìŠ¹ ì •ì›</label>
            <input type="number" class="form-control" id="createVehicleCapacity" name="facility_capacity" required min="1" placeholder="ìˆ«ìë§Œ ì…ë ¥">
          </div>
        </div>

        <!-- í‘¸í„° -->
        <div class="modal-footer px-4 py-3 border-0 d-flex justify-content-end">
          <button type="button" class="btn btn-light me-2" data-bs-dismiss="modal">ì·¨ì†Œ</button>
          <button type="button" class="btn btn-primary" id="saveCreateVehicleBtn">ë“±ë¡</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- ì°¨ëŸ‰ ìˆ˜ì • ëª¨ë‹¬ -->
<div class="modal fade" id="editVehicleModal" tabindex="-1" aria-labelledby="editVehicleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" style="max-width: 400px;">
    <div class="modal-content border border-secondary">
      <form id="editVehicleForm" autocomplete="off">
        <!-- í—¤ë” -->
        <div class="modal-header bg-light">
          <h5 class="modal-title" id="editVehicleModalLabel">ì°¨ëŸ‰ ì •ë³´ ìˆ˜ì •</h5>
          <button type="button" class="btn-close btn-close-secondary" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <!-- ë°”ë”” -->
        <div class="modal-body px-4 py-3">
          <!-- ì°¨ëŸ‰ëª… -->
          <div class="mb-3">
            <label for="editVehicleName" class="form-label fw-semibold">ì°¨ëŸ‰ëª…</label>
            <div class="input-group">
              <input type="text" class="form-control" id="editVehicleName" name="facility_name" required placeholder="ì°¨ëŸ‰ëª… [00ê°€ 0000]">
              <button type="button" class="btn btn-outline-secondary" id="editCheckVehicleNameBtn">ì¤‘ë³µí™•ì¸</button>
            </div>
            <small id="editVehicleNameCheckMsg" class="form-text d-none"></small>
          </div>
          <!-- íƒ‘ìŠ¹ ì •ì› -->
          <div class="mb-3">
            <label for="editVehicleCapacity" class="form-label fw-semibold">íƒ‘ìŠ¹ ì •ì›</label>
            <input type="number" class="form-control" id="editVehicleCapacity" name="facility_capacity" required min="1">
          </div>
        </div>

        <!-- í‘¸í„° -->
        <div class="modal-footer px-4 py-3 border-0 d-flex justify-content-end">
          <button type="button" class="btn btn-light me-2" data-bs-dismiss="modal">ì·¨ì†Œ</button>
          <button type="button" class="btn btn-primary" id="saveEditVehicleBtn">ì €ì¥</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- ê³µí†µ ì €ì¥ í™•ì¸ ëª¨ë‹¬ -->
<div class="modal fade" id="confirmSaveModal" tabindex="-1" aria-labelledby="confirmSaveModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm">
    <div class="modal-content bg-light text-body rounded-3 shadow-lg border border-secondary-light">
      <div class="modal-header border-0">
        <h5 class="modal-title text-dark" id="confirmSaveModalLabel">í™•ì¸</h5>
      </div>
      <div class="modal-body text-center">
        <p class="mb-0 text-body" id="confirmSaveModalMessage">
          <!-- ìƒí™©ë³„ ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— ë“¤ì–´ê° -->
        </p>
      </div>
      <div class="modal-footer justify-content-center border-0">
        <button type="button" class="btn btn-phoenix-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
        <button type="button" class="btn btn-primary" id="confirmSaveBtn">í™•ì¸</button>
      </div>
    </div>
  </div>
</div>

<!-- ê³µí†µ ì•Œë¦¼ ëª¨ë‹¬ -->
<div class="modal fade" id="alertMessageModal" tabindex="-1" aria-labelledby="alertMessageModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm">
    <div class="modal-content bg-light text-body rounded-3 shadow-lg border border-secondary-light">
      <div class="modal-header border-0">
        <h5 class="modal-title text-dark" id="alertMessageModalLabel">ì•Œë¦¼</h5>
      </div>
      <div class="modal-body text-center">
        <p class="mb-0 text-body" id="alertMessageContent">
          <!-- ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— ë“¤ì–´ê° -->
        </p>
      </div>
      <div class="modal-footer justify-content-center border-0">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">í™•ì¸</button>
      </div>
    </div>
  </div>
</div>

<!--  ìƒì„±ìš© unsaved ëª¨ë‹¬ -->
<div class="modal fade" id="unsavedCreateModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm">
    <div class="modal-content bg-light text-body rounded-3 shadow-lg border border-secondary-light">
      <div class="modal-header border-0">
        <h5 class="modal-title text-dark">ì •ë§ ë‹«ì„ê¹Œìš”?</h5>
      </div>
      <div class="modal-body text-center">
        <p class="mb-0 text-body">
          ì‘ì„± ì¤‘ì¸ ì°¨ëŸ‰ ë“±ë¡ ì •ë³´ê°€ ì‚¬ë¼ì§‘ë‹ˆë‹¤.<br>ì •ë§ ë‹«ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?
        </p>
      </div>
      <div class="modal-footer justify-content-center border-0">
        <button type="button" class="btn btn-phoenix-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
        <button type="button" class="btn btn-danger" id="confirmCreateCloseBtn">í™•ì¸</button>
      </div>
    </div>
  </div>
</div>

<!-- ìˆ˜ì •ìš© unsaved ëª¨ë‹¬ -->
<div class="modal fade" id="unsavedEditModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm">
    <div class="modal-content bg-light text-body rounded-3 shadow-lg border border-secondary-light">
      <div class="modal-header border-0">
        <h5 class="modal-title text-dark">ì •ë§ ë‹«ì„ê¹Œìš”?</h5>
      </div>
      <div class="modal-body text-center">
        <p class="mb-0 text-body">
          ì‘ì„± ì¤‘ì¸ ì°¨ëŸ‰ ìˆ˜ì • ì •ë³´ê°€ ì‚¬ë¼ì§‘ë‹ˆë‹¤.<br>ì •ë§ ë‹«ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?
        </p>
      </div>
      <div class="modal-footer justify-content-center border-0">
        <button type="button" class="btn btn-phoenix-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
        <button type="button" class="btn btn-danger" id="confirmEditCloseBtn">í™•ì¸</button>
      </div>
    </div>
  </div>
</div>
<script>

document.addEventListener('DOMContentLoaded',function(){
	
	let currentMode = ''; // ë™ì‘ ëª¨ë“œ : 'create', 'edit', 'delete'
	let isCreateFormEdited = false; // ìƒì„±í¼ ìˆ˜ì • ì—¬ë¶€
	let isEditFormEdited = false; // ìˆ˜ì •í¼ ìˆ˜ì • ì—¬ë¶€
	let currentFacilityNo = null; // ìˆ˜ì •, ì‚­ì œìš© ì°¨ëŸ‰ ê³ ìœ  ë²ˆí˜¸
	let isNameChecked = false; // ìƒì„± ëª¨ë‹¬ì—ì„œ ì´ë¦„ ì¤‘ë³µí™•ì¸ ì—¬ë¶€
	let prevCreateName = ''; // ë§ˆì§€ë§‰ ì¤‘ë³µí™•ì¸ í†µê³¼í•œ ì°¨ëŸ‰ëª… ì €ì¥	
	let isEditNameChecked = false;
	let prevEditName = '';
	
	// ëª¨ë‹¬ ì¸ìŠ¤í„´ìŠ¤ ì´ˆê¸°í™”(ìƒì„±ìš©)
	const createVehicleModalEl = document.getElementById('createVehicleModal');
	const createModal = bootstrap.Modal.getOrCreateInstance(createVehicleModalEl);
	const unsavedCreateModal = new bootstrap.Modal(document.getElementById('unsavedCreateModal'));
	// ìƒì„± ëª¨ë‹¬ í•„ë“œ ìš”ì†Œ
	const nameInput = document.getElementById('createVehicleName'); // ì°¨ëŸ‰ëª…
	const capacityInput = document.getElementById('createVehicleCapacity'); // íƒ‘ìŠ¹ì •ì›
	const vehicleNameCheckMsg = document.getElementById('vehicleNameCheckMsg'); // ì´ë¦„ ì¤‘ë³µí™•ì¸ ë©”ì„¸ì§€
	// ëª¨ë‹¬ ì¸ìŠ¤í„´ìŠ¤ ì´ˆê¸°í™”(ìˆ˜ì •ìš©)
	const editVehicleModalEl = document.getElementById('editVehicleModal');
	const editModal = bootstrap.Modal.getOrCreateInstance(editVehicleModalEl);
	const unsavedEditModal = new bootstrap.Modal(document.getElementById('unsavedEditModal'));
	// ìˆ˜ì • ëª¨ë‹¬ í•„ë“œ ìš”ì†Œ
	const editNameInput = document.getElementById('editVehicleName');
	const editCapacityInput = document.getElementById('editVehicleCapacity');
	const editVehicleNameCheckMsg = document.getElementById('editVehicleNameCheckMsg'); // ìˆ˜ì •ìš© ì´ë¦„ì¤‘ë³µ ë©”ì„¸ì§€
	
	// ìƒì„±ìš© ì°¨ëŸ‰ëª… ì…ë ¥ê°’ ë³€ê²½ì‹œ -> ë³€ê²½ ê°ì§€ í”Œë˜ê·¸ ON + ì¤‘ë³µí™•ì¸ ë¬´íš¨í™” ì²˜ë¦¬
	nameInput.addEventListener('input',function(){
		isCreateFormEdited = true; // ìƒì„±í¼ ìˆ˜ì • ì—¬ë¶€ true
		// ì¤‘ë³µ í™•ì¸ í–ˆê³ , ê¸°ì¡´ ì´ë¦„ê³¼ ë‹¤ë¥´ë©´ ë‹¤ì‹œ í™•ì¸
		if(isNameChecked && nameInput.value.trim() !== prevCreateName){
			isNameChecked = false;
			vehicleNameCheckMsg.classList.add('text-danger');
			vehicleNameCheckMsg.textContent = 'ë‹¤ì‹œ ì¤‘ë³µí™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.';
			vehicleNameCheckMsg.classList.remove('d-none');
		}
	});	
	// ìƒì„±ìš© íƒ‘ìŠ¹ ì •ì› ë³€ê²½ ì‹œì—ë„ ë³€ê²½ ê°ì§€ í”Œë˜ê·¸ ON
	capacityInput.addEventListener('input',function(){
		isCreateFormEdited = true;
	});	
	
	// ìƒì„± ëª¨ë‹¬ ë‹«ê¸° : ë³€ê²½ì‚¬í•­ ìˆìœ¼ë©´ ë‹«ê¸° ë°©ì§€ -> unsaved ëª¨ë‹¬ ë„ì›€
	createVehicleModalEl.addEventListener('hide.bs.modal',function(e){
		if(isCreateFormEdited){ // ìˆ˜ì • ì—¬ë¶€ ê°ì§€ë˜ë©´
			e.preventDefault(); // ê¸°ë³¸ ë‹«ê¸° ë°©ì§€
			unsavedCreateModal.show(); // ìˆ˜ì • ì´ë ¥ ê°ì§€ ëª¨ë‹¬ ì—´ê¸°
		}
	});	
	
	// unsavedCreateModal í™•ì¸ ë²„íŠ¼ í´ë¦­ì‹œ -> ê³„ì† ë‹«ê¸° , ê°’ ì´ˆê¸°í™”
	document.getElementById('confirmCreateCloseBtn').addEventListener('click',function(){
		isCreateFormEdited = false;
		isNameChecked = false;
		prevCreateName = '';
		// ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
		nameInput.value = '';
		capacityInput.value = '';
		// ë©”ì„¸ì§€ ì´ˆê¸°í™”
		vehicleNameCheckMsg.classList.add('d-none');
		vehicleNameCheckMsg.textContent = '';
		// ëª¨ë‹¬ ë‹«ê¸°
		unsavedCreateModal.hide();
		createModal.hide();
	});	
	// ìˆ˜ì • ëª¨ë‹¬ ë‹«ì„ë•Œ
	editVehicleModalEl.addEventListener('hide.bs.modal',function(e){
		if(isEditFormEdited){
			e.preventDefault();
			unsavedEditModal.show();
		}
	});	
	
	// unsavedEditModal í™•ì¸ ë²„íŠ¼ í´ë¦­ì‹œ -> ê³„ì† ë‹«ê¸° , ê°’ ì´ˆê¸°í™”
	document.getElementById('confirmEditCloseBtn').addEventListener('click',function(){
		isEditFormEdited = false;
		isEditNameChecked = false;
		prevEditName = '';
		// ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
		editNameInput.value = '';
		editCapacityInput.value = '';
		// ë©”ì„¸ì§€ ì´ˆê¸°í™”
		editVehicleNameCheckMsg.classList.add('d-none');
		editVehicleNameCheckMsg.textContent = '';
		// ëª¨ë‹¬ ë‹«ê¸°
		unsavedEditModal.hide();
		editModal.hide();
	});	
	
	// ì°¨ëŸ‰ëª… ì¤‘ë³µ í™•ì¸ ë²„íŠ¼(ìƒì„±ìš©)
	document.getElementById('checkVehicleNameBtn').addEventListener('click',function(){
		const vehicleName = nameInput.value.trim().replace(/\s+/g, ''); // ëª¨ë“  ê³µë°± ì œê±°
		// ì…ë ¥ ì—†ì„ ê²½ìš° ê²½ê³ 
		if(!vehicleName){
			vehicleNameCheckMsg.textContent = 'ì°¨ëŸ‰ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
			vehicleNameCheckMsg.classList.remove('d-none');
			vehicleNameCheckMsg.classList.add('text-danger');
			return;
		}
		
		// fetchë¡œ ì´ë¦„ ì¤‘ë³µ ì²´í¬ ì„œë²„ í˜¸ì¶œí•˜ê¸°
	fetch(`/admin/vehicle/checkDuplicate?vehicleName=${encodeURIComponent(vehicleName)}`)
		.then(response => response.json())
		.then(data => {
			if (data.exists) {
				isNameChecked = false;
				vehicleNameCheckMsg.textContent = 'ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì°¨ëŸ‰ëª…ì…ë‹ˆë‹¤.';
				vehicleNameCheckMsg.classList.remove('text-success');
				vehicleNameCheckMsg.classList.add('text-danger');
			} else {
				prevCreateName = vehicleName;
				isNameChecked = true;
				vehicleNameCheckMsg.textContent = 'ì‚¬ìš© ê°€ëŠ¥í•œ ì°¨ëŸ‰ëª…ì…ë‹ˆë‹¤.';
				vehicleNameCheckMsg.classList.remove('text-danger');
				vehicleNameCheckMsg.classList.add('text-success');
			}
			vehicleNameCheckMsg.classList.remove('d-none');
		})
		.catch(error => {
			showAlertModal('ì¤‘ë³µ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
			console.error(error);
		});
		
	});	
	
	// confirmSaveModal í•¨ìˆ˜
	function showConfirmModal(message){
		const modalMessage = document.getElementById('confirmSaveModalMessage');
		modalMessage.textContent = message;
		const confirmModal = new bootstrap.Modal(document.getElementById('confirmSaveModal'));
		confirmModal.show();
	}	
	
	// alertModal í•¨ìˆ˜
	function showAlertModal(message, callback) {
		const alertMessageContent = document.getElementById('alertMessageContent');
		const alertModalEl = document.getElementById('alertMessageModal');
		const alertModal = bootstrap.Modal.getOrCreateInstance(alertModalEl);

		alertMessageContent.textContent = message;

		// ì´ì „ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±° (ì¤‘ë³µ ë°©ì§€)
		const confirmBtn = alertModalEl.querySelector('.btn-primary');
		const newConfirmBtn = confirmBtn.cloneNode(true);
		confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);

		// í™•ì¸ ë²„íŠ¼ì— ì½œë°± ì—°ê²°
		newConfirmBtn.addEventListener('click', function () {
			if (callback) callback(); // ì½œë°±ì´ ìˆìœ¼ë©´ ì‹¤í–‰
		});

		alertModal.show();
	}		

	// ìƒì„± ëª¨ë‹¬ì˜ ì €ì¥ ë²„íŠ¼ í´ë¦­ì‹œ
	document.getElementById('saveCreateVehicleBtn').addEventListener('click',function(){
		 currentMode = 'create';
		 showConfirmModal('ì°¨ëŸ‰ì„ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
	});
	
	// ìˆ˜ì • ëª¨ë‹¬ì˜ ì €ì¥ ë²„íŠ¼ í´ë¦­ì‹œ
	document.getElementById('saveEditVehicleBtn').addEventListener('click',function(){
		  currentMode = 'edit';
		  showConfirmModal('ì°¨ëŸ‰ ì •ë³´ë¥¼ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
	});
	
	// ì‚­ì œë²„íŠ¼ í´ë¦­ì‹œ
	document.querySelectorAll('.deleteVehicleBtn').forEach(btn => {
		btn.addEventListener('click',function(){
		    currentFacilityNo = btn.dataset.facilityNo;
		    currentMode = 'delete';
		    showConfirmModal('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
		});
	});
	
	// comfirm ëª¨ë‹¬ì˜ í™•ì¸ ë²„íŠ¼ í´ë¦­ì‹œ
	document.getElementById('confirmSaveBtn').addEventListener('click',function(){
		  const confirmModalEl = document.getElementById('confirmSaveModal');
		  const confirmModal = bootstrap.Modal.getInstance(confirmModalEl);
		  confirmModal.hide(); // í™•ì¸ ë²„íŠ¼ ëˆ„ë¥´ë©´ confirm ëª¨ë‹¬ ë‹«ê¸°
		  if (currentMode === 'create') sendCreateVehicle(); // ìƒì„± í•¨ìˆ˜ í˜¸ì¶œ
		  else if (currentMode === 'edit') sendEditVehicle(); // ìˆ˜ì • í•¨ìˆ˜ í˜¸ì¶œ
		  else if (currentMode === 'delete') sendDeleteVehicle(); // ì‚­ì œ í•¨ìˆ˜ í˜¸ì¶œ
	});
	
	// ì°¨ëŸ‰ ìƒì„± í•¨ìˆ˜ -> confirmëª¨ë‹¬ì—ì„œ saveë²„íŠ¼ ëˆŒë €ì„ë•Œ
	function sendCreateVehicle(){
		console.log("=== sendCreateVehicle() í˜¸ì¶œë¨ ===");
		const form = document.getElementById('createVehicleForm');
		const formData = new FormData(form);

		const vehicleName = formData.get('facility_name')?.trim().replace(/\s+/g, '');
		const vehicleCapacity = formData.get('facility_capacity')?.trim();
		// ìœ íš¨ì„± ê²€ì‚¬
		if(!vehicleName){
			showAlertModal('ì°¨ëŸ‰ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
			return;
		}
		if(!vehicleCapacity || isNaN(vehicleCapacity) || Number(vehicleCapacity) < 1){
			showAlertModal('íƒ‘ìŠ¹ ì •ì›ì€ 1 ì´ìƒì˜ ìˆ«ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
			return;
		}
		// ì¤‘ë³µí™•ì¸ ì—¬ë¶€ í™•ì¸
		if (!isNameChecked || vehicleName !== prevCreateName) {
			showAlertModal('ì°¨ëŸ‰ëª… ì¤‘ë³µ í™•ì¸ì„ ë¨¼ì € í•´ì£¼ì„¸ìš”.');
			return;
		}
		console.log("=== fetch ì‹œì‘ë¨ ===");
		// ì„œë²„ ìš”ì²­
		fetch('/admin/vehicle/create', {
			method: 'POST',
			body: formData,
			headers : {
				'X-CSRF-TOKEN': document.querySelector('meta[name="_csrf"]').getAttribute('content'),
				'X-CSRF-HEADER': document.querySelector('meta[name="_csrf_header"]').getAttribute('content')
			}
		})
		.then(response => response.json())
		.then(data => {
			console.log("=== ì„œë²„ ì‘ë‹µ ===", data);
			if (data.res_code === 200) {
				showAlertModal(data.res_msg, function () {
					// ì´ˆê¸°í™”
					form.reset();
					vehicleNameCheckMsg.classList.add('d-none');
					vehicleNameCheckMsg.textContent = '';
					isCreateFormEdited = false;
					isNameChecked = false;
					prevCreateName = '';
					createModal.hide();
					location.reload();
				});
			} else {
				showAlertModal(data.res_msg || 'ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
			}
		})
		.catch(error => {
			console.error(error);
			showAlertModal('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
		});
	}	
	
	// ìˆ˜ì • ëª¨ë‹¬ - ì´ë¦„ ì…ë ¥ ë³€ê²½ ê°ì§€
	editNameInput.addEventListener('input',function(){
		isEditFormEdited = true;
		if(isEditNameChecked && editNameInput.value.trim() !== prevEditName){
			isEditNameChecked = false;
			editVehicleNameCheckMsg.classList.add('text-danger');
			editVehicleNameCheckMsg.textContent = 'ë‹¤ì‹œ ì¤‘ë³µí™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.';
			editVehicleNameCheckMsg.classList.remove('d-none');
		}
	});	
	
	// ìˆ˜ì • ëª¨ë‹¬ - íƒ‘ìŠ¹ ì •ì› ë³€ê²½ ê°ì§€
	editCapacityInput.addEventListener('input',function(){
		isEditFormEdited = true;
	});	
	// ìˆ˜ì • ëª¨ë‹¬ ì´ë¦„ ì¤‘ë³µ í™•ì¸ ë²„íŠ¼ í´ë¦­
	document.getElementById('editCheckVehicleNameBtn').addEventListener('click',function(){
		const editName = editNameInput.value.trim().replace(/\s+/g, '');
		if(!editName){
			editVehicleNameCheckMsg.textContent = 'ì°¨ëŸ‰ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
			editVehicleNameCheckMsg.classList.remove('d-none');
			return;
		}
		// ê¸°ì¡´ ì´ë¦„ê³¼ ë™ì¼í•œ ê²½ìš°
		if(editName == prevEditName.replace(/\s+/g, '')){
			isEditNameChecked = true;
			editVehicleNameCheckMsg.textContent = 'ê¸°ì¡´ ì´ë¦„ê³¼ ë™ì¼í•©ë‹ˆë‹¤.';
			editVehicleNameCheckMsg.classList.remove('text-danger');
			editVehicleNameCheckMsg.classList.add('text-success');
			editVehicleNameCheckMsg.classList.remove('d-none');
			return;
		}
		
		// fetchë¶€ë¶„ api
		fetch(`/admin/vehicle/checkDuplicate?roomName=${encodeURIComponent(editName)}`)
			.then(response => response.json())
			.then(data => {
				if(data.exists){
					isEditNameChecked = false;
					editVehicleNameCheckMsg.textContent = 'ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì°¨ëŸ‰ëª…ì…ë‹ˆë‹¤.';
					editVehicleNameCheckMsg.classList.remove('text-success');
					editVehicleNameCheckMsg.classList.add('text-danger');
				}else{
					prevEditName = editName;
					isEditNameChecked = true;
					editVehicleNameCheckMsg.textContent = 'ì‚¬ìš© ê°€ëŠ¥í•œ ì°¨ëŸ‰ëª…ì…ë‹ˆë‹¤.';
					editVehicleNameCheckMsg.classList.remove('text-danger');
					editVehicleNameCheckMsg.classList.add('text-success');
				}
				editVehicleNameCheckMsg.classList.remove('d-none');
			})
			.catch(error => {
				showAlertModal('ì¤‘ë³µ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
				console.error(error);
			});
	});	
	
	// ëª©ë¡ì˜ ìˆ˜ì • ë²„íŠ¼ í´ë¦­ì‹œ
	document.querySelectorAll('.editVehicleBtn').forEach(btn => {
		btn.addEventListener('click',function(){
			const facilityNo = btn.getAttribute('data-facility-no');
			currentFacilityNo = facilityNo;
			currentMode = 'edit';
			
			// ì„œë²„ì—ì„œ ì°¨ëŸ‰ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
			fetch(`/admin/vehicle/get?facilityNo=${facilityNo}`)
				.then(response => response.json())
				.then(data => {
					if(data.res_code == 200){
						// ëª¨ë‹¬ í•„ë“œ ì±„ìš°ê¸°
						editNameInput.value = data.facility_name;
						editCapacityInput.value = data.facility_capacity;
						// ì´ˆê¸°í™”
						isEditFormEdited = false;
						isEditNameChecked = false;
						prevEditName = data.facility_name.trim().replace(/\s+/g, '');
						editVehicleNameCheckMsg.classList.add('d-none');
						editVehicleNameCheckMsg.textContent = '';
						// ëª¨ë‹¬ ì—´ê¸°
						editModal.show();
					}else{
						showAlertModal('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
					}
				})
				.catch(error => {
					showAlertModal('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
					console.error(error);
				});
		});
	});	
	
	// ì°¨ëŸ‰ ìˆ˜ì • í•¨ìˆ˜ 
	function sendEditVehicle(){
		const form = document.getElementById('editVehicleForm');
		const formData = new FormData(form);
		
		console.log("vehicle_name",formData.get("facility_name"));
		console.log("vehicle_capacity",formData.get("facility_capacity"));
		
		const vehicleName = formData.get('facility_name')?.trim().replace(/\s+/g, '');
		const vehicleCapacity = formData.get('facility_capacity')?.trim();
		
		console.log("ğŸš¨ vehicle_name:", vehicleName);  // ì´ê±° ì°ì–´ë³´ì
		console.log("ğŸš¨ vehicle_capacity:", vehicleCapacity);		

		// ìœ íš¨ì„± ê²€ì‚¬
		if(!vehicleName){
			showAlertModal('ì°¨ëŸ‰ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
			return;
		}
		if(!vehicleCapacity || isNaN(vehicleCapacity) || Number(vehicleCapacity) < 1){
			showAlertModal('íƒ‘ìŠ¹ ì •ì›ì€ 1 ì´ìƒì˜ ìˆ«ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
			return;
		}

		// ì¤‘ë³µ í™•ì¸ ì—¬ë¶€ í™•ì¸
		if (!isEditNameChecked || vehicleName !== prevEditName) {
			showAlertModal('ì°¨ëŸ‰ëª… ì¤‘ë³µ í™•ì¸ì„ ë¨¼ì € í•´ì£¼ì„¸ìš”.');
			return;
		}

		// ì„œë²„ ìš”ì²­
		formData.append('facility_no', currentFacilityNo);

		fetch('/admin/vehicle/edit', {
			method: 'POST',
			body: formData,
			headers : {
				'X-CSRF-TOKEN': document.querySelector('meta[name="_csrf"]').getAttribute('content'),
				'X-CSRF-HEADER': document.querySelector('meta[name="_csrf_header"]').getAttribute('content')
			}
		})
		.then(response => response.json())
		.then(data => {
			if (data.res_code === 200) {
				showAlertModal(data.res_msg,function(){
					// ì´ˆê¸°í™”
					isEditFormEdited = false;
					isEditNameChecked = false;
					prevEditName = '';
					editModal.hide();
					location.reload();
				});			
			} else {
				showAlertModal(data.res_msg || 'ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
			}
		})
		.catch(error => {
			console.error(error);
			showAlertModal('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
		});		
	}	
	
	// ì°¨ëŸ‰ ì‚­ì œ	
	function sendDeleteVehicle() {
		if (!currentFacilityNo) {
			showAlertModal('ì‚­ì œí•  ì°¨ëŸ‰ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
			return;
		}
	
		const formData = new FormData();
		formData.append('facility_no', currentFacilityNo);
	
		fetch('/admin/vehicle/delete', {
			method: 'POST',
			body: formData,
			headers: {
				'X-CSRF-TOKEN': document.querySelector('meta[name="_csrf"]').getAttribute('content'),
				'X-CSRF-HEADER': document.querySelector('meta[name="_csrf_header"]').getAttribute('content')
			}
		})
		.then(response => response.json())
		.then(data => {
			if (data.res_code === 200) {
				showAlertModal(data.res_msg,function(){
					location.reload(); 
				});
			} else {
				showAlertModal(data.res_msg || 'ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
			}
		})
		.catch(error => {
			console.error(error);
			showAlertModal('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
		});
	}	
	
	
	
});













</script>
</main>
</body>
</html>