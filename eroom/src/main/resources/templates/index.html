<!DOCTYPE html>
<html lang="ko-KR" dir="ltr" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{include/layout}">
<head>
<meta charset="UTF-8">
<title>Eroom</title>
<style>
.custom-grid {
	display: grid;
	grid-template-columns: repeat(3, 1fr);
	grid-template-rows: repeat(3, 1fr);
	gap: 12px;
	height: 83vh;
	box-sizing: border-box;
}

.custom-grid>div {
	display: flex;
}

.attendance-card {
	flex: 1;
	display: flex;
	flex-direction: column;
}
/* 출퇴근 카드 날짜부분 헤더 */
.card-header.custom-header {
  /* height: 56px; 
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 1rem;
  border-bottom: 1px solid #dee2e6; 
  font-size: 1.2rem; 
  font-weight: 600; */
  color: #495057;
}

.card {
	flex: 1;
	display: flex;
	flex-direction: column;
	height: 100%;
}

.card-body {
	flex: 1;
	padding: 16px;
	display: flex;
	flex-direction: column;
	justify-content: center;
}

/* 오늘 일정: 2행 병합 */
.card-tall {
	grid-column: 3;
	grid-row: span 2;
}

.current-time {
	font-size: 1.2rem;
	color: #6c757d;
	text-align: center;
	margin: 0;
	/* margin-bottom: 0.5rem; */
}

.profile-img {
	width: 64px;
	height: 64px;
}

.btn-wrap {
	border-top: none; /* 1px dashed #dee2e6; */
	padding-top: 0;           /* 버튼과 위 요소 사이 여백 제거 */
	margin-top: 0;            /* 버튼이 아래로 밀리지 않도록 */
	align-self: center;       /* 왼쪽 프로필과 수직 기준 맞추기 */
	margin-top: -3px;         /* 필요 시 약간 위로 올리기 (조정 가능) */
}

.btn-wrap .btn {
	min-width: 120px;
}

.vertical-divider {
  width: 1px;
  height: 100px;
  background: repeating-linear-gradient(
    to bottom,
    #dee2e6,
    #dee2e6 4px,
    transparent 4px,
    transparent 8px
  );
  margin: 0 1rem;
}

/* 스크롤 커스터마이징 선택사항 */
.fc-scroller {
	max-height: 390px !important; /* 🔥 기존보다 넉넉하게 */
	overflow-y: auto !important;
}

#calendarContainer {
	overflow: hidden;
}

.fc-scroller::-webkit-scrollbar {
	width: 6px;
}

.fc-scroller::-webkit-scrollbar-thumb {
	background-color: rgba(0, 0, 0, 0.1);
	border-radius: 10px;
}

/* 날짜 영역 제거 */
.fc-list-day-text, .fc-list-day-cushion {
	display: none !important;
}

/* 가운데 점 제거 */
.fc-list-event-graphic {
	display: none !important;
}

.fc-list-event-time {
	width: 30% !important;
}

.fc-list-event-graphic {
	display: none !important;
	width: 0 !important;
}

.fc-list-event-title {
	width: 70% !important;
	overflow: hidden;
	text-align: center;
	text-overflow: ellipsis;
}

.fc-list-table {
	table-layout: fixed !important;
	width: 100%;
}

.fc-list-event-time {
	width: 30% !important;
	font-size: 15px;
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
	text-align: center;
	padding-left: 6px;
}

/* 뉴스 카드 스타일 */
.news-card {
	display: flex;
	align-items: center;
	width: 100%;
	max-width: 380px; /* 기존 카드 사이즈와 맞추기 */
	margin: 0 auto;
	border-radius: 10px;
	overflow: hidden;
	box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.news-card img {
	width: 120px; /* 이미지 너비 */
	height: 100px; /* 이미지 높이 */
	object-fit: cover; /* 이미지 비율을 맞추고 자르기 */
	margin-right: 15px; /* 이미지와 텍스트 간 간격 */
	border-radius: 8px;
}

.news-card .card-body {
	display: flex;
	align-items: center;
}

.news-card .card-title {
	font-size: 1.1rem;
	font-weight: bold;
}

.news-card .card-text {
	font-size: 0.9rem;
	color: #666;
	height: 60px;
	overflow: hidden;
	text-overflow: ellipsis;
}

/* 결재 관련 스타일 태그 */
.bg-primary-soft {
	background-color: rgba(13, 110, 253, 0.1);
	/* Bootstrap primary with 투명도 */
}

.bg-success-soft {
	background-color: rgba(25, 135, 84, 0.1);
	/* Bootstrap success with 투명도 */
}

.bg-fail-soft {
	background-color: rgba(253, 175, 171, 0.5); /* 50% 투명도 적용 */
}

.bg-warning-soft {
	background-color: rgba(255, 193, 7, 0.1);
	/* Bootstrap Warning 색상에 투명도 적용 */
}

.carousel-indicators {
	bottom: -26px; /* ✅ 기본보다 아래로 내림 */
	justify-content: center; /* ✅ 가운데 정렬 (기본) */
}

.carousel-indicators [data-bs-target] {
	width: 10px;
	height: 3px;
	/*   background-color: rgba(13, 110, 253, 0.5); */ /* 반투명 primary */
	background-color: rgba(108, 117, 125, 0.5); /* secondary 반투명 */
	border: none;
}

.carousel-indicators .active {
	/*  background-color: #0d6efd; */ /* 활성화된 점 */
	background-color: #6c757d; /* secondary 진한 색 */
}
/* 결재 관련 스타일 태그 */
#emergencyNoticeTable tbody td {
  white-space: nowrap;       /* 줄바꿈 방지 */
  overflow: hidden;          /* 넘치면 숨김 */
  text-overflow: ellipsis;   /* 말줄임표 */
  height: 40px;              /* td에도 높이 줌 */
  vertical-align: middle;    /* 가운데 정렬 */
}
</style>

</head>
<body>
	<main class="main" id="top">
		<div layout:fragment="content">
			<div class="container-fluid px-0">
				<div class="custom-grid">

					<!-- 1행·1열: 출퇴근 카드 -->
					<div class="text-white p-1">
						<div class="attendance-card mx-auto">
						  <div class="card shadow-sm border-0">
						            <!-- 상단 현재 시간 -->
							<div class="card-header custom-header custom-header text-center py-3">
							        <div id="currentTime" class="current-time fw-semibold text-center"></div>
							
							</div>
						    <div class="card-body p-4">
						      <form id="attendanceForm" th:action="@{/log}" method="post" class="w-100">
						        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf_token}">
						        <input type="hidden" th:value="${#authentication.principal.employee.employeeNo}" name="employeeNo">
						        <input type="hidden" name="attendanceType" id="attendanceType">
						
						
						
						        <!-- 좌우 분리된 정보 블럭 -->
						        <div class="d-flex justify-content-center align-items-center flex-wrap gap-6">
						
						          <!-- 왼쪽: 프로필 + 이름/부서 -->
						          <div class="d-flex align-items-center">
						            <img id="profileImage" class="rounded-circle me-3 profile-img"
						                 src="" alt="프로필" style="display: none; height: 64px; width: 64px">
						            <div class="text-start">
						              <p class="fw-semibold fs-6 mb-1" th:text="${employee.employeeName}">이름</p>
						              <small th:if="${employee.structure != null}"
						                     th:text="|${employee.structure.codeName} / ${employee.employeePosition}|">
						                부서 / 직급
						              </small>
						              <small th:if="${employee.structure == null}"
						                     th:text="|- / ${employee.employeePosition}|">
						                부서 / 직급
						              </small>
						            </div>
						          </div>
						
							<div class="vertical-divider"></div>
						
						          <!-- 오른쪽: 출근/퇴근 버튼 + 시간 -->
						          <div class="btn-wrap d-flex flex-column align-items-end">
						            <button id="checkInBtn" class="btn btn-outline-primary btn-sm mb-2"
						                    th:attr="disabled=${attendanceStatus != 'notCheckedIn'} ? 'disabled' : null"
						                    th:text="${attendanceStatus == 'checkedIn' || attendanceStatus == 'checkedOut'} ? ${checkInTime} : '출근하기'">
						              출근하기
						            </button>
						            <button id="checkOutBtn" class="btn btn-primary btn-sm"
						                    th:attr="disabled=${attendanceStatus != 'checkedIn'} ? 'disabled' : null"
						                    th:text="${attendanceStatus == 'checkedOut'} ? ${checkOutTime} : '퇴근하기'">
						              퇴근하기
						            </button>
						          </div>
						        </div>
						      </form>
						    </div>
						  </div>
						</div>
					</div>

					<!-- 1행·2열 결재 -->
					<div class="text-white p-1">
						<div class="attendance-card mx-auto">
							<div class="card shadow-sm border-0">
								<div class="card-header text-center py-3"
									style="text-align: center; font-size: 1.2rem; font-weight: bold; padding: 15px;">
									결재</div>
								<!-- Tab 메뉴 -->
								<div
									class="d-flex justify-content-between align-items-center mb-2">
									<div class="fw-bold text-dark" style="font-size: 0.9rem;"></div>
									<ul class="nav nav-underline fs-9 w-100" id="resTab"
										role="tablist" style="margin-bottom: 0;">
										<li class="nav-item flex-grow-1 text-center"
											role="presentation"><a class="nav-link active"
											id="approvalPending-tab" data-bs-toggle="tab"
											href="#approvalPendingTab" role="tab"
											aria-controls="approvalPendingTab" aria-selected="true">내게
												온 결재</a></li>
										<li class="nav-item flex-grow-1 text-center"
											role="presentation"><a class="nav-link"
											id="approvalOngoing-tab" data-bs-toggle="tab"
											href="#approvalOngoingTab" role="tab"
											aria-controls="approvalOngoingTab" aria-selected="false">진행
												중 결재</a></li>
										<li class="nav-item flex-grow-1 text-center"
											role="presentation"><a class="nav-link"
											id="approvalCompleted-tab" data-bs-toggle="tab"
											href="#approvalCompletedTab" role="tab"
											aria-controls="approvalCompletedTab" aria-selected="false">완료된
												결재</a></li>
									</ul>
								</div>

								<!-- 탭 내용 -->
								<div class="tab-content mb-4">

									<!-- 승인/반려 대기 -->
									<div class="tab-pane fade show active" id="approvalPendingTab">
										<div class="carousel slide" id="approvalPendingCarousel">

											<!-- ✅ 인디케이터 -->
											<div class="carousel-indicators"
												id="pendingCarouselIndicators">
												<!-- JavaScript에서 동적 로딩 -->
											</div>

											<!-- ✅ 슬라이드 항목 -->
											<div class="carousel-inner text-center"
												id="pendingCarouselInner">
												<!-- JavaScript에서 동적 로딩 -->
											</div>

											<!-- ✅ 이전/다음 버튼 -->
											<button
												class="position-absolute mx-3 border-0 bg-transparent text-secondary"
												type="button" data-bs-target="#approvalPendingCarousel"
												data-bs-slide="prev"
												style="top: 65%; left: -10px; transform: translateY(-50%); z-index: 2;">
												<i class="fas fa-chevron-left fs-7"></i>
											</button>
											<button
												class="position-absolute mx-3 border-0 bg-transparent text-secondary"
												type="button" data-bs-target="#approvalPendingCarousel"
												data-bs-slide="next"
												style="top: 65%; right: -10px; transform: translateY(-50%); z-index: 2;">
												<i class="fas fa-chevron-right fs-7"></i>
											</button>

										</div>
									</div>

									<!-- 진행 중 결재 -->
									<div class="tab-pane fade" id="approvalOngoingTab">
										<div class="carousel slide" id="approvalOngoingCarousel">

											<!-- ✅ 인디케이터 -->
											<div class="carousel-indicators"
												id="ongoingCarouselIndicators">
												<!-- JavaScript에서 동적 로딩 -->
											</div>

											<!-- ✅ 슬라이드 항목 -->
											<div class="carousel-inner text-center"
												id="ongoingCarouselInner">
												<!-- JavaScript에서 동적 로딩 -->
											</div>

											<!-- ✅ 이전/다음 버튼 -->
											<button
												class="position-absolute mx-3 border-0 bg-transparent text-secondary"
												type="button" data-bs-target="#approvalOngoingCarousel"
												data-bs-slide="prev"
												style="top: 65%; left: -10px; transform: translateY(-50%); z-index: 2;">
												<i class="fas fa-chevron-left fs-7"></i>
											</button>
											<button
												class="position-absolute mx-3 border-0 bg-transparent text-secondary"
												type="button" data-bs-target="#approvalOngoingCarousel"
												data-bs-slide="next"
												style="top: 65%; right: -10px; transform: translateY(-50%); z-index: 2;">
												<i class="fas fa-chevron-right fs-7"></i>
											</button>

										</div>
									</div>


									<!-- 승인된 결재 -->
									<div class="tab-pane fade" id="approvalCompletedTab">
										<div class="carousel slide" id="approvalCompletedCarousel">

											<!-- ✅ 인디케이터 -->
											<div class="carousel-indicators"
												id="completedCarouselIndicators">
												<!-- JavaScript에서 동적 로딩 -->
											</div>

											<!-- ✅ 슬라이드 항목 -->
											<div class="carousel-inner text-center"
												id="completedCarouselInner">
												<!-- JavaScript에서 동적 로딩 -->
											</div>

											<!-- ✅ 이전/다음 버튼 -->
											<button
												class="position-absolute mx-3 border-0 bg-transparent text-secondary"
												type="button" data-bs-target="#approvalCompletedCarousel"
												data-bs-slide="prev"
												style="top: 65%; left: -10px; transform: translateY(-50%); z-index: 2;">
												<i class="fas fa-chevron-left fs-7"></i>
											</button>
											<button
												class="position-absolute mx-3 border-0 bg-transparent text-secondary"
												type="button" data-bs-target="#approvalCompletedCarousel"
												data-bs-slide="next"
												style="top: 65%; right: -10px; transform: translateY(-50%); z-index: 2;">
												<i class="fas fa-chevron-right fs-7"></i>
											</button>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- 1~2행·3열 (위 두 칸 합침) -->
					<div class="text-white p-1 card-tall">
						<div class="attendance-card mx-auto">
							<div class="card shadow-sm border-0">

								<!-- 헤더 -->
								<div class="card-header text-center py-3"
									style="font-size: 1.2rem; font-weight: bold;">오늘 일정</div>

								<!-- 바디 -->
								<div class="card-body d-flex flex-column">
									<div id="calendarContainer" class="flex-grow-1">
										<div id="appCalendar"></div>
									</div>
								</div>

							</div>
						</div>
					</div>

					<!-- 2행·1열 프로젝트 -->
					<div class="text-white p-1">
						<div class="attendance-card mx-auto">
							<div class="card shadow-sm border-0">
								<div class="card-header text-center py-3"
									style="text-align: center; font-size: 1.2rem; font-weight: bold; padding: 15px;">
									참여 프로젝트</div>
								<!-- Tab 메뉴 -->
								<div
									class="d-flex justify-content-between align-items-center mb-2">
									<div class="fw-bold text-dark" style="font-size: 0.9rem;"></div>
									<ul class="nav nav-underline fs-9 w-100" id="resTab"
										role="tablist" style="margin-bottom: 0;">
										<li class="nav-item flex-grow-1 text-center"
											role="presentation"><a class="nav-link active"
											id="projectDoing-tab" data-bs-toggle="tab"
											href="#projectDoingTab" role="tab"
											aria-controls="projectDoingTab" aria-selected="true">진행 중</a>
										</li>
										<li class="nav-item flex-grow-1 text-center"
											role="presentation"><a class="nav-link"
											id="projectYet-tab" data-bs-toggle="tab"
											href="#projectYetTab" role="tab"
											aria-controls="projectYetTab" aria-selected="false">진행 예정</a>
										</li>
										<li class="nav-item flex-grow-1 text-center"
											role="presentation"><a class="nav-link"
											id="projectDone-tab" data-bs-toggle="tab"
											href="#projectDoneTab" role="tab"
											aria-controls="projectDoneTab" aria-selected="false">완료</a></li>
									</ul>
								</div>

								<!-- 탭 내용 -->
								<div class="tab-content mb-4">

									<!-- 승인/반려 대기 -->
									<div class="tab-pane fade show active" id="projectDoingTab">
										<div class="carousel slide" id="projectDoingCarousel">

											<!-- ✅ 인디케이터 -->
											<div class="carousel-indicators" id="doingCarouselIndicators">
												<!-- JavaScript에서 동적 로딩 -->
											</div>

											<!-- ✅ 슬라이드 항목 -->
											<div class="carousel-inner text-center"
												id="doingCarouselInner">
												<!-- JavaScript에서 동적 로딩 -->
											</div>

											<!-- ✅ 이전/다음 버튼 -->
											<button
												class="position-absolute mx-3 border-0 bg-transparent text-secondary"
												type="button" data-bs-target="#projectDoingCarousel"
												data-bs-slide="prev"
												style="top: 65%; left: -10px; transform: translateY(-50%); z-index: 2;">
												<i class="fas fa-chevron-left fs-7"></i>
											</button>
											<button
												class="position-absolute mx-3 border-0 bg-transparent text-secondary"
												type="button" data-bs-target="#projectDoingCarousel"
												data-bs-slide="next"
												style="top: 65%; right: -10px; transform: translateY(-50%); z-index: 2;">
												<i class="fas fa-chevron-right fs-7"></i>
											</button>

										</div>
									</div>

									<!-- 진행 예정 프로젝트 -->
									<div class="tab-pane fade" id="projectYetTab">
										<div class="carousel slide" id="projectYetCarousel">

											<!-- ✅ 인디케이터 -->
											<div class="carousel-indicators" id="yetCarouselIndicators">
												<!-- JavaScript에서 동적 로딩 -->
											</div>

											<!-- ✅ 슬라이드 항목 -->
											<div class="carousel-inner text-center" id="yetCarouselInner">
												<!-- JavaScript에서 동적 로딩 -->
											</div>

											<!-- ✅ 이전/다음 버튼 -->
											<button
												class="position-absolute mx-3 border-0 bg-transparent text-secondary"
												type="button" data-bs-target="#projectYetCarousel"
												data-bs-slide="prev"
												style="top: 65%; left: -10px; transform: translateY(-50%); z-index: 2;">
												<i class="fas fa-chevron-left fs-7"></i>
											</button>
											<button
												class="position-absolute mx-3 border-0 bg-transparent text-secondary"
												type="button" data-bs-target="#projectYetCarousel"
												data-bs-slide="next"
												style="top: 65%; right: -10px; transform: translateY(-50%); z-index: 2;">
												<i class="fas fa-chevron-right fs-7"></i>
											</button>

										</div>
									</div>


									<!-- 완료된 프로젝트 -->
									<div class="tab-pane fade" id="projectDoneTab">
										<div class="carousel slide" id="projectDoneCarousel">

											<!-- ✅ 인디케이터 -->
											<div class="carousel-indicators" id="doneCarouselIndicators">
												<!-- JavaScript에서 동적 로딩 -->
											</div>

											<!-- ✅ 슬라이드 항목 -->
											<div class="carousel-inner text-center"
												id="doneCarouselInner">
												<!-- JavaScript에서 동적 로딩 -->
											</div>

											<!-- ✅ 이전/다음 버튼 -->
											<button
												class="position-absolute mx-3 border-0 bg-transparent text-secondary"
												type="button" data-bs-target="#projectDoneCarousel"
												data-bs-slide="prev"
												style="top: 65%; left: -10px; transform: translateY(-50%); z-index: 2;">
												<i class="fas fa-chevron-left fs-7"></i>
											</button>
											<button
												class="position-absolute mx-3 border-0 bg-transparent text-secondary"
												type="button" data-bs-target="#projectDoneCarousel"
												data-bs-slide="next"
												style="top: 65%; right: -10px; transform: translateY(-50%); z-index: 2;">
												<i class="fas fa-chevron-right fs-7"></i>
											</button>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>


					<!-- 2행·2열 예약하기 예약 현황 보기 -->
					<div class="text-white p-1">
						<div class="attendance-card mx-auto">
							<div class="card shadow-sm border-0">

								<!-- 상단 제목 -->
								<div class="card-header text-center py-3"
									style="font-size: 1.2rem; font-weight: bold;">예약</div>

								<!-- 탭 버튼 -->
								<div
									class="d-flex justify-content-between align-items-center px-3 pt-2">
									<div class="fw-bold text-dark" style="font-size: 0.9rem;"></div>
									<ul class="nav nav-underline fs-9 w-100" id="resTab"
										role="tablist">
										<li class="nav-item flex-grow-1 text-center"
											role="presentation"><a class="nav-link active"
											id="vehicle-tab" data-bs-toggle="tab" href="#tab-vehicle"
											role="tab" aria-controls="tab-vehicle" aria-selected="true">차량</a>
										</li>
										<li class="nav-item flex-grow-1 text-center"
											role="presentation"><a class="nav-link" id="room-tab"
											data-bs-toggle="tab" href="#tab-room" role="tab"
											aria-controls="tab-room" aria-selected="false">회의실</a></li>
									</ul>
								</div>

								<!-- 카드 본문 -->
								<div class="card-body pt-2 pb-3 px-3">
									<div class="tab-content small" id="resTabContent"
										style="height: 100px; overflow-y: auto;">

										<!-- 차량 탭 -->
										<div class="tab-pane fade show active" id="tab-vehicle"
											role="tabpanel" aria-labelledby="vehicle-tab">
											<table class="table table-sm table-striped mb-0 text-center"
												style="font-size: 0.65rem;">
												<colgroup>
													<col style="width: 33%;">
													<col style="width: 34%;">
													<col style="width: 33%;">
												</colgroup>
												<thead>
													<tr>
														<th>차량</th>
														<th>예약자</th>
														<th>시간</th>
													</tr>
												</thead>
												<tbody>
													<tr th:if="${#lists.isEmpty(todayReservations)}">
														<td colspan="3">오늘 예약이 없습니다.</td>
													</tr>
													<tr th:each="res : ${todayReservations}">
														<td th:text="${res.vehicleName}"></td>
														<td th:text="${res.reserverName}"></td>
														<td><span
															th:text="${#temporals.format(res.reservation_start, 'HH:mm')}"></span>
															~ <span
															th:text="${#temporals.format(res.reservation_end, 'HH:mm')}"></span>
														</td>
													</tr>
												</tbody>
											</table>
										</div>

										<!-- 회의실 탭 -->
										<div class="tab-pane fade" id="tab-room" role="tabpanel"
											aria-labelledby="room-tab">
											<table class="table table-sm table-striped mb-0 text-center"
												style="font-size: 0.65rem;">
												<colgroup>
													<col style="width: 33%;">
													<col style="width: 34%;">
													<col style="width: 33%;">
												</colgroup>
												<thead>
													<tr>
														<th>회의실</th>
														<th>예약자</th>
														<th>시간</th>
													</tr>
												</thead>
												<tbody>
													<tr th:if="${#lists.isEmpty(todayRoomReservations)}">
														<td colspan="3">오늘 예약이 없습니다.</td>
													</tr>
													<tr th:each="res : ${todayRoomReservations}">
														<td th:text="${res.meetingRoomName}"></td>
														<td th:text="${res.reserverName}"></td>
														<td><span
															th:text="${#temporals.format(res.reservation_start, 'HH:mm')}"></span>
															~ <span
															th:text="${#temporals.format(res.reservation_end, 'HH:mm')}"></span>
														</td>
													</tr>
												</tbody>
											</table>
										</div>

									</div>
								</div>
							</div>
						</div>
					</div>

        <!-- 3행·1열 -->
		<div class="text-white p-1">
		    <div class="attendance-card mx-auto">
		        <div class="card shadow-sm border-0">
		    <div class="card-header text-center py-3" style="font-size: 1.2rem; font-weight: bold;">
			  긴급 공지
			</div>
			  <table class="table table-sm  mb-0 text-center" style="font-size: 1rem;">
			    <colgroup>
			      <col style="width: 70%;">
			      <col style="width: 30%;">
			    </colgroup>
			    
			    </table>
			    <div style="height: 200px; overflow-y: auto;">
			    <table id="emergencyNoticeTable" class="table table-sm  mb-0 text-center" style="font-size: 1rem;">
				     <colgroup>
				     <col style="width: 70%;">
				     <col style="width: 30%;">
				   </colgroup>
				   <tbody>
			     
			    </tbody>
			  </table>
			  </div>
		</div>
		</div>
		</div>

			

					<!-- 3행·2열: 날씨 카드 -->
					<div class="text-white p-1">
						<div class="attendance-card mx-auto">
							<div class="card shadow-sm border-0">

								<!-- 🔵 헤더 (오늘 날씨) -->
								<div class="card-header"
									style="text-align: center; font-size: 1.2rem; font-weight: bold; padding: 15px;">
									오늘 날씨</div>

								<!-- 🔵 날씨 본문 -->
								<div class="card-body">
									<!-- 상단: 도시명과 셀렉트 박스 -->
									<div
										style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
										<h3 id="city-name"
											style="font-size: 1.1rem; font-weight: bold; color: black;">도시명</h3>
										<select id="city-selector"
											style="padding: 6px 12px; font-size: 0.95rem; border-radius: 8px; border: 1px solid #00bfff;">
											<option value="current">현재 위치</option>
											<option value="Seoul">서울</option>
											<option value="Busan">부산</option>
											<option value="Incheon">인천</option>
											<option value="Daegu">대구</option>
											<option value="Daejeon">대전</option>
											<option value="Gwangju">광주</option>
											<option value="Suwon">수원</option>
											<option value="Changwon">창원</option>
											<option value="Gimhae">김해</option>
											<option value="Jeonju">전주</option>
											<option value="Cheongju">청주</option>
											<option value="Jeju">제주</option>
										</select>
									</div>

									<!-- 하단: 날씨 정보 + 아이콘 정렬 -->
									<div
										style="display: flex; justify-content: space-between; align-items: center;">
										<div style="color: black;">
											<p id="temperature">기온: --℃</p>
											<p id="description">날씨: --</p>
											<p id="humidity">습도: --%</p>
											<p id="wind">바람: -- m/s</p>
										</div>
										<div>
											<img id="weather-icon" src="" alt="날씨 아이콘"
												style="width: 120px; height: 120px; border-radius: 20px; background-color: #f8f9fa; padding: 12px; box-shadow: 0 6px 18px rgba(0, 0, 0, 0.15); transition: transform 0.3s ease, box-shadow 0.3s ease; cursor: pointer;"
												onmouseover="this.style.transform='scale(1.08)'; this.style.boxShadow='0 8px 22px rgba(0, 0, 0, 0.2)';"
												onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 6px 18px rgba(0, 0, 0, 0.15)';" />
										</div>
									</div>
								</div>

							</div>
						</div>
					</div>

					<!-- 3행·3열: IT 뉴스 -->
					<div class="text-white p-1">
						<div class="attendance-card mx-auto">
							<div class="card shadow-sm border-0">
								<!-- 헤더 -->
								<div class="card-header text-center fw-bold"
									style="font-size: 1.2rem; padding: 15px;">오늘자 IT 뉴스</div>

								<a id="newsLink" href="#" target="_blank"
									class="text-decoration-none"> <!-- ✅ 이미지: 깔끔하게 테두리 둥글림 + 여백 최소화 -->
									<div style="padding: 5px 15px;">
										<img id="newsImage" src="" alt="뉴스 이미지"
											style="width: 100%; height: 160px; object-fit: cover; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);">
									</div> <!-- ✅ 내용: 제목과 설명 여백 정리 -->
									<div class="px-3 pt-3 pb-2">
										  <!-- 제목: 1줄 + 말줄임 -->
									  <h6 id="newsTitle" class="fw-semibold text-dark mb-1"
										    style="font-size: 1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 40ch;">
										    뉴스 제목
										</h6>
										<p id="newsDescription" class="text-muted mb-0"
										   style="font-size: 0.85rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis;">
										   뉴스 요약
										</p>
									</div>

								</a>
							</div>
						</div>
					</div>


					<script>
    //캘린더
   document.addEventListener('DOMContentLoaded', function () {
			  setTimeout(() => {
			    const todayStr = new Date().toISOString().slice(0, 10); // yyyy-MM-dd
			    const calendarEl = document.getElementById('appCalendar');

			    const insertedTables = new Set(); // colgroup 중복 삽입 방지

			    const calendar = new FullCalendar.Calendar(calendarEl, {
			      initialView: 'listDay',
			      locale: 'ko',
			      noEventsContent: '오늘 일정이 없습니다',
			      headerToolbar: false,
			      eventTimeFormat: {
			    	    hour: '2-digit',
			    	    minute: '2-digit',
			    	    hour12: false  // 24시간제로 설정
			    	  },
			      validRange: {
			        start: todayStr,
			        end: todayStr
			      },
			      eventClick: function(info) {
			    	    info.jsEvent.preventDefault();
			    	    location.href = "/calendar/all"; 
			    	  },
			      height: '100%',
			      contentHeight: 'auto',
			      eventSources: [
			        {
			          url: '/calendar/list/all',
			          method: 'GET',
			          failure: () => console.error('불러오기 실패'),
			          success: function (events) {
			              //console.log("받아온 일정 목록:", events); // 응답 확인용
			              return events;
			        	}
			         }
			      ],
			      eventDidMount: function (info) {
			    	  const separator = info.event.extendedProps.separator || "";
			    	  const event = info.event;
			    	  const teamName = event.extendedProps.teamName || '';
			    	  const title = event.title;
			    	  
			    	  

			    	  // 제목에 팀명 붙이기
			    	  if (teamName && title && !title.startsWith(`[${teamName}]`)) {
			    	    event.setProp("title", `[${teamName}] ${title}`);
			    	  }

			    	  // 색상 스타일 지정
			    	  let backgroundColor = "#DDDDDD";
			    	  let borderColor = "#CCCCCC";
			    	  let textColor = "#000000";

			    	  if (separator.startsWith("A")) {
			    	    backgroundColor = "#F8D7DA";
			    	    borderColor = "#F5C6CB";
			    	    textColor = "#721C24";
			    	  }

			    	  if (separator.startsWith("T")) {
			    	    backgroundColor = "#BDE0FE";
			    	    borderColor = "#7FBFFF";
			    	    textColor = "#003366";
			    	  }

			    	  const titleEl = info.el.querySelector('.fc-list-event-title');
			    	  const timeEl = info.el.querySelector('.fc-list-event-time');
			    	  const rowEl = info.el.closest('tr');
			    	  
			    	  

			    	  // 제목 스타일
			    	  if (titleEl) {
			    	    titleEl.style.backgroundColor = backgroundColor;
			    	    titleEl.style.border = `1px solid ${borderColor}`;
			    	    titleEl.style.color = textColor;
			    	    titleEl.style.borderRadius = "8px";
			    	    titleEl.style.padding = "6px 10px";     
			    	    titleEl.style.margin = "6px 0";         
			    	    titleEl.style.boxShadow = "0 2px 4px rgba(0, 0, 0, 0.1)";
			    	    titleEl.style.fontWeight = "500";
			    	    titleEl.style.fontSize = "14px";
			    	  }
			    	  
			    	 
			    	  if (rowEl) {
			    	    rowEl.style.cursor = "pointer";
			    	    rowEl.style.height = "48px"; // 🔥 높이 주기
			    	    rowEl.style.borderBottom = "4px solid transparent"; // 🔥 아래 여백 느낌
			    	    rowEl.addEventListener("click", () => {
			    	      location.href = "/calendar/all";
			    	    });
			    	  }

			    	  // 시간 셀 스타일 (여유 주기)
			    	  if (timeEl) {
			    	    timeEl.style.paddingTop = "6px";
			    	    timeEl.style.paddingBottom = "6px";
			    	  }

			    	  // 각 전체 행에 마우스 커서 변경 + 클릭 이동
			    	  rowEl.style.cursor = "pointer";
			    	  rowEl.addEventListener("click", () => {
			    	    location.href = "/calendar/all";
			    	  });

			    	  // colgroup 삽입
			    	  const table = document.querySelector('table.fc-list-table');
			    	  if (table && !insertedTables.has(table)) {
			    	    const colgroup = document.createElement('colgroup');

			    	    const col1 = document.createElement('col');
			    	    col1.style.width = '30%';

			    	    const col2 = document.createElement('col');
			    	    col2.style.width = '0';
			    	    col2.style.display = 'none';

			    	    const col3 = document.createElement('col');
			    	    col3.style.width = '70%';

			    	    colgroup.appendChild(col1);
			    	    colgroup.appendChild(col2);
			    	    colgroup.appendChild(col3);

			    	    const thead = table.querySelector('thead');
			    	    if (thead) {
			    	      table.insertBefore(colgroup, thead);
			    	    } else {
			    	      table.prepend(colgroup);
			    	    }

			    	    insertedTables.add(table);
			    	  }
			    	}
			    });

			    calendar.render();

			    // 스크롤 조정
			    setTimeout(() => {
			      const scroller = document.querySelector('.fc-scroller');
			      if (scroller) {
			        scroller.style.maxHeight = '300px';
			        scroller.style.overflowY = 'auto';
			      }
			    }, 300);
			  }, 100);
			});

    
      document.addEventListener('DOMContentLoaded', function(){
        // 현재 시간 표시
        function updateCurrentTime() {
          const now = new Date();
          const year = now.getFullYear();
          const month = String(now.getMonth()+1).padStart(2,'0');
          const date = String(now.getDate()).padStart(2,'0');
          const hours = String(now.getHours()).padStart(2,'0');
          const minutes = String(now.getMinutes()).padStart(2,'0');
          const seconds = String(now.getSeconds()).padStart(2,'0');
          const formattedDateTime = `${year}년${month}월${date}일 ${hours}:${minutes}:${seconds}`;
          document.getElementById('currentTime').innerText = formattedDateTime;
        }
        updateCurrentTime();
        setInterval(updateCurrentTime, 1000);

        const attendanceForm = document.getElementById('attendanceForm');
        const attendanceType = document.getElementById('attendanceType');
        const checkInBtn = document.getElementById('checkInBtn');
        const checkOutBtn = document.getElementById('checkOutBtn');

        // 출근
        checkInBtn.addEventListener('click', function(e){
          e.preventDefault();
          attendanceType.value = 'checkIn';
          const now = new Date();
          const time = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;
          const formData = new FormData(attendanceForm);
          fetch("/log", {
            method: 'post',
            headers: {
              'header': document.querySelector('meta[name="_csrf_header"]').content,
              'X-CSRF-Token': document.querySelector('meta[name="_csrf"]').content
            },
            body: formData
          })
          .then(response => response.json())
          .then(data => {
            alert(data.res_msg);
            if(data.res_code == 200){
              localStorage.setItem("attendanceStatus","checkedIn");
              localStorage.setItem("checkInTime",time);
              localStorage.setItem("attendanceDate",new Date().toISOString().split('T')[0]);
              location.reload();
            }
          })
          .catch(error => {
            console.error('출근 오류:',error);
            alert('출근 실패');
          });
        });

        // 퇴근
        checkOutBtn.addEventListener('click', function(e){
          e.preventDefault();
          if(!confirm("퇴근 하시겠습니까?")) return;
          attendanceType.value = 'checkOut';
          const now = new Date();
          const time = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;
          const formData = new FormData(attendanceForm);
          fetch("/log", {
            method:'post',
            headers:{
              'header': document.querySelector('meta[name="_csrf_header"]').content,
              'X-CSRF-Token': document.querySelector('meta[name="_csrf"]').content
            },
            body: formData
          })
          .then(response => response.json())
          .then(data => {
            alert(data.res_msg);
            if(data.res_code == 200){
              localStorage.setItem("attendanceStatus","checkedOut");
              localStorage.setItem("checkOutTime",time);
              localStorage.setItem("attendanceDate",new Date().toISOString().split('T')[0]);
              location.reload();
            }
          })
          .catch(error => {
            console.error('퇴근 오류',error);
            alert('퇴근 실패');
          });
        });

        const today = new Date().toISOString().split('T')[0];
        if(localStorage.getItem("attendanceDate") === today){
          // 필요시 상태 복구 로직 넣기
        }
        
        // 프로필 사진
		const profile = document.getElementById('profileImage');
        fetch('/profile/image')
        	.then(response => response.json())
        	.then(data => {
        		if(data.profileImage){
        			if(profile){
        				profile.onload = () => profile.style.display = 'inline';
        				profile.src = data.profileImage;
        			}
        		}
        	})
        	.catch(error => {
        		console.error('프로필 이미지 로드 실패 : ',error);
        	});
      });
    </script>

					<!-- 프로젝트 관련 비동기 -->
					<script>
	const projectDoingTab = document.getElementById('doingCarouselInner');
	const projectYetTab = document.getElementById('yetCarouselInner');
	const projectDoneTab = document.getElementById('doneCarouselInner');
	
	async function loadProjectCarousel(target, endpoint, indicators) {
	    try {
	        const res = await fetch(endpoint);
	        if (!res.ok) throw new Error('서버 오류: ' + res.status);
	        const data = await res.json();
	        console.log(`✅ ${endpoint} 응답 결과:`, data);
	
	        target.innerHTML = '';
	        indicators.innerHTML = '';
	
	        if (!data || !Array.isArray(data) || data.length === 0) {
	            let nothingHtml = `
	                <div class="carousel-item active">
	            	<div class="text-center">
		                <span class="fw-bold fs-9" style="visibility: hidden;">프로젝트</span>
		            </div>
	                    <div class="border rounded py-3 mx-5 bg-light-subtle cursor-pointer">
	                        <h5 class="mb-1 fw-bold text-dark text-decoration-none">
	                            프로젝트가 없습니다.
	                        </h5>
	                        <p class="mb-0 text-muted fs-9">-</p>
	                    </div>
	                </div>
	            `;
	            target.innerHTML += nothingHtml;
	            return;
	        }
	
	        data.forEach((item, index) => {
	            const projectTitle = item.project_name ?? '제목 없음';
	            const projectNo = item.project_no ?? 0;
	            const proceed = item.proceed ?? '-'; // 진행 상태

	            // 날짜 포맷 함수
	            const formatDate = (rawDate) => {
	                const date = new Date(rawDate);
	                const yyyy = date.getFullYear();
	                const mm = String(date.getMonth() + 1).padStart(2, '0');
	                const dd = String(date.getDate()).padStart(2, '0');
	                return `${yyyy}.${mm}.${dd}`;
	            };

	            // 시작일 또는 종료일 표시
	            let dateLabel = '시작일';
	            let dateValue = item.project_start ? formatDate(item.project_start) : '-';

	            if (proceed == '완료' && item.project_end) {
	                dateLabel = '종료일';
	                dateValue = formatDate(item.project_end);
	            }

	            const html = `
	                <div class="carousel-item ${index === 0 ? 'active' : ''}">
	                    <div class="text-center">
	                        <span class="fw-bold fs-15" style="visibility: hidden;">프로젝트</span>
	                    </div>
	                    <div class="border rounded py-3 mx-5 bg-primary-soft cursor-pointer"
	                        onclick="location.href='/project/detail/${projectNo}/main'">
	                        <h5 class="mb-1 fw-bold text-dark text-decoration-none">
	                          ${projectTitle}
	                        </h5>
	                        <p class="mb-0 text-muted fs-9">${dateLabel} : ${dateValue}</p>
	                    </div>
	                </div>
	            `;

	            target.innerHTML += html;

	            indicators.innerHTML += `
	                <button type="button" data-bs-target="#${target.id}" data-bs-slide-to="${index}"
	                        class="${index === 0 ? 'active' : ''}" aria-label="슬라이드 ${index + 1}"></button>
	            `;
	        });



	
	    } catch (error) {
	        console.error(`❌ ${endpoint} 데이터 로딩 오류:`, error);
	    }
	}
	
	// ✅ 실제 호출
	loadProjectCarousel(
	    document.getElementById('doingCarouselInner'),
	    '/project/mainpage/doing',
	    document.getElementById('doingCarouselIndicators')
	);
	
	loadProjectCarousel(
	    document.getElementById('yetCarouselInner'),
	    '/project/mainpage/yet',
	    document.getElementById('yetCarouselIndicators')
	);
	
	loadProjectCarousel(
	    document.getElementById('doneCarouselInner'),
	    '/project/mainpage/done',
	    document.getElementById('doneCarouselIndicators')
	);
	</script>


					<!-- 결재 관련 비동기 -->
					<script>
	//탭 요소들 가져오기
	const approvalOngoingTab = document.getElementById('approvalOngoingInner');
	const approvalPendingTab = document.getElementById('approvalPendingInner');
	const approvalCompletedTab = document.getElementById('approvalCompletedInner');
	
	
	//✅ Carousel 로딩 함수
	async function loadApprovalCarousel(target, endpoint, indicators) {
	    try {
	        const res = await fetch(endpoint);
	        if (!res.ok) throw new Error('서버 오류: ' + res.status);
	
	        const data = await res.json();
	        console.log(`✅ ${endpoint} 응답 결과:`, data);
	
	        // ✅ 초기화
	        target.innerHTML = '';
	        indicators.innerHTML = '';
	
	        if (!data || !Array.isArray(data) || data.length === 0) {
	        	nothingHtmlFormS = `
	                <div class="carousel-item active">
	            	<div class="text-center">
					<svg style="height: 12px;" class="svg-inline--fa fa-circle fs-10 text-primary me-1" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512z"></path></svg><!-- <i class="fas fa-circle fs-10 text-primary me-1"></i> Font Awesome fontawesome.com -->
					<span class="fw-bold fs-9">진행 중 결재</span>
				</div>
	                    <div class="border rounded py-3 mx-5 bg-primary-soft cursor-pointer">
	                        <h5 class="mb-1 fw-bold text-dark text-decoration-none">
	                          진행중인 결재가 없습니다.
	                        </h5>
	                          <p class="mb-0 text-muted fs-9">작성한 내 결재가 여기에 표시됩니다.</p>
	                    </div>
	                </div>
	            `;
	        	nothingHtmlFormToMe = `
	                <div class="carousel-item active">
	            	<div class="text-center">
	            	<svg style="height: 12px;" class="svg-inline--fa fa-circle fs-10 mt-n1" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg="" ><path fill="#FFD700" d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512z"></path></svg><!-- <i class="fas fa-circle fs-10 text-success mt-n1"></i> Font Awesome fontawesome.com -->
					<span class="fw-bold fs-9">내게 온 결재</span>
				</div>
	                    <div class="border rounded py-3 mx-5 bg-warning-soft cursor-pointer">
	                        <h5 class="mb-1 fw-bold text-dark text-decoration-none">
	                        	내게 온 결재가 없습니다.
	                        </h5>
	                        <p class="mb-0 text-muted fs-9">내 승인을 대기 중인 결재가 여기에 표시됩니다.</p>
	                    </div>
	                </div>
	            `;
	        	nothingHtmlFormAD = `
	                <div class="carousel-item active">
	            	<div class="text-center">
	            	<svg style="height: 12px;" class="svg-inline--fa fa-circle fs-10 text-success mt-n1" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512z"></path></svg><!-- <i class="fas fa-circle fs-10 text-success mt-n1"></i> Font Awesome fontawesome.com -->
	            	<svg style="height: 12px;" class="svg-inline--fa fa-circle fs-10 text-danger mt-n1" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512z"></path></svg><!-- <i class="fas fa-circle fs-10 text-success mt-n1"></i> Font Awesome fontawesome.com -->
					<span class="fw-bold fs-9">완료된 결재</span>
				</div>
	                    <div class="border rounded py-3 mx-5 bg-success-soft cursor-pointer">
	                        <h5 class="mb-1 fw-bold text-dark text-decoration-none">
	                        	완료된 결재가 없습니다.
	                        </h5>
	                            <p class="mb-0 text-muted fs-9">승인/반려 완료된 내 결재가 여기에 표시됩니다.</p>
	                    </div>
	                </div>
	            `;
	            
	            
	
				if(endpoint == '/mainpage/approval/ongoing'){
					target.innerHTML += nothingHtmlFormS
				} else if(endpoint == '/mainpage/approval/pending'){
					target.innerHTML += nothingHtmlFormToMe
				} else if(endpoint == '/mainpage/approval/completed'){
					target.innerHTML += nothingHtmlFormAD
				} 
	            return;
	        }
	
	        // ✅ 슬라이드 생성
	        data.forEach((item, index) => {
	            const approvalTitle = item.approval_title ?? '제목 없음';
	            const approvalNo = item.approval_no ?? 0;
	            const displayDate = item.approval_display_date ?? '-';
	            const completedDate = item.approval_completed_date ?? '-';
				const approvalStatus = item.approval_status ?? '-';
				const approvalWriter = item.approval_writer ?? '-';
	            // 슬라이드 항목 
	            const htmlFormS = `
	                <div class="carousel-item ${index === 0 ? 'active' : ''}">
	            	<div class="text-center">
					<svg style="height: 12px;" class="svg-inline--fa fa-circle fs-10 text-primary me-1" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512z"></path></svg><!-- <i class="fas fa-circle fs-10 text-primary me-1"></i> Font Awesome fontawesome.com -->
					<span class="fw-bold fs-9">진행 중 결재</span>
				</div>
	                    <div class="border rounded py-3 mx-5 bg-primary-soft cursor-pointer"
	                        onclick="location.href='/approval/${approvalNo}/detail'">
	                        <h5 class="mb-1 fw-bold text-dark text-decoration-none">
	                          ${approvalTitle}
	                        </h5>
	                        <p class="mb-0 text-muted fs-9">기안일 : ${displayDate}</p>
	                    </div>
	                </div>
	            `;
	            const htmlFormA = `
	                <div class="carousel-item ${index === 0 ? 'active' : ''}">
	            	<div class="text-center">
					<svg style="height: 12px;" class="svg-inline--fa fa-circle fs-10 text-success mt-n1" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512z"></path></svg><!-- <i class="fas fa-circle fs-10 text-success mt-n1"></i> Font Awesome fontawesome.com -->
					<span class="fw-bold fs-9">승인된 결재</span>
				</div>
	                    <div class="border rounded py-3 mx-5 bg-success-soft cursor-pointer"
	                        onclick="location.href='/approval/${approvalNo}/detail'">
	                        <h5 class="mb-1 fw-bold text-dark text-decoration-none">
	                          ${approvalTitle}
	                        </h5>
	                        <p class="mb-0 text-muted fs-9">완료일 : ${completedDate}</p>
	                    </div>
	                </div>
	            `;
	            const htmlFormD = `
	                <div class="carousel-item ${index === 0 ? 'active' : ''}">
	            	<div class="text-center">
	            	<svg style="height: 12px;" class="svg-inline--fa fa-circle fs-10 text-danger mt-n1" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512z"></path></svg><!-- <i class="fas fa-circle fs-10 text-success mt-n1"></i> Font Awesome fontawesome.com -->
					<span class="fw-bold fs-9">반려된 결재</span>
				</div>
	                    <div class="border rounded py-3 mx-5 bg-fail-soft cursor-pointer"
	                        onclick="location.href='/approval/${approvalNo}/detail'">
	                        <h5 class="mb-1 fw-bold text-dark text-decoration-none">
	                          ${approvalTitle}
	                        </h5>
	                        <p class="mb-0 text-muted fs-9">완료일 : ${completedDate}</p>
	                    </div>
	                </div>
	            `;
	            const htmlFormToMe = `
	                <div class="carousel-item ${index === 0 ? 'active' : ''}">
	            	<div class="text-center">
	            	<svg style="height: 12px;" class="svg-inline--fa fa-circle fs-10 mt-n1" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg="" ><path fill="#FFD700" d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512z"></path></svg><!-- <i class="fas fa-circle fs-10 text-success mt-n1"></i> Font Awesome fontawesome.com -->
					<span class="fw-bold fs-9">내게 온 결재</span>
				</div>
	                    <div class="border rounded py-3 mx-5 bg-warning-soft cursor-pointer"
	                        onclick="location.href='/approval/${approvalNo}/detail'">
	                        <h5 class="mb-1 fw-bold text-dark text-decoration-none">
	                          ${approvalTitle}
	                        </h5>
	                        <p class="mb-0 text-muted fs-9">기안일 : ${displayDate} / 기안자 : ${approvalWriter}</p>
	                    </div>
	                </div>
	            `;
				/* if (approvalStatus === 'S') {
				    if (approval_toMe) {
				        target.innerHTML += htmlFormToMe;
				    } else {
				        target.innerHTML += htmlFormS;
				    }
				} else if (approvalStatus === 'A') {
				    target.innerHTML += htmlFormA;
				} else if (approvalStatus === 'D') {
				    target.innerHTML += htmlFormD;
				} */
				if(endpoint == '/mainpage/approval/ongoing'){
					target.innerHTML += htmlFormS
				} else if(endpoint == '/mainpage/approval/pending'){
					target.innerHTML += htmlFormToMe
				} else if(endpoint == '/mainpage/approval/completed'){
					if(approvalStatus === 'A'){
						target.innerHTML += htmlFormA
					} else if(approvalStatus === 'D'){
						target.innerHTML += htmlFormD
					}
				} 
	
	            // 인디케이터 생성
	            indicators.innerHTML += `
	                <button type="button" data-bs-target="#${target.id}" data-bs-slide-to="${index}"
	                        class="${index === 0 ? 'active' : ''}" aria-label="슬라이드 ${index + 1}"></button>
	            `;
	            
	            
	            
	        });
	        
	
	    } catch (error) {
	        console.error(`❌ ${endpoint} 데이터 로딩 오류:`, error);
	    }
	}
	
	// ✅ 로딩 실행
	loadApprovalCarousel(
	    document.getElementById('ongoingCarouselInner'), 
	    '/mainpage/approval/ongoing', 
	    document.getElementById('ongoingCarouselIndicators')
	);
	
	loadApprovalCarousel(
	    document.getElementById('pendingCarouselInner'), 
	    '/mainpage/approval/pending', 
	    document.getElementById('pendingCarouselIndicators')
	);
	
	loadApprovalCarousel(
	    document.getElementById('completedCarouselInner'), 
	    '/mainpage/approval/completed', 
	    document.getElementById('completedCarouselIndicators')
	);
	</script>

					<script>
  let cachedNews = [];
  let currentNewsIndex = 0;

  function setDefaultNews() {
    document.getElementById("newsTitle").innerText = "“눈 감았다 뜨니 세상 바뀌어 있었다”";
    document.getElementById("newsDescription").innerText = "AI 임팩트, 두려움과 기대 속에 다가온 기술 혁명… GPT가 만든 세계, 우리는 준비됐나?";
    document.getElementById("newsImage").src = "https://images.pexels.com/photos/3184465/pexels-photo-3184465.jpeg?auto=compress&cs=tinysrgb&w=640";
    document.getElementById("newsLink").href = "https://www.kmib.co.kr/article/view.asp?arcid=0028078159&code=61141111&cp=nv";
  }

  function showNews(index) {
    if (cachedNews.length === 0) return setDefaultNews();

    const article = cachedNews[index];
    document.getElementById("newsTitle").innerText = article.title || "뉴스 제목";
    document.getElementById("newsDescription").innerText = article.description || "뉴스 설명 없음";
    document.getElementById("newsImage").src = article.urlToImage || "https://via.placeholder.com/150";
    document.getElementById("newsLink").href = article.url || "#";
  }

  function loadNewsOnce() {
    fetch('/api/news?query=IT&language=ko&page=1&size=10')
      .then(res => {
        if (!res.ok) throw new Error(`뉴스 API 오류: ${res.status}`);
        return res.json();
      })
      .then(data => {
        if (!data.articles || data.articles.length === 0) {
          console.warn("받은 뉴스 없음 → 기본 뉴스 사용");
          return setDefaultNews();
        }
        cachedNews = data.articles;
        currentNewsIndex = 0;
        showNews(currentNewsIndex);
      })
      .catch(error => {
        console.error("뉴스 불러오기 실패:", error);
        setDefaultNews();
      });
  }

  // 5초마다 캐시된 뉴스 슬라이드
  setInterval(() => {
    if (cachedNews.length === 0) return;
    currentNewsIndex = (currentNewsIndex + 1) % cachedNews.length;
    showNews(currentNewsIndex);
  }, 5000);

  // 2시간마다 새로운 뉴스 갱신
  setInterval(loadNewsOnce, 2 * 60 * 60 * 1000);

  // 최초 로딩 시 1회 실행
  window.onload = loadNewsOnce;
</script>

	<script>
		function mapCityName(cityName) {
		  const cityMap = {
		    "Seoul": "서울", "Busan": "부산", "Incheon": "인천", "Daegu": "대구",
		    "Daejeon": "대전", "Gwangju": "광주", "Suwon": "수원", "Changwon": "창원",
		    "Gimhae": "김해", "Jeonju": "전주", "Cheongju": "청주", "Jeju": "제주", "Kwangmyŏng": "광명"
		  };
		  return cityMap[cityName] || cityName;
		}
		
		function displayWeatherData(data, cityName) {
		  document.getElementById("city-name").textContent = cityName;
		  document.getElementById("temperature").textContent = `기온: ${data.main.temp}℃`;
		  document.getElementById("description").textContent = `날씨: ${data.weather[0].description}`;
		  document.getElementById("humidity").textContent = `습도: ${data.main.humidity}%`;
		  document.getElementById("wind").textContent = `바람: ${data.wind.speed} m/s`;
		
		  const iconCode = data.weather[0].icon;
		  document.getElementById("weather-icon").src = `https://openweathermap.org/img/wn/${iconCode}@2x.png`;
		}
		
		function getWeatherByCoords(lat, lon) {
		  fetch(`/api/weather/coord?lat=${lat}&lon=${lon}&lang=kr`)
		    .then(res => res.json())
		    .then(data => displayWeatherData(data, mapCityName(data.name)))
		    .catch(err => console.error("위치 기반 날씨 오류:", err));
		}
		
		function getWeatherByCity(city) {
		  fetch(`/api/weather?city=${city}&lang=kr`)
		    .then(res => res.json())
		    .then(data => displayWeatherData(data, mapCityName(data.name)))
		    .catch(err => console.error("도시 기반 날씨 오류:", err));
		}
		
		document.addEventListener("DOMContentLoaded", () => {
		  if (navigator.geolocation) {
		    navigator.geolocation.getCurrentPosition(
		      pos => getWeatherByCoords(pos.coords.latitude, pos.coords.longitude),
		      err => {
		        console.warn("위치 실패, 서울로 대체");
		        getWeatherByCity("Seoul");
		      }
		    );
		  } else {
		    console.warn("Geolocation 미지원, 서울로 대체");
		    getWeatherByCity("Seoul");
		  }
		
		  document.getElementById("city-selector").addEventListener("change", e => {
		    const city = e.target.value;
		    if (city === "current") {
		      navigator.geolocation.getCurrentPosition(
		        pos => getWeatherByCoords(pos.coords.latitude, pos.coords.longitude)
		      );
		    } else {
		      getWeatherByCity(city);
		    }
		  });
		});
		</script>

					<script>
	
	
	document.addEventListener('DOMContentLoaded', () => {
		  fetch('/article/test-json')
		    .then(response => response.json())
		    .then(notices => {
		      const tbody = document.querySelector('#emergencyNoticeTable tbody');
		      tbody.innerHTML = '';

		      if (notices.length === 0) {
		        tbody.innerHTML = '<tr><td colspan="2">공지글이 없습니다.</td></tr>';
		      } else {
		        notices.forEach(notice => {
		          const tr = document.createElement('tr');

		          const titleTd = document.createElement('td');
		          titleTd.innerHTML = `<span class="badge bg-danger me-1">긴급</span>${notice.article_title}`;
		          titleTd.style.textAlign = 'left';
		          titleTd.style.paddingLeft = '35px';
		          const dateTd = document.createElement('td');
		          dateTd.style.paddingLeft = '20px';
		          const date = new Date(notice.article_reg_date);
		          if (!isNaN(date.getTime())) { // 날짜 유효성 체크
		        	const year = date.getFullYear(); 
		          	const month = String(date.getMonth() + 1).padStart(2, '0');
		          	const day = String(date.getDate()).padStart(2, '0');
		          	
		            //const formattedDate = date.toISOString().split('T')[0];  // yyyy-MM-dd
		            const formattedDate = `${year}.${month}.${day}`;  // yyyy.MM.dd
		            dateTd.textContent = formattedDate;
		          } else {
		            dateTd.textContent = '-';  // 유효하지 않은 날짜일 때 대체 텍스트
		            console.warn('Invalid date:', notice.articleRegDate);
		          }

		          tr.appendChild(titleTd);
		          tr.appendChild(dateTd);
		          tr.style.cursor = 'pointer';  // 마우스 커서도 변경
		          tr.addEventListener('click', () => {
		            // 예: 상세 페이지 URL이 /article/detail/{article_no} 라고 가정
		            window.location.href = `/article/notice/detail/${notice.article_no}`;
		          });
		          tbody.appendChild(tr);
		        });
		      }
		    })
		    .catch(error => {
		      const tbody = document.querySelector('#emergencyNoticeTable tbody');
		      tbody.innerHTML = '<tr><td colspan="2">오류가 발생했습니다.</td></tr>';
		      console.error('Fetch error:', error);
		    });
		});
	</script>

				</div>
	</main>
</body>
</html>
